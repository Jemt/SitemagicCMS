(function(factory){if(typeof module==="object"&&typeof module.exports==="object"){var fit=factory();module.exports=fit;Object.defineProperty(module.exports,"__esModule",{value:true})}else if(typeof define==="function"&&define.amd){define(["require","exports"],factory)}else if(window){var src=document.scripts[document.scripts.length-1].src;var paramSeparatorPos=src.indexOf("?");if(paramSeparatorPos>-1){var name=src.substring(paramSeparatorPos+1,src.indexOf("&")===-1?src.length:src.indexOf("&"));if(name.indexOf("=")===-1){window[name]=factory()}else{window.Fit=factory()}}else{window.Fit=factory()}}})(function(){var fitInstance=function(){(function(){if(!window.JSON||!window.NodeList){if(navigator.userAgent.indexOf("MSIE")>-1)throw new Error("Browser not supported - Internet Explorer 8 or newer is required - make sure Compatibility View is not enabled");else throw new Error("Browser not supported")}return true})();(function(){if(!window.console)window.console={};var shims=["log","debug","info","error","warn","trace"];for(var i=0;i<shims.length;i++){if(!console[shims[i]])console[shims[i]]=function(){}}})();var Fit={};Fit.Core={};Fit.Core.Extend=function(subInstance,superType){Fit.Validation.ExpectIsSet(subInstance);Fit.Validation.ExpectFunction(superType);var binder={Apply:function(){superType.apply(subInstance,arguments);if(!subInstance._internal)subInstance._internal={};if(!subInstance._internal.Extends)subInstance._internal.Extends=[];Fit.Array.Add(subInstance._internal.Extends,superType)}};return binder};Fit.Core.Extends=function(instance,superType){Fit.Validation.ExpectIsSet(instance);Fit.Validation.ExpectFunction(superType);return instance._internal&&instance._internal.Extends&&Fit.Array.Contains(instance._internal.Extends,superType)===true};Fit.Core.InstanceOf=function(instance,type){return instance instanceof type||Fit.Core.Extends(instance,type)===true};Fit.Core.CreateOverride=function(originalFunction,newFunction){Fit.Validation.ExpectFunction(originalFunction);Fit.Validation.ExpectFunction(newFunction);return function(){var orgBase=window.base;window.base=originalFunction;var error=null;var result=undefined;try{var args=[];for(var i=0;i<arguments.length;i++)args[i]=arguments[i];if(args.length>0)result=newFunction.apply(this,args);else result=newFunction.apply(this)}catch(err){error=err}if(orgBase){window.base=orgBase}else{try{delete window.base}catch(err){window.base=undefined}}if(error!==null)Fit.Validation.ThrowError(error);if(result!==undefined)return result}};Fit.Core.IsEqual=function(jsObj1,jsObj2){if(typeof jsObj1!==typeof jsObj2)return false;if(jsObj1===undefined&&jsObj2===undefined||jsObj1===null&&jsObj2===null){return true}else if(typeof jsObj1==="string"||typeof jsObj1==="boolean"){return jsObj1===jsObj2}else if(typeof jsObj1==="number"){if(isNaN(jsObj1)===true&&isNaN(jsObj2)===true)return true;else return jsObj1===jsObj2}else if(jsObj1 instanceof Date&&jsObj2 instanceof Date){return jsObj1.getTime()===jsObj2.getTime()}else if(jsObj1 instanceof Array&&jsObj2 instanceof Array){if(jsObj1.length!==jsObj2.length)return false;for(var i=0;i<jsObj1.length;i++){if(Fit.Core.IsEqual(jsObj1[i],jsObj2[i])===false)return false}return true}else if(typeof jsObj1==="object"&&typeof jsObj2==="object"&&jsObj1!==null&&jsObj2!==null){var identical=true;var keys=Fit.Array.Merge(Fit.Array.GetKeys(jsObj1),Fit.Array.GetKeys(jsObj2));Fit.Array.ForEach(keys,function(k){if(Fit.Core.IsEqual(jsObj1[k],jsObj2[k])===false){identical=false;return false}});return identical}else if(typeof jsObj1==="function"&&typeof jsObj2==="function"){return jsObj1===jsObj2}return false};Fit.Core.Clone=function(obj){var serialized=JSON.stringify(obj);var clone=serialized!==undefined?JSON.parse(serialized):serialized;var fixClone=null;fixClone=function(org,clo){if(org instanceof Date){return new Date(org.getTime())}else if(typeof org==="function"){return org}else if(typeof org==="number"&&isNaN(org)===true){return parseInt("")}else if(typeof org==="number"&&org===Infinity){return Infinity}else if(org&&typeof org==="object"){for(var p in org)clo[p]=fixClone(org[p],clo[p])}return clo};clone=fixClone(obj,clone);return clone};Fit._internal={Core:{VersionInfo:{Major:1,Minor:0,Patch:44}}};Fit._internal.Core.EnsureStyles=function(){if(Fit._internal.Core.StylesEnsured===true)return;Fit._internal.Core.StylesEnsured=true;var elm=Fit.Dom.CreateElement("<div class='FitUiStyleCheck'></div>");Fit.Dom.Add(document.body,elm);if(Fit.Dom.GetComputedStyle(elm,"width")!=="20px"){Fit.Browser.Log("Lazy loading Fit.UI stylesheet. It is recommended to add a stylesheet reference to Fit.UI.min.css to prevent temporarily unstyled content.");Fit.Loader.LoadStyleSheet(Fit.GetUrl()+"/Fit.UI.min.css")}Fit.Dom.Remove(elm)};(function(){var src=document.scripts[document.scripts.length-1].src;if(!src){src=location.href}Fit._internal.BaseUrl=src.substring(0,src.lastIndexOf("/"));var path=Fit._internal.BaseUrl.replace("http://","").replace("https://","");Fit._internal.BasePath=path.indexOf("/")!==-1?path.substring(path.indexOf("/")):"/"})();Fit.GetVersion=function(){var info=Fit.Core.Clone(Fit._internal.Core.VersionInfo);info.Version=info.Major+"."+info.Minor+"."+info.Patch;return info};Fit.GetUrl=function(){if(Fit._internal.BaseUrlOverride!==undefined)return Fit._internal.BaseUrlOverride;return Fit._internal.BaseUrl};Fit.GetPath=function(){if(Fit._internal.BasePathOverride!==undefined)return Fit._internal.BasePathOverride;return Fit._internal.BasePath};Fit.SetPath=function(basePath){Fit.Validation.ExpectStringValue(basePath===null?"-":basePath);if(basePath===null){delete Fit._internal.BasePathOverride;delete Fit._internal.BaseUrlOverride;return}if(basePath!=="/"&&basePath.lastIndexOf("/")===basePath.length-1){basePath=basePath.substring(0,basePath.length-1)}var rootUrl=location.protocol+"//"+location.host;Fit._internal.BasePathOverride=basePath;if(basePath==="/"){Fit._internal.BaseUrlOverride=rootUrl}else if(basePath.indexOf("/")===0){Fit._internal.BaseUrlOverride=rootUrl+basePath}else{var curPath=location.pathname.substring(0,location.pathname.lastIndexOf("/"));Fit._internal.BaseUrlOverride=rootUrl+curPath+"/"+basePath}};Fit.Validation={};Fit._internal.Validation={};Fit._internal.Validation.DebugMode=true;Fit._internal.Validation.Clone=null;Fit.Validation.ExpectObject=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val.constructor!==Object)Fit.Validation.ThrowError("Value '"+val+"' is not a valid object")};Fit.Validation.ExpectNumber=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(typeof val!=="number"||isNaN(val)===true)Fit.Validation.ThrowError("Value '"+val+"' is not a valid number")};Fit.Validation.ExpectInteger=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(typeof val!=="number"||val%1!==0)Fit.Validation.ThrowError("Value '"+val+"' is not a valid integer")};Fit.Validation.ExpectString=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(typeof val!=="string")Fit.Validation.ThrowError("Value '"+val+"' is not a valid string")};Fit.Validation.ExpectStringValue=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;Fit.Validation.ExpectString(val);if(val==="")Fit.Validation.ThrowError("String cannot be empty")};Fit.Validation.ExpectBoolean=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(typeof val!=="boolean")Fit.Validation.ThrowError("Value '"+val+"' is not a valid boolean")};Fit.Validation.ExpectDate=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Date===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of Date")};Fit.Validation.ExpectArray=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Array===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of Array")};Fit.Validation.ExpectTypeArray=function(val,typeValCallback,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Array===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of Array");Fit.Validation.ExpectFunction(typeValCallback);Fit.Array.ForEach(val,function(v){typeValCallback(v)})};Fit.Validation.ExpectInstanceArray=function(val,instanceType,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Array===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of Array");Fit.Array.ForEach(val,function(v){Fit.Validation.ExpectInstance(v,instanceType)})};Fit.Validation.ExpectCollection=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(Fit._internal.Validation.IsCollectionType(val)===false)Fit.Validation.ThrowError("Value '"+val+"' is not a valid collection")};Fit.Validation.ExpectRegExp=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof RegExp===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of RegExp")};Fit.Validation.ExpectElementNode=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Element===false)Fit.Validation.ThrowError("Value '"+val+"' is not a DOMElement")};Fit.Validation.ExpectDomElement=Fit.Validation.ExpectElementNode;Fit.Validation.ExpectTextNode=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Text===false)Fit.Validation.ThrowError("Value '"+val+"' is not a Text node")};Fit.Validation.ExpectCommentNode=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Comment===false)Fit.Validation.ThrowError("Value '"+val+"' is not a Comment node")};Fit.Validation.ExpectNode=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Element===false&&val instanceof Text===false&&val instanceof Comment===false)Fit.Validation.ThrowError("Value '"+val+"' is not a Node (Element, Text, or Comment)")};Fit.Validation.ExpectWindow=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof Window===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of Window")};Fit.Validation.ExpectFunction=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(typeof val!=="function")Fit.Validation.ThrowError("Value '"+val+"' is not a valid function")};Fit.Validation.ExpectEventTarget=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(typeof EventTarget!=="undefined"&&val instanceof EventTarget===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of EventTarget");else if(!val.removeEventListener&&!val.attachEvent)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of EventTarget")};Fit.Validation.ExpectEvent=function(val,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(!window.MSEventObj)window.MSEventObj=function(){};if(val instanceof Event===false&&val instanceof MSEventObj===false)Fit.Validation.ThrowError("Value '"+val+"' is not an instance of Event")};Fit.Validation.ExpectInstance=function(val,instanceType,allowNotSet){if(allowNotSet===true&&(val===undefined||val===null))return;if(val instanceof instanceType===true||Fit.Core.Extends(val,instanceType)===true)return;Fit.Validation.ThrowError("Unsupported object type passed")};Fit.Validation.ExpectIsSet=function(val){if(Fit.Validation.IsSet(val)===false)Fit.Validation.ThrowError("Value not set")};Fit.Validation.IsSet=function(obj){return obj!==null&&obj!==undefined};Fit.Validation.ThrowError=function(msg){if(Fit._internal.Validation.DebugMode===true){var stackTrace=Fit.Validation.GetStackTrace();alert("ThrowError: "+msg+(stackTrace!==""?"\n\n":"")+stackTrace);if(window.console&&console.trace)console.trace()}throw new Error(msg)};Fit.Validation.GetStackTrace=function(){if(window.Error===undefined||Error.captureStackTrace===undefined)return"";var obj={};Error.captureStackTrace(obj,Fit.Validation.GetStackTrace);return obj.stack};Fit.Validation.Enabled=function(val){if(Fit.Validation.IsSet(val)===true){if(val===true){Fit._internal.Validation.DebugMode=true;if(Fit._internal.Validation.Clone!==null)Fit.Validation=Fit.Core.Clone(Fit._internal.Validation.Clone)}else{Fit._internal.Validation.DebugMode=false;if(Fit._internal.Validation.Clone===null)Fit._internal.Validation.Clone=Fit.Core.Clone(Fit.Validation);for(var f in Fit.Validation)if(f.indexOf("Expect")===0)Fit.Validation[f]=function(){}}}return Fit._internal.Validation.DebugMode===true};Fit._internal.Validation.IsCollectionType=function(val){if(!window.StaticNodeList)window.StaticNodeList=function(){};if(!window.FileList)window.FileList=function(){};if(val===null||val===undefined)return false;else if(val instanceof Array)return true;else if(val instanceof NodeList)return true;else if(val instanceof StaticNodeList)return true;else if(val instanceof HTMLCollection)return true;else if(val instanceof FileList)return true;else if(val instanceof StyleSheetList)return true;else if(val instanceof CSSRuleList)return true;else if(val.callee&&val.length!==null&&val.length!==undefined)return true;return false};Fit.Array={};Fit.Array.ForEach=function(obj,callback){Fit.Validation.ExpectFunction(callback);if(Fit._internal.Validation.IsCollectionType(obj)===true){var count=obj.length;var res=false;for(var i=0;i<obj.length;i++){res=callback(obj[i]);if(obj.length!==count)Fit.Validation.ThrowError("Collection was modified while iterating objects");if(res===false)return false}}else if(typeof obj==="object"){for(var i in obj)if(callback(i)===false)return false}return true};Fit.Array.Count=function(obj){if(Fit._internal.Validation.IsCollectionType(obj)===true){return obj.length}else if(typeof obj==="object"){var count=0;for(var i in obj)count++;return count}Fit.Validation.ThrowError("Unsupported collection type passed - unable to determine number of contained elements")};Fit.Array.Recurse=function(arr,childrenProperty,callback){Fit.Validation.ExpectCollection(arr,true);Fit.Validation.ExpectStringValue(childrenProperty);Fit.Validation.ExpectFunction(callback);if(Fit.Validation.IsSet(arr)===false)return true;var count=arr.length;for(var i=0;i<arr.length;i++){if(arr.length!==count)Fit.Validation.ThrowError("Collection was modified while iterating objects");if(callback(arr[i])===false)return false;if(Fit.Validation.IsSet(arr[i][childrenProperty])===false)continue;if(arr[i][childrenProperty]instanceof Function){if(Fit.Array.Recurse(arr[i][childrenProperty](),childrenProperty,callback)===false)return false}else{if(Fit.Array.Recurse(arr[i][childrenProperty],childrenProperty,callback)===false)return false}}return true};Fit.Array.CustomRecurse=function(arr,callback){Fit.Validation.ExpectFunction(callback);if(arr!==undefined&&arr!==null&&Fit._internal.Validation.IsCollectionType(arr)===false)Fit.Validation.ThrowError("Unexpected collection type passed");Fit.Array.ForEach(arr,function(o){Fit.Array.CustomRecurse(callback(o),callback)})};Fit.Array.Add=function(arr,obj){Fit.Validation.ExpectArray(arr);arr.push(obj)};Fit.Array.Insert=function(arr,idx,obj){Fit.Validation.ExpectArray(arr);Fit.Validation.ExpectInteger(idx);arr.splice(idx,0,obj)};Fit.Array.Merge=function(arr1,arr2){Fit.Validation.ExpectArray(arr1);Fit.Validation.ExpectArray(arr2);return arr1.concat(arr2)};Fit.Array.Remove=function(arr,obj){Fit.Validation.ExpectArray(arr);var idx=Fit.Array.GetIndex(arr,obj);if(idx!==-1)arr.splice(idx,1)};Fit.Array.RemoveAt=function(arr,idx){Fit.Validation.ExpectArray(arr);Fit.Validation.ExpectInteger(idx);arr.splice(idx,1)};Fit.Array.Clear=function(arr){Fit.Validation.ExpectArray(arr);arr.length=0};Fit.Array.GetIndex=function(arr,obj){Fit.Validation.ExpectArray(arr);for(var i=0;i<arr.length;i++)if(arr[i]===obj)return i;return-1};Fit.Array.GetKeys=function(obj){var keys=[];if(Fit._internal.Validation.IsCollectionType(obj)===true){for(var i=0;i<obj.length;i++){keys.push(i)}}else if(typeof obj==="object"){for(var i in obj){keys.push(i)}}return keys};Fit.Array.Contains=function(arr,obj){Fit.Validation.ExpectArray(arr);return Fit.Array.GetIndex(arr,obj)>-1};Fit.Array.Copy=function(arr){Fit.Validation.ExpectCollection(arr);var newArr=[];Fit.Array.ForEach(arr,function(item){newArr.push(item)});return newArr};Fit.Array.ToArray=function(coll){Fit.Validation.ExpectCollection(coll);var arr=[];for(var i=0;i<coll.length;i++)arr.push(coll[i]);return arr};Fit.Browser={};Fit._internal.Browser={};Fit.Browser.GetBrowser=function(){var agent=navigator.userAgent;if(agent.indexOf("Edge/")>-1)return"Edge";if(agent.indexOf("Chrome")>-1)return"Chrome";if(agent.indexOf("Safari")>-1)return"Safari";if(agent.indexOf("MSIE")>-1||agent.indexOf("Trident")>-1)return"MSIE";if(agent.indexOf("Firefox")>-1)return"Firefox";if(agent.indexOf("Opera")>-1)return"Opera";return"Unknown"};Fit.Browser.GetVersion=function(){var start=0;var end=0;var agent=navigator.userAgent;if(Fit.Browser.GetBrowser()==="Edge"){start=agent.indexOf("Edge/");start=start!==-1?start+5:0;end=agent.indexOf(".",start);end=end!==-1?end:0}if(Fit.Browser.GetBrowser()==="Chrome"){start=agent.indexOf("Chrome/");start=start!==-1?start+7:0;end=agent.indexOf(".",start);end=end!==-1?end:0}if(Fit.Browser.GetBrowser()==="Safari"){start=agent.indexOf("Version/");start=start!==-1?start+8:0;end=agent.indexOf(".",start);end=end!==-1?end:0}if(Fit.Browser.GetBrowser()==="MSIE"){if(agent.indexOf("MSIE")>-1){start=agent.indexOf("MSIE ");start=start!==-1?start+5:0;end=agent.indexOf(".",start);end=end!==-1?end:0}else if(agent.indexOf("Trident")>-1){start=agent.indexOf("rv:");start=start!==-1?start+3:0;end=agent.indexOf(".",start);end=end!==-1?end:0}}if(Fit.Browser.GetBrowser()==="Firefox"){start=agent.indexOf("Firefox/");start=start!==-1?start+8:0;end=agent.indexOf(".",start);end=end!==-1?end:0}if(Fit.Browser.GetBrowser()==="Opera"){start=agent.indexOf("Version/");start=start!==-1?start+8:-1;if(start===-1){start=agent.indexOf("Opera/");start=start!==-1?start+6:-1}if(start===-1){start=agent.indexOf("Opera ");start=start!==-1?start+6:-1}end=agent.indexOf(".",start);end=end!==-1?end:0}if(start!==0&&start!==0)return parseInt(agent.substring(start,end));return-1};Fit.Browser.GetQueryString=function(alternativeUrl){Fit.Validation.ExpectString(alternativeUrl,true);var qs={Url:null,Parameters:{},Anchor:null};var url=alternativeUrl!==undefined?alternativeUrl:location.href;var params=url.indexOf("?")>-1?url.split("?")[1]:"";var anchor=null;params=params.indexOf("#")>-1?params.split("#")[0]:params;anchor=url.indexOf("#")>-1?url.split("#")[1]:null;qs.Url=url;qs.Anchor=anchor;Fit.Array.ForEach(params!==""?params.split("&"):[],function(p){var keyval=p.split("=");try{qs.Parameters[keyval[0]]=keyval.length>1?decodeURIComponent(keyval[1]):""}catch(err){qs.Parameters[keyval[0]]=keyval.length>1?keyval[1]:""}});return qs};Fit.Browser.GetLanguage=function(){var lang=null;if(navigator.language)lang=navigator.language.toLowerCase();else if(navigator.browserLanguage)lang=navigator.browserLanguage.toLowerCase();if(lang===null||lang==="")return"en";if(lang.length===2)return lang;if(lang.length===5)return lang.substring(0,2);return"en"};Fit.Browser.GetPageWidth=function(){var w=0;if(window.innerWidth)w=window.innerWidth;else if(document.documentElement&&document.documentElement.clientWidth)w=document.documentElement.clientWidth;return w};Fit.Browser.GetPageHeight=function(){var h=0;if(window.innerHeight)h=window.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)h=document.documentElement.clientHeight;return h};Fit.Browser.GetViewPortDimensions=function(){return{Width:Fit.Browser.GetPageWidth(),Height:Fit.Browser.GetPageHeight()}};Fit.Browser.GetScrollPosition=function(){var x=document.body.scrollLeft||document.documentElement.scrollLeft||window.pageXOffset||0;var y=document.body.scrollTop||document.documentElement.scrollTop||window.pageYOffset||0;return{X:x,Y:y}};Fit.Browser.GetScreenWidth=function(onlyAvailable){Fit.Validation.ExpectBoolean(onlyAvailable,true);if(onlyAvailable===true)return window.screen.availWidth;return window.screen.width};Fit.Browser.GetScreenHeight=function(onlyAvailable){Fit.Validation.ExpectBoolean(onlyAvailable,true);if(onlyAvailable===true)return window.screen.availHeight;return window.screen.height};Fit.Browser.GetScreenDimensions=function(onlyAvailable){Fit.Validation.ExpectBoolean(onlyAvailable,true);return{Width:Fit.Browser.GetScreenWidth(onlyAvailable),Height:Fit.Browser.GetScreenHeight(onlyAvailable)}};Fit.Browser.IsMobile=function(includeTablets){Fit.Validation.ExpectBoolean(includeTablets,true);var nav=navigator.userAgent||navigator.vendor;if(includeTablets!==false&&/android|ipad|playbook|silk/i.test(nav))return true;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(nav)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(nav.substr(0,4))};Fit.Browser.Log=function(msg){if(window.console)console.log(msg)};Fit.Browser.GetInfo=function(){if(!Fit._internal.Browser.Info){Fit._internal.Browser.Info={};Fit._internal.Browser.Info.Name=Fit.Browser.GetBrowser();Fit._internal.Browser.Info.Version=Fit.Browser.GetVersion();Fit._internal.Browser.Info.Language=Fit.Browser.GetLanguage();Fit._internal.Browser.Info.IsMobile=Fit.Browser.IsMobile();Fit._internal.Browser.Info.IsPhone=Fit.Browser.IsMobile(false);Fit._internal.Browser.Info.IsTablet=Fit.Browser.IsMobile()===true&&Fit.Browser.IsMobile(false)===false}return Fit.Core.Clone(Fit._internal.Browser.Info)};Fit.Browser.IsStorageSupported=function(){if(Fit._internal.Browser.StorageSupported===undefined){Fit._internal.Browser.StorageSupported=false;try{if(window.localStorage&&window.sessionStorage){var x="__FITUITEST__";localStorage.setItem(x,x);localStorage.removeItem(x);sessionStorage.setItem(x,x);sessionStorage.removeItem(x);Fit._internal.Browser.StorageSupported=true}}catch(err){}}return Fit._internal.Browser.StorageSupported};Fit.Controls={};Fit._internal.Controls={};Fit._internal.ControlBase={Controls:{}};Fit.Controls.ControlBase=function(controlId){Fit.Validation.ExpectStringValue(controlId);if(Fit._internal.ControlBase.Controls[controlId]!==undefined)Fit.Validation.ThrowError("Control with ID '"+controlId+"' has already been defined - Control IDs must be unique!");Fit._internal.ControlBase.Controls[controlId]=this;this.Value=function(val){Fit.Validation.ThrowError("Not implemented")};this.IsDirty=function(){Fit.Validation.ThrowError("Not implemented")};this.Clear=function(){Fit.Validation.ThrowError("Not implemented")};this.Focused=function(val){Fit.Validation.ThrowError("Not implemented")};var me=this;var id=controlId;var container=null;var width={Value:200,Unit:"px"};var height={Value:-1,Unit:"px"};var scope=null;var required=false;var orgDirtyFunction=null;var validationExpr=null;var validationError=null;var validationErrorType=-1;var validationCallbackFunc=null;var validationCallbackError=null;var lazyValidation=false;var hasValidated=false;var blockAutoPostBack=false;var onChangeHandlers=[];var onFocusHandlers=[];var onBlurHandlers=[];var hasFocus=false;var onBlurTimeout=null;var ensureFocusFires=false;var waitingForFocus=false;var txtValue=null;var txtDirty=null;var txtValid=null;var isIe8=Fit.Browser.GetInfo().Name==="MSIE"&&Fit.Browser.GetInfo().Version===8;function init(){Fit._internal.Core.EnsureStyles();container=document.createElement("div");container.id=id;container.style.width=width.Value+width.Unit;Fit.Dom.AddClass(container,"FitUiControl");me._internal.Data("focused","false");me._internal.Data("valid","true");me._internal.Data("dirty","false");me._internal.Data("device",Fit.Browser.GetInfo().IsMobile===false?"Desktop":Fit.Browser.GetInfo().IsPhone===true?"Phone":"Tablet");txtValue=document.createElement("textarea");txtValue.style.display="none";txtValue.name="FitUIValue"+me.GetId();Fit.Dom.Add(container,txtValue);txtDirty=document.createElement("input");txtDirty.type="hidden";txtDirty.name="FitUIDirty"+me.GetId();Fit.Dom.Add(container,txtDirty);txtValid=document.createElement("input");txtValid.type="hidden";txtValid.name="FitUIValid"+me.GetId();Fit.Dom.Add(container,txtValid);me.OnChange(function(sender){if(blockAutoPostBack===false&&me.AutoPostBack()===true&&document.forms.length>0){setTimeout(function(){blockAutoPostBack=true;document.forms[0].submit();setTimeout(function(){blockAutoPostBack=false},500)},0)}});if(Fit.Browser.GetBrowser()!=="MSIE"||Fit.Browser.GetVersion()>=9){Fit.Events.AddHandler(container,"focus",true,onFocusIn);Fit.Events.AddHandler(container,"blur",true,onFocusOut)}else{container.onfocusin=onFocusIn;container.onfocusout=onFocusOut}me.OnBlur(function(sender){if(lazyValidation===true)me._internal.Validate(true)})}this.AutoPostBack=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){me._internal.Data("autopost",val.toString())}return me._internal.Data("autopost")==="true"};this.GetId=function(){return id};this.GetDomElement=function(){if(hasValidated===false){hasValidated=true;me._internal.Validate();updateInternalState()}return container};this.Dispose=function(){Fit.Dom.Remove(container);me=id=container=width=height=scope=required=validationExpr=validationError=validationErrorType=validationCallbackFunc=validationCallbackError=lazyValidation=hasValidated=blockAutoPostBack=onChangeHandlers=onFocusHandlers=onBlurHandlers=hasFocus=onBlurTimeout=ensureFocusFires=waitingForFocus=txtValue=txtDirty=txtValid=isIe8=null;delete Fit._internal.ControlBase.Controls[controlId]};this.Width=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){if(val>-1){width={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};container.style.width=width.Value+width.Unit}else{width={Value:200,Unit:"px"};container.style.width=""}}return width};this.Height=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){height={Value:val,Unit:Fit.Validation.IsSet(unit)===true&&val!==-1?unit:"px"};if(height.Value>-1)container.style.height=height.Value+height.Unit;else container.style.height=""}return height};this.AddCssClass=function(val){Fit.Validation.ExpectStringValue(val);Fit.Dom.AddClass(container,val)};this.RemoveCssClass=function(val){Fit.Validation.ExpectStringValue(val);Fit.Dom.RemoveClass(container,val)};this.HasCssClass=function(val){Fit.Validation.ExpectStringValue(val);return Fit.Dom.HasClass(container,val)};this.Visible=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true)container.style.display=val===true?"":"none";return container.style.display!=="none"};this.Required=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){required=val;me._internal.Validate()}return required};this.Scope=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){if(val==="")scope=null;else scope=val}return scope};this.AlwaysDirty=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(val===true&&orgDirtyFunction===null){orgDirtyFunction=this.IsDirty;this.IsDirty=function(){return true};updateInternalState()}else if(val===false&&orgDirtyFunction!==null){this.IsDirty=orgDirtyFunction;orgDirtyFunction=null;updateInternalState()}}return orgDirtyFunction!==null};this.Render=function(toElement){Fit.Validation.ExpectDomElement(toElement,true);if(Fit.Validation.IsSet(toElement)===true){Fit.Dom.Add(toElement,me.GetDomElement())}else{var script=document.scripts[document.scripts.length-1];Fit.Dom.InsertBefore(script,me.GetDomElement())}};this.SetValidationExpression=function(regEx,errorMsg){Fit.Validation.ExpectRegExp(regEx,true);Fit.Validation.ExpectString(errorMsg,true);validationExpr=regEx?regEx:null;validationError=errorMsg?errorMsg:null;me._internal.Validate()};this.SetValidationCallback=function(cb,errorMsg){Fit.Validation.ExpectFunction(cb,true);Fit.Validation.ExpectString(errorMsg,true);validationCallbackFunc=cb?cb:null;validationCallbackError=errorMsg?errorMsg:null;me._internal.Validate()};this.IsValid=function(){validationErrorType=-1;if(validationExpr===null&&validationCallbackFunc===null&&required===false)return true;var obj=me.Value();var val=Fit.Validation.IsSet(obj)===true?obj.toString():"";if(required===true&&val===""){validationErrorType=0;return false}if(validationExpr!==null&&validationExpr.test(val)===false){validationErrorType=1;return false}if(validationCallbackFunc!==null&&validationCallbackFunc(val)===false){validationErrorType=2;return false}return true};this.LazyValidation=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){lazyValidation=val;if(lazyValidation===true){me._internal.Data("valid","true");me._internal.Data("errormessage",null)}}return lazyValidation};this.OnChange=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onChangeHandlers,cb)};this.OnFocus=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onFocusHandlers,cb)};this.OnBlur=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onBlurHandlers,cb)};function onFocusIn(e){if(onBlurTimeout!==null){clearTimeout(onBlurTimeout);onBlurTimeout=null}if(waitingForFocus===true){waitingForFocus=false;return}if(hasFocus===true)return;hasFocus=true;ensureFocusFires=true;setTimeout(function(){if(me===null)return;ensureFocusFires=false;me._internal.FireOnFocus()},0)}function onFocusOut(e){var fireBlur=null;fireBlur=function(){if(me===null)return;if(ensureFocusFires===true){waitingForFocus=true;onBlurTimeout=setTimeout(fireBlur,0);return}onBlurTimeout=null;waitingForFocus=false;hasFocus=false;me._internal.FireOnBlur()};onBlurTimeout=setTimeout(fireBlur,0)}function updateInternalState(){txtValue.value=me.Value().toString();txtDirty.value=me.IsDirty()===true?"1":"0";txtValid.value=me.IsValid()===true?"1":"0";me._internal.Data("dirty",me.IsDirty()===true?"true":"false")}this._internal=this._internal?this._internal:{};this._internal.FireOnChange=function(){hasValidated=true;me._internal.Validate();updateInternalState();Fit.Array.ForEach(onChangeHandlers,function(cb){cb(me)})},this._internal.FireOnFocus=function(){me._internal.Data("focused","true");me._internal.Repaint();Fit.Array.ForEach(onFocusHandlers,function(cb){cb(me)})},this._internal.FireOnBlur=function(){me._internal.Data("focused","false");me._internal.Repaint();Fit.Array.ForEach(onBlurHandlers,function(cb){cb(me)})},this._internal.ExecuteWithNoOnChange=function(cb){Fit.Validation.ExpectFunction(cb);var onChangeHandler=me._internal.FireOnChange;me._internal.FireOnChange=function(){};var error=null;try{cb()}catch(err){error=err.message}me._internal.FireOnChange=onChangeHandler;if(error!==null)Fit.Validation.ThrowError(error)};this._internal.Data=function(key,val){Fit.Validation.ExpectStringValue(key);Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true||val===null)Fit.Dom.Data(container,key,val);return Fit.Dom.Data(container,key)},this._internal.AddDomElement=function(elm){Fit.Validation.ExpectDomElement(elm);Fit.Dom.InsertBefore(txtValue,elm)},this._internal.RemoveDomElement=function(elm){Fit.Validation.ExpectDomElement(elm);Fit.Dom.Remove(elm)},this._internal.Validate=function(force){Fit.Validation.ExpectBoolean(force,true);if(lazyValidation===true&&me.Focused()===false&&force!==true)return;var valid=me.IsValid();me._internal.Data("valid",valid.toString());if(valid===false){if(validationErrorType===0)me._internal.Data("errormessage",Fit.Language.Translations.Required);else if(validationErrorType===1&&validationError!==null)me._internal.Data("errormessage",validationError.replace("\r","").replace(/<br.*>/i,"\n"));else if(validationErrorType===2&&validationCallbackError!==null)me._internal.Data("errormessage",validationCallbackError.replace("\r","").replace(/<br.*>/i,"\n"))}else{me._internal.Data("errormessage",null)}me._internal.Repaint()};this._internal.Repaint=function(f){Fit.Validation.ExpectFunction(f,true);var cb=Fit.Validation.IsSet(f)===true?f:function(){};if(isIe8===false){cb()}else{Fit.Dom.AddClass(me.GetDomElement(),"FitUi_Non_Existing_ControlBase_Class");Fit.Dom.RemoveClass(me.GetDomElement(),"FitUi_Non_Existing_ControlBase_Class");setTimeout(function(){cb();Fit.Dom.AddClass(me.GetDomElement(),"FitUi_Non_Existing_ControlBase_Class");Fit.Dom.RemoveClass(me.GetDomElement(),"FitUi_Non_Existing_ControlBase_Class")},0)}};init()};Fit.Controls.Find=function(id){Fit.Validation.ExpectStringValue(id);return Fit._internal.ControlBase.Controls[id]!==undefined?Fit._internal.ControlBase.Controls[id]:null};Fit.Controls.ValidateAll=function(scope){Fit.Validation.ExpectStringValue(scope,true);var result=true;Fit.Array.ForEach(Fit._internal.ControlBase.Controls,function(controlId){var control=Fit._internal.ControlBase.Controls[controlId];if(Fit.Core.InstanceOf(control,Fit.Controls.ControlBase)===false)return;if(Fit.Validation.IsSet(scope)===true&&control.Scope()!==scope)return;control._internal.Validate(true);if(control.IsValid()===false)result=false});return result};Fit.Controls.DirtyCheckAll=function(scope){Fit.Validation.ExpectStringValue(scope,true);var result=false;Fit.Array.ForEach(Fit._internal.ControlBase.Controls,function(controlId){var control=Fit._internal.ControlBase.Controls[controlId];if(Fit.Core.InstanceOf(control,Fit.Controls.ControlBase)===false)return;if(Fit.Validation.IsSet(scope)===true&&control.Scope()!==scope)return;if(control.IsDirty()===true){result=true;return false}});return result};Fit.Cookies=function(){var me=this;var path=location.pathname.match(/^.*\//)[0];var prefix="";function init(){path=path.substring(0,path.length-1)}this.Path=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){path=val}return path};this.Prefix=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){prefix=val}return prefix};this.Set=function(name,value,seconds){Fit.Validation.ExpectStringValue(name);Fit.Validation.ExpectString(name);Fit.Validation.ExpectInteger(seconds,true);Fit.Cookies.Set(prefix+name,value,seconds,path)};this.Get=function(name){Fit.Validation.ExpectStringValue(name);return Fit.Cookies.Get(prefix+name)};this.Remove=function(name){Fit.Validation.ExpectStringValue(name);Fit.Cookies.Set(prefix+name,"",-1,path)};init()};Fit.Cookies.Set=function(name,value,seconds,path){Fit.Validation.ExpectStringValue(name);Fit.Validation.ExpectString(name);Fit.Validation.ExpectInteger(seconds,true);Fit.Validation.ExpectStringValue(path,true);if(value.indexOf(";")>-1)Fit.Validation.ThrowError("Unable to set cookie - value contains illegal character: ';'");value=value.replace(/\n/g,"\\n");var date=null;if(Fit.Validation.IsSet(seconds)===true){date=new Date;date.setTime(date.getTime()+seconds*1e3)}document.cookie=name+"="+value+(date!==null?"; expires="+date.toGMTString():"")+"; path="+(Fit.Validation.IsSet(path)===true?path+(path[path.length-1]!=="/"?"/":""):"/")};Fit.Cookies.Get=function(name){Fit.Validation.ExpectStringValue(name);var cookieName=name+"=";var cookies=document.cookie.split(";");var cookie=null;for(var i=0;i<cookies.length;i++){cookie=cookies[i];while(cookie.charAt(0)===" ")cookie=cookie.substring(1,cookie.length);if(cookie.indexOf(cookieName)===0)return cookie.substring(cookieName.length,cookie.length).replace(/\\n/g,"\n")}return null};Fit.Cookies.Remove=function(name,path){Fit.Validation.ExpectStringValue(name);Fit.Validation.ExpectStringValue(path,true);Fit.Cookies.Set(name,"",-1,path)};Fit.Data={};Fit.Data.CreateGuid=function(dashFormat){Fit.Validation.ExpectBoolean(dashFormat,true);var chars="0123456789abcdef".split("");var uuid=new Array;var rnd=Math.random;var r=-1;if(dashFormat!==false)uuid[8]="-";if(dashFormat!==false)uuid[13]="-";uuid[14]="4";if(dashFormat!==false)uuid[18]="-";if(dashFormat!==false)uuid[23]="-";var length=32+(dashFormat!==false?4:0);for(var i=0;i<length;i++){if(uuid[i]!==undefined)continue;r=0|rnd()*16;uuid[i]=chars[i===19?r&3|8:r&15]}return uuid.join("")};Fit.Math={};Fit.Math.MidpointRounding={Up:"Up",Down:"Down",AwayFromZero:"AwayFromZero"};Fit.Math.Round=function(value,precision,midpointRounding){Fit.Validation.ExpectNumber(value);Fit.Validation.ExpectInteger(precision,true);if(Fit.Validation.IsSet(midpointRounding)===true&&Fit.Validation.IsSet(Fit.Math.MidpointRounding[midpointRounding])===false)Fit.Validation.ThrowError("Unsupported MidpointRounding specified - use e.g. Fit.Math.MidpointRounding.Up");var decimals=Fit.Validation.IsSet(precision)===true?precision:0;var mpr=midpointRounding?midpointRounding:Fit.Math.MidpointRounding.AwayFromZero;var factor=1;for(var i=0;i<decimals;i++)factor=factor*10;var res=null;if(mpr===Fit.Math.MidpointRounding.Up){res=Math.round(value*factor)/factor}else if(mpr===Fit.Math.MidpointRounding.AwayFromZero){res=(value<0?-1:1)*Math.round(Math.abs(value*factor))/factor}else{res=-1*Math.round(-1*value*factor)/factor}return res};Fit.Math.Format=function(value,decimals,decimalSeparator){Fit.Validation.ExpectNumber(value);Fit.Validation.ExpectInteger(decimals,true);Fit.Validation.ExpectString(decimalSeparator,true);var res=Fit.Math.Round(value,decimals);if(decimals<=0)return res.toString();var str=res%1===0?res.toString()+".0":res.toString();for(var i=str.split(".")[1].length;i<decimals;i++)str+="0";return Fit.Validation.IsSet(decimalSeparator)===true?str.replace(".",decimalSeparator):str};Fit.String={};Fit.String.Trim=function(str){Fit.Validation.ExpectString(str);return str.replace(/^\s+|\s+$/g,"")};Fit.String.StripHtml=function(str){Fit.Validation.ExpectString(str);return str.replace(/(<([^>]+)>)/g,"")};Fit.String.EncodeHtml=function(str){Fit.Validation.ExpectString(str);return str.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};Fit.String.DecodeHtml=function(str){Fit.Validation.ExpectString(str);return str.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#039;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};Fit.String.Hash=function(str){Fit.Validation.ExpectString(str);if(str.length==0)return 0;var hash=0;var chr="";for(var i=0;i<str.length;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash=hash&hash}return hash};Fit.String.UpperCaseFirst=function(str){Fit.Validation.ExpectString(str);if(str==="")return str;return str[0].toUpperCase()+str.slice(1)};Fit.Date={};Fit.Date.Format=function(date,format){Fit.Validation.ExpectDate(date);Fit.Validation.ExpectString(format);format=format.replace(/YYYY/g,date.getFullYear().toString());format=format.replace(/YY/g,date.getFullYear().toString().substring(2));format=format.replace(/Y/g,parseInt(date.getFullYear().toString().substring(2),10).toString());format=format.replace(/MM/g,(date.getMonth()+1<=9?"0":"")+(date.getMonth()+1));format=format.replace(/M/g,(date.getMonth()+1).toString());format=format.replace(/DD/g,(date.getDate()<=9?"0":"")+date.getDate());format=format.replace(/D/g,date.getDate().toString());format=format.replace(/W/g,Fit.Date.GetWeek(date).toString());format=format.replace(/hh/g,(date.getHours()<=9?"0":"")+date.getHours());format=format.replace(/h/g,date.getHours().toString());format=format.replace(/mm/g,(date.getMinutes()<=9?"0":"")+date.getMinutes());format=format.replace(/m/g,date.getMinutes().toString());format=format.replace(/ss/g,(date.getSeconds()<=9?"0":"")+date.getSeconds());format=format.replace(/s/g,date.getSeconds().toString());return format};Fit.Date.Parse=function(strDate,format){Fit.Validation.ExpectString(strDate);Fit.Validation.ExpectString(format);var regEx=format;regEx=regEx.replace(/Y{1,4}/,"\\d{4}");regEx=regEx.replace(/M{1,2}/,"\\d{1,2}");regEx=regEx.replace(/D{1,2}/,"\\d{1,2}");regEx=regEx.replace(/h{1,2}/,"\\d{1,2}");regEx=regEx.replace(/m{1,2}/,"\\d{1,2}");regEx=regEx.replace(/s{1,2}/,"\\d{1,2}");regEx=regEx.replace(/\//g,"\\/");regEx="^"+regEx+"$";var regExp=new RegExp(regEx);if(regExp.test(strDate)===false)throw"InvalidDateFormat - Value '"+strDate+"' does not match format '"+format+"'";var regex=/\d+/g;var match=null;var matches=[];while((match=regex.exec(strDate))!==null){Fit.Array.Add(matches,match[0])}var date=new Date;var parts=[{Name:"Year",Key:"Y",Index:-1,Value:date.getFullYear()},{Name:"Month",Key:"M",Index:-1,Value:date.getMonth()+1},{Name:"Day",Key:"D",Index:-1,Value:date.getDate()},{Name:"Hours",Key:"h",Index:-1,Value:date.getHours()},{Name:"Minutes",Key:"m",Index:-1,Value:date.getMinutes()},{Name:"Seconds",Key:"s",Index:-1,Value:date.getSeconds()}];parts.getVal=function(key){var res=null;Fit.Array.ForEach(this,function(part){if(key===part.Key){res=part.Value;return false}});return res};Fit.Array.ForEach(parts,function(part){part.Index=format.indexOf(part.Key)});parts.sort(function(a,b){return(a.Index!==-1?a.Index:999999)-(b.Index!==-1?b.Index:999999)});var idx=-1;Fit.Array.ForEach(parts,function(part){if(part.Index!==-1){idx++;if(idx>matches.length-1)throw"InvalidDateFormat - "+part.Name+" not found in value";part.Value=parseInt(matches[idx],10);if(part.Key==="Y"&&part.Value<1e3)throw"InvalidDataFormat - value '"+part.Value+"' is not valid for '"+part.Name+"'";if(part.Key==="M"&&(part.Value<0||part.Value>12))throw"InvalidDataFormat - value '"+part.Value+"' is not valid for '"+part.Name+"'";if(part.Key==="D"&&(part.Value<0||part.Value>31))throw"InvalidDataFormat - value '"+part.Value+"' is not valid for '"+part.Name+"'";if(part.Key==="h"&&(part.Value<0||part.Value>23))throw"InvalidDataFormat - value '"+part.Value+"' is not valid for '"+part.Name+"'";if((part.Key==="m"||part.Key==="s")&&(part.Value<0||part.Value>59))throw"InvalidDataFormat - value '"+part.Value+"' is not valid for '"+part.Name+"'";if(part.Key==="M")part.Value=part.Value-1}});var dt=new Date(parts.getVal("Y"),parts.getVal("M"),parts.getVal("D",true),0,0,0);dt.setHours(parseInt(parts.getVal("h"),10));dt.setMinutes(parseInt(parts.getVal("m"),10));dt.setSeconds(parseInt(parts.getVal("s"),10));return dt};Fit.Date.GetWeek=function(date){Fit.Validation.ExpectDate(date);var d=new Date(date.getTime());d.setHours(0,0,0);d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1);var week=Math.ceil(((d.getTime()-yearStart.getTime())/(24*60*60*1e3)+1)/7);return week};Fit.Color={};Fit.Color.RgbToHex=function(r,g,b){Fit.Validation.ExpectNumber(r);Fit.Validation.ExpectNumber(g);Fit.Validation.ExpectNumber(b);if(r<0||r>255||g<0||g>255||b<0||b>255)return null;var rHex=r.toString(16);var gHex=g.toString(16);var bHex=b.toString(16);return("#"+(rHex.length===1?"0":"")+rHex+(gHex.length===1?"0":"")+gHex+(bHex.length===1?"0":"")+bHex).toUpperCase()};Fit.Color.HexToRgb=function(hex){Fit.Validation.ExpectString(hex);var rgb=Fit.Color.ParseHex(hex);if(rgb===null)return null;return"rgb("+rgb.Red+", "+rgb.Green+", "+rgb.Blue+")"};Fit.Color.ParseHex=function(hex){Fit.Validation.ExpectString(hex);var result=hex.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(result===null)return null;return{Red:parseInt(result[1],16),Green:parseInt(result[2],16),Blue:parseInt(result[3],16)}};Fit.Color.ParseRgb=function(val){Fit.Validation.ExpectString(val);var result=val.match(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(\s*,\s*(\d*.*\d+))*/);if(result===null)return null;var c={};c.Red=parseInt(result[1],10);c.Green=parseInt(result[2],10);c.Blue=parseInt(result[3],10);c.Alpha=result[5]!==undefined?parseFloat(result[5]):1;return c};Fit.Dom={};Fit._internal.Dom={};Fit.Dom.AddClass=function(elm,cls){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectStringValue(cls);if(Fit.Dom.HasClass(elm,cls)===false)elm.className+=(elm.className!==""?" ":"")+cls};Fit.Dom.RemoveClass=function(elm,cls){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectStringValue(cls);var arr=elm.className.split(" ");var newCls="";Fit.Array.ForEach(arr,function(item){if(item!==cls)newCls+=(newCls!==""?" ":"")+item});elm.className=newCls};Fit.Dom.HasClass=function(elm,cls){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectStringValue(cls);var arr=elm.className.split(" ");var found=false;Fit.Array.ForEach(arr,function(item){if(item===cls){found=true;return false}});return found};Fit.Dom.GetComputedStyle=function(elm,style){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectStringValue(style);var res=null;if(window.getComputedStyle){res=window.getComputedStyle(elm)[style]}else if(elm.currentStyle){if(style.indexOf("-")!==-1){var items=style.split("-");style="";Fit.Array.ForEach(items,function(i){if(style==="")style=i;else style+=Fit.String.UpperCaseFirst(i)})}res=elm.currentStyle[style];if(res!==undefined&&res!==null&&/^\d+/.test(res)===true&&res.toLowerCase().indexOf("px")===-1){var orgLeft=elm.style.left;var runtimeStyle=elm.runtimeStyle.left;elm.runtimeStyle.left=elm.currentStyle.left;elm.style.left=style==="fontSize"?"1em":res||0;res=elm.style.pixelLeft+"px";elm.style.left=orgLeft;elm.runtimeStyle.left=runtimeStyle}}return res!==undefined?res:null};Fit.Dom.GetInnerDimensions=function(elm){Fit.Validation.ExpectDomElement(elm);var width=elm.offsetWidth;var height=elm.offsetHeight;if(width!==0){width-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"padding-left"));width-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"padding-right"));width-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"border-left-width"));width-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"border-right-width"))}if(height!==0){height-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"padding-top"));height-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"padding-bottom"));height-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"border-top-width"));height-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"border-bottom-width"))}return{X:Math.floor(width),Y:Math.floor(height)}};Fit.Dom.GetInnerWidth=function(elm){Fit.Validation.ExpectDomElement(elm);return Fit.Dom.GetInnerDimensions(elm).X};Fit.Dom.IsRooted=function(elm){Fit.Validation.ExpectNode(elm);var parent=elm.parentElement;while(parent!==null){if(parent===document.body)return true;parent=parent.parentElement}return false};Fit.Dom.InsertBefore=function(target,newElm){Fit.Validation.ExpectNode(target);Fit.Validation.ExpectNode(newElm);if(target.parentElement===null)Fit.Validation.ThrowError("Unable to insert element - target is not rooted");target.parentElement.insertBefore(newElm,target)};Fit.Dom.InsertAfter=function(target,newElm){Fit.Validation.ExpectNode(target);Fit.Validation.ExpectNode(newElm);if(target.parentElement===null)Fit.Validation.ThrowError("Unable to insert element - target is not rooted");if(target.nextSibling)target.parentElement.insertBefore(newElm,target.nextSibling);else target.parentElement.appendChild(newElm)};Fit.Dom.InsertAt=function(container,position,newElm){Fit.Validation.ExpectDomElement(container);Fit.Validation.ExpectInteger(position);Fit.Validation.ExpectNode(newElm);if(container.children.length===0||container.children.length-1<position){container.appendChild(newElm)}else{var before=container.children[position];if(before)Fit.Dom.InsertBefore(before,newElm)}};Fit.Dom.Replace=function(oldElm,newElm){Fit.Validation.ExpectNode(oldElm);Fit.Validation.ExpectNode(newElm);if(oldElm.parentElement===null)Fit.Validation.ThrowError("Unable to replace element - not rooted");var container=oldElm.parentElement;container.replaceChild(newElm,oldElm)};Fit.Dom.Add=function(container,elm){Fit.Validation.ExpectDomElement(container);Fit.Validation.ExpectNode(elm);container.appendChild(elm)};Fit.Dom.Remove=function(elm){Fit.Validation.ExpectNode(elm);if(elm.parentElement===null)return;elm.parentElement.removeChild(elm)};Fit.Dom.Attribute=function(elm,name,value){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectStringValue(name);Fit.Validation.ExpectString(value,true);if(Fit.Validation.IsSet(value)===true)elm.setAttribute(name,value);else if(value===null)elm.removeAttribute(name);return elm.getAttribute(name)};Fit.Dom.Data=function(elm,name,value){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectStringValue(name);Fit.Validation.ExpectString(value,true);return Fit.Dom.Attribute(elm,"data-"+name,value)};Fit.Dom.CreateElement=function(html,containerTagName){Fit.Validation.ExpectString(html);Fit.Validation.ExpectStringValue(containerTagName,true);if(Fit.String.Trim(html).toLowerCase().indexOf("<tr")===0){html=Fit.String.Trim(html);var container=document.createElement("div");container.innerHTML="<table><tbody>"+html+"</tbody></table>";if(container.firstChild.firstChild.children.length===1)return container.firstChild.firstChild.firstChild;return container.firstChild}else if(Fit.String.Trim(html).toLowerCase().indexOf("<td")===0){html=Fit.String.Trim(html);var container=document.createElement("div");container.innerHTML="<table><tbody><tr>"+html+"</tr></tbody></table>";if(container.firstChild.firstChild.firstChild.children.length===1)return container.firstChild.firstChild.firstChild.firstChild;return container.firstChild.firstChild.firstChild}else{var container=document.createElement(Fit.Validation.IsSet(containerTagName)===true?containerTagName:"div");container.innerHTML=html;if(container.childNodes.length===1)return container.firstChild;return container}};Fit.Dom.Text=function(elm,value){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectString(value,true);if(Fit.Validation.IsSet(value)===true){if(elm.textContent)elm.textContent=value;else elm.innerText=value}return elm.textContent?elm.textContent:elm.innerText};Fit.Dom.GetIndex=function(elm){Fit.Validation.ExpectDomElement(elm);if(!elm.parentElement)return-1;var parent=elm.parentElement;for(var i=0;i<parent.children.length;i++)if(parent.children[i]===elm)return i;return-1};Fit.Dom.GetDepth=function(elm){Fit.Validation.ExpectNode(elm);var i=0;var parent=elm.parentElement;while(parent){i++;parent=parent.parentElement}return i};Fit.Dom.Contained=function(container,elm){Fit.Validation.ExpectDomElement(container);Fit.Validation.ExpectNode(elm);var parent=elm.parentElement;while(parent){if(parent===container)return true;parent=parent.parentElement}return false};Fit.Dom.IsVisible=function(elm){Fit.Validation.ExpectNode(elm);if(elm.nodeType===8)return false;if(elm.nodeType===3){if(elm.parentElement===null)return false;elm=elm.parentElement}if(Fit._internal.Dom.IsOffsetParentSupported()===true&&Fit.Dom.GetComputedStyle(elm,"position")!=="fixed"&&elm!==document.body&&elm!==document.body.parentElement){return elm.offsetParent!==null}var element=elm;var previous=null;while(element!==null){if(Fit.Dom.GetComputedStyle(element,"display")==="none")return false;previous=element;element=element.parentElement}return previous===document.documentElement};Fit.Dom.GetConcealer=function(elm){Fit.Validation.ExpectNode(elm);if(elm.nodeType===8)return elm;if(Fit.Dom.IsVisible(elm)===true)return null;if(elm.nodeType===3)elm=elm.parentElement;var element=elm;while(element!==null){if(Fit.Dom.GetComputedStyle(element,"display")==="none")return element;element=element.parentElement}return null};Fit.Dom.GetFocused=function(){var focused=null;try{focused=document.activeElement;if(!focused.nodeType)focused=document.body}catch(err){focused=document.body}return focused};Fit.Dom.GetParentOfType=function(element,parentType){Fit.Validation.ExpectNode(element);Fit.Validation.ExpectStringValue(parentType);var parent=element.parentElement;while(parent!==null){if(parent.tagName.toLowerCase()===parentType.toLowerCase())return parent;parent=parent.parentElement}return null};Fit.Dom.Wrap=function(elementToWrap,container){Fit.Validation.ExpectNode(elementToWrap);Fit.Validation.ExpectDomElement(container);var parent=elementToWrap.parentElement;var nextSibling=elementToWrap.nextSibling;container.appendChild(elementToWrap);if(parent===null)return;if(nextSibling===null)parent.appendChild(container);else parent.insertBefore(container,nextSibling)};Fit.Dom.GetPosition=function(elm,relativeToViewport){return Fit._internal.Dom.GetPosition(elm,relativeToViewport)};Fit._internal.Dom.GetPosition=function(elm,relativeToViewport,internalKeepMargin){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectBoolean(relativeToViewport,true);Fit.Validation.ExpectBoolean(internalKeepMargin,true);if(Fit.Dom.IsVisible(elm)===false)return null;var pos={X:0,Y:0};var rect=elm.getBoundingClientRect();pos.X=rect.left;pos.Y=rect.top;if(internalKeepMargin!==true){pos.X-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"margin-left"));pos.Y-=Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(elm,"margin-top"))}if(relativeToViewport===true){pos.X=Math.round(pos.X);pos.Y=Math.round(pos.Y);return pos}pos.X+=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;pos.Y+=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;pos.X=Math.round(pos.X);pos.Y=Math.round(pos.Y);return pos};Fit.Dom.GetRelativePosition=function(elm){Fit.Validation.ExpectDomElement(elm);if(Fit.Dom.GetComputedStyle(elm,"position")==="fixed"){return Fit.Dom.GetPosition(elm)}if(Fit.Dom.IsVisible(elm)===false)return null;var pos=Fit.Dom.GetPosition(elm);var offsetParent=elm.offsetParent;while(offsetParent!==null&&Fit.Dom.GetComputedStyle(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent}offsetParent=offsetParent||document.documentElement;if(offsetParent!==document.documentElement){var offsetParentPos=Fit._internal.Dom.GetPosition(offsetParent,false,true);if(Fit.Browser.GetInfo().Name==="Firefox"&&offsetParent.tagName==="TABLE"||Fit.Browser.GetInfo().Name==="MSIE"&&Fit.Browser.GetInfo().Version>=10&&offsetParent.tagName==="TABLE"||Fit.Browser.GetInfo().Name==="Edge"&&offsetParent.tagName==="TABLE"){pos.X=pos.X-offsetParentPos.X;pos.Y=pos.Y-offsetParentPos.Y}else{pos.X=pos.X-(offsetParentPos.X+Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(offsetParent,"border-left-width")));pos.Y=pos.Y-(offsetParentPos.Y+Fit._internal.Dom.GetPx(Fit.Dom.GetComputedStyle(offsetParent,"border-top-width")))}}return pos};Fit.Dom.GetScrollPosition=function(elm){Fit.Validation.ExpectNode(elm);var pos={X:0,Y:0};if(elm.nodeType!==1)elm=elm.parentElement;while(elm){pos.X+=elm.scrollLeft;pos.Y+=elm.scrollTop;elm=elm.parentElement}pos.X=Math.floor(pos.X);pos.Y=Math.floor(pos.Y);return pos};Fit._internal.Dom.IsOffsetParentSupported=function(){if(Fit._internal.Dom.OffsetParentSupported===undefined){var parent=document.createElement("div");var child=document.createElement("div");parent.style.display="none";Fit.Dom.Add(document.body,parent);Fit.Dom.Add(parent,child);Fit._internal.Dom.OffsetParentSupported=child.offsetParent===null;Fit.Dom.Remove(parent)}return Fit._internal.Dom.OffsetParentSupported};Fit._internal.Dom.GetPx=function(val){val=val?parseInt(val):0;if(isNaN(val)===true)val=0;return val};Fit.DragDrop={};Fit.DragDrop.Draggable=function(domElm,domTriggerElm){Fit.Validation.ExpectElementNode(domElm);Fit.Validation.ExpectElementNode(domTriggerElm,true);var elm=domElm;var trgElm=domTriggerElm?domTriggerElm:null;var me=this;var onDragStart=null;var onDragging=null;var onDragStop=null;function init(){Fit._internal.Core.EnsureStyles();Fit.Dom.AddClass(elm,"FitDragDropDraggable");Fit.Events.AddHandler(trgElm!==null?trgElm:elm,"mousedown",function(e){var ev=e||window.event;if(Fit.DragDrop.Draggable._internal.active!==null)return;Fit.Dom.AddClass(elm,"FitDragDropDragging");var mouseXviewport=ev.clientX||e.pageX;var mouseYviewport=ev.clientY||e.pageY;Fit.DragDrop.Draggable._internal.zIndex++;elm.style.zIndex=Fit.DragDrop.Draggable._internal.zIndex;var state={Draggable:me,Positioning:Fit.Dom.GetComputedStyle(elm,"position")==="absolute"?"absolute":"relative",Mouse:{Viewport:{X:-1,Y:-1},Document:{X:-1,Y:-1}},Position:{Viewport:{X:-1,Y:-1},Document:{X:-1,Y:-1},Offset:{X:-1,Y:-1}},Events:{OnDragStart:onDragStart,OnDragging:onDragging,OnDragStop:onDragStop},OnSelectStart:document.onselectstart};document.onselectstart=function(){return false};state.Mouse.Viewport.X=mouseXviewport;state.Mouse.Viewport.Y=mouseYviewport;var scrollPos=Fit.Dom.GetScrollPosition(elm);state.Mouse.Document.X=mouseXviewport+scrollPos.X;state.Mouse.Document.Y=mouseYviewport+scrollPos.Y;state.Position.Viewport=Fit.Dom.GetPosition(elm,true);state.Position.Document=Fit.Dom.GetPosition(elm);var offsetX=Fit.Dom.GetComputedStyle(elm,"left");var offsetY=Fit.Dom.GetComputedStyle(elm,"top");state.Position.Offset.X=offsetX.indexOf("px")>-1?parseInt(offsetX):0;state.Position.Offset.Y=offsetY.indexOf("px")>-1?parseInt(offsetY):0;Fit.DragDrop.Draggable._internal.active=state;if(Fit.Dom.HasClass(elm,"FitDragDropDropZone")===true){var draggableDropZone=null;Fit.Array.ForEach(Fit.DragDrop.DropZone._internal.dropzones,function(dzState){if(dzState.DropZone.GetElement()===elm){draggableDropZone=dzState;return false}});Fit.Array.Remove(Fit.DragDrop.DropZone._internal.dropzones,draggableDropZone);Fit.Array.Add(Fit.DragDrop.DropZone._internal.dropzones,draggableDropZone)}if(state.Events.OnDragStart)state.Events.OnDragStart(elm)});if(Fit.DragDrop.Draggable._internal.mouseUpRegistered===false){Fit.DragDrop.Draggable._internal.mouseUpRegistered=true;Fit.Events.AddHandler(document,"mouseup",function(e){if(Fit.DragDrop.Draggable._internal.active===null)return;var ev=e||window.event;var draggableState=Fit.DragDrop.Draggable._internal.active;var draggable=Fit.DragDrop.Draggable._internal.active.Draggable;var dropzoneState=Fit.DragDrop.DropZone._internal.active;var dropzone=dropzoneState!==null?dropzoneState.DropZone:null;Fit.Dom.RemoveClass(draggable.GetElement(),"FitDragDropDragging");Fit.DragDrop.Draggable._internal.active=null;if(dropzoneState!==null){Fit.Dom.RemoveClass(dropzone.GetElement(),"FitDragDropDropZoneActive");Fit.DragDrop.DropZone._internal.active=null;if(dropzoneState.OnDrop)dropzoneState.OnDrop(dropzone,draggable)}if(draggableState.Events.OnDragStop)draggableState.Events.OnDragStop(draggable);document.onselectstart=draggableState.OnSelectStart})}if(Fit.DragDrop.Draggable._internal.mouseMoveRegistered===false){Fit.DragDrop.Draggable._internal.mouseMoveRegistered=true;Fit.Events.AddHandler(document,"mousemove",function(e){if(Fit.DragDrop.Draggable._internal.active===null)return;var ev=e||window.event;var state=Fit.DragDrop.Draggable._internal.active;var draggable=state.Draggable;var elm=draggable.GetElement();var mouseXviewport=ev.clientX||e.pageX;var mouseYviewport=ev.clientY||e.pageY;var scrollPos=Fit.Dom.GetScrollPosition(elm);var mouseXdocument=mouseXviewport+scrollPos.X;var mouseYdocument=mouseYviewport+scrollPos.Y;if(Fit.DragDrop.Draggable._internal.active.Positioning==="absolute"){var mouseFromLeft=state.Mouse.Viewport.X-state.Position.Viewport.X;var mouseFromTop=state.Mouse.Viewport.Y-state.Position.Viewport.Y;elm.style.position="absolute";elm.style.left=mouseXdocument-mouseFromLeft+"px";elm.style.top=mouseYdocument-mouseFromTop+"px"}else{var mouseXmoved=mouseXdocument-state.Mouse.Document.X;var mouseYmoved=mouseYdocument-state.Mouse.Document.Y;var elementLeft=state.Position.Offset.X;var elementTop=state.Position.Offset.Y;elm.style.position="relative";elm.style.left=elementLeft+mouseXmoved+"px";elm.style.top=elementTop+mouseYmoved+"px"}if(state.Events.OnDragging)state.Events.OnDragging(elm);var dropzone=null;var dropzoneElement=null;var pos=null;var dropZoneX=-1;var dropZoneY=-1;var previouslyActiveDropZone=Fit.DragDrop.DropZone._internal.active;var dropzoneActive=null;Fit.Array.ForEach(Fit.DragDrop.DropZone._internal.dropzones,function(dzState){dropzone=dzState.DropZone;dropzoneElement=dropzone.GetElement();if(Fit.Dom.IsVisible(dropzoneElement)===false)return;pos=Fit.Dom.GetPosition(dropzoneElement,true);dropZoneX=pos.X;dropZoneY=pos.Y;var dropzoneFound=dropzoneActive===null;var dropzoneDeeperThanPreviouslyFound=dropzoneActive===null||Fit.Dom.GetDepth(dropzoneElement)>Fit.Dom.GetDepth(dropzoneActive.DropZone.GetElement());var dropzoneCurrentlyBeingDragged=Fit.Dom.HasClass(dropzoneElement,"FitDragDropDragging")===true;var draggableHoveringDropZone=mouseXviewport>dropZoneX&&mouseXviewport<dropZoneX+dropzoneElement.offsetWidth&&mouseYviewport>dropZoneY&&mouseYviewport<dropZoneY+dropzoneElement.offsetHeight;if((dropzoneFound===false||dropzoneDeeperThanPreviouslyFound===true)&&dropzoneCurrentlyBeingDragged===false&&draggableHoveringDropZone===true){dropzoneActive=dzState}});if(previouslyActiveDropZone!==null&&dropzoneActive!==previouslyActiveDropZone){Fit.Dom.RemoveClass(previouslyActiveDropZone.DropZone.GetElement(),"FitDragDropDropZoneActive");Fit.DragDrop.DropZone._internal.active=null;if(previouslyActiveDropZone.OnLeave)previouslyActiveDropZone.OnLeave(previouslyActiveDropZone.DropZone)}if(dropzoneActive!==null&&dropzoneActive!==previouslyActiveDropZone){Fit.Dom.AddClass(dropzoneActive.DropZone.GetElement(),"FitDragDropDropZoneActive");Fit.DragDrop.DropZone._internal.active=dropzoneActive;if(dropzoneActive.OnEnter)dropzoneActive.OnEnter(dropzoneActive.DropZone)}})}}this.Reset=function(){elm.style.position="";elm.style.left="";elm.style.top=""};this.GetDomElement=function(){return elm};this.GetElement=this.GetDomElement;this.OnDragStart=function(cb){Fit.Validation.ExpectFunction(cb);onDragStart=cb};this.OnDragging=function(cb){Fit.Validation.ExpectFunction(cb);onDragging=cb};this.OnDragStop=function(cb){Fit.Validation.ExpectFunction(cb);onDragStop=cb};init()};Fit.DragDrop.Draggable._internal={zIndex:1e4,mouseUpRegistered:false,mouseMoveRegistered:false,active:null};Fit.DragDrop.DropZone=function(domElm){Fit.Validation.ExpectElementNode(domElm);var elm=domElm;var cfg={DropZone:this,OnEnter:null,OnDrop:null,OnLeave:null};function init(){Fit._internal.Core.EnsureStyles();Fit.Dom.AddClass(elm,"FitDragDropDropZone");Fit.DragDrop.DropZone._internal.dropzones.push(cfg)}this.GetDomElement=function(){return elm};this.GetElement=this.GetDomElement;this.OnEnter=function(cb){Fit.Validation.ExpectFunction(cb);cfg.OnEnter=cb};this.OnDrop=function(cb){Fit.Validation.ExpectFunction(cb);cfg.OnDrop=cb};this.OnLeave=function(cb){Fit.Validation.ExpectFunction(cb);cfg.OnLeave=cb};init()};Fit.DragDrop.DropZone._internal={dropzones:[],active:null};Fit.Events={};Fit.Events.AddHandler=function(){var element=null;var event=null;var useCapture=false;var eventFunction=null;if(arguments.length===3){element=arguments[0];event=arguments[1];eventFunction=arguments[2]}else if(arguments.length===4){element=arguments[0];event=arguments[1];useCapture=arguments[2];eventFunction=arguments[3]}Fit.Validation.ExpectEventTarget(element);Fit.Validation.ExpectStringValue(event);Fit.Validation.ExpectBoolean(useCapture);Fit.Validation.ExpectFunction(eventFunction);if(event.toLowerCase()==="#rooted"){if(useCapture===true)Fit.Validation.ThrowError("Event capturing is not supported for Rooted event");Fit.Array.Add(Fit._internal.Events.OnRootedHandlers,{Element:element,Parent:element.parentElement,Event:event,Callback:eventFunction})}else if(element.addEventListener){element.addEventListener(event,eventFunction,useCapture)}else if(element.attachEvent){if(event.toLowerCase()==="domcontentloaded"&&Fit._internal.Events.Browser.Name==="MSIE"&&Fit._internal.Events.Browser.Version===8){element.attachEvent("onreadystatechange",function(e){if(element.readyState==="complete"){eventFunction(e)}})}else{element.attachEvent("on"+event,eventFunction)}}element._internal=element._internal||{};element._internal.Events=element._internal.Events||{Handlers:[]};var eventId=element._internal.Events.Handlers.length;Fit.Array.Add(element._internal.Events.Handlers,{Event:event,Handler:eventFunction,UseCapture:useCapture,Id:eventId});if(event.toLowerCase()==="load"&&element.nodeType===9&&element.readyState==="complete"){eventFunction()}else if(event.toLowerCase()==="load"&&(typeof element.contentDocument==="object"&&element.contentDocument!==null)&&element.src&&element.contentDocument.readyState==="complete"){eventFunction()}else if(event.toLowerCase()==="load"&&element===window&&Fit._internal.Events.OnReadyFired===true){eventFunction()}return eventId};Fit.Events.RemoveHandler=function(){var element=null;var event=null;var useCapture=false;var eventFunction=null;if(arguments.length===2){Fit.Validation.ExpectEventTarget(arguments[0]);Fit.Validation.ExpectInteger(arguments[1]);element=arguments[0];var handler=element._internal&&element._internal.Events&&element._internal.Events.Handlers?element._internal.Events.Handlers[arguments[1]]:undefined;if(handler===undefined)Fit.Validation.Throw("No event handler with ID '"+arguments[0]+"' exists for this element");if(handler===null)return;event=handler.Event;eventFunction=handler.Handler;useCapture=handler.UseCapture}else if(arguments.length===3){element=arguments[0];event=arguments[1];eventFunction=arguments[2]}else if(arguments.length===4){element=arguments[0];event=arguments[1];useCapture=arguments[2];eventFunction=arguments[3]}Fit.Validation.ExpectEventTarget(element);Fit.Validation.ExpectStringValue(event);Fit.Validation.ExpectBoolean(useCapture);Fit.Validation.ExpectFunction(eventFunction);if(event.toLowerCase()==="#rooted"){var handlers=Fit._internal.Events.OnRootedHandlers;var remove=null;Fit.Array.ForEach(handlers,function(handler){if(element===handler.Element&&event.toLowerCase()===handler.Event.toLowerCase()&&eventFunction===handler.Callback&&useCapture===false){handler.Removed=true;return false}})}else if(element.removeEventListener){element.removeEventListener(event,eventFunction,useCapture)}else if(element.detachEvent){element.detachEvent("on"+event,eventFunction)}if(arguments.length===2){element._internal.Events.Handlers[arguments[1]]=null}else{for(var i=0;i<element._internal.Events.Handlers.length;i++){var handler=element._internal.Events.Handlers[i];if(handler!==null&&event.toLowerCase()===handler.Event.toLowerCase()&&eventFunction===handler.Handler&&useCapture===handler.UseCapture){element._internal.Events.Handlers[i]=null;break}}}};Fit.Events.PreventDefault=function(e){Fit.Validation.ExpectEvent(e,true);var ev=e||window.event;if((ev.type==="click"||ev.type==="mousedown"||ev.type==="mouseup")&&ev.button===2){var preventContextMenu=Fit.Events.PreventDefault;Fit.Events.AddHandler(document,"contextmenu",true,preventContextMenu);Fit.Events.AddHandler(document,"contextmenu",preventContextMenu);setTimeout(function(){Fit.Events.RemoveHandler(document,"contextmenu",true,preventContextMenu);Fit.Events.RemoveHandler(document,"contextmenu",preventContextMenu)},0)}if(ev.preventDefault)ev.preventDefault();ev.returnValue=false;return false};Fit.Events.StopPropagation=function(e){Fit.Validation.ExpectEvent(e,true);var ev=e||window.event;if(ev.stopPropagation)ev.stopPropagation();ev.cancelBubble=true;return false};Fit.Events.Stop=function(e){Fit.Events.PreventDefault(e);Fit.Events.StopPropagation(e);return false};Fit.Events.GetTarget=function(e){Fit.Validation.ExpectEvent(e,true);var ev=e||window.event;var target=ev.srcElement||ev.target;return target?target:null};Fit.Events.GetEvent=function(e){Fit.Validation.ExpectEvent(e,true);return e||window.event};Fit.Events.GetModifierKeys=function(){if(window.event&&(window.event.type==="keypress"||window.event.type==="keydown"||window.event.type==="keyup")){Fit._internal.Events.KeysDown.Shift=window.event.shiftKey;Fit._internal.Events.KeysDown.Ctrl=window.event.ctrlKey;Fit._internal.Events.KeysDown.Alt=window.event.altKey;Fit._internal.Events.KeysDown.Meta=window.event.metaKey}return Fit.Core.Clone(Fit._internal.Events.KeysDown)};Fit.Events.GetPointerState=function(){if(window.event&&(window.event.type==="click"||window.event.type==="mousedown"||window.event.type==="mouseup")){if(Fit._internal.Events.Browser.Name==="MSIE"&&Fit._internal.Events.Browser.Version===8&&window.event.button===1||window.event.button===0){Fit._internal.Events.Mouse.Buttons.Primary=true;Fit._internal.Events.Mouse.Buttons.Secondary=false}else if(window.event.button===2){Fit._internal.Events.Mouse.Buttons.Secondary=true;Fit._internal.Events.Mouse.Buttons.Primary=false}}var target=Fit._internal.Events.Mouse.Target;Fit._internal.Events.Mouse.Target=null;var obj=Fit.Core.Clone(Fit._internal.Events.Mouse);obj.Target=target;Fit._internal.Events.Mouse.Target=target;return obj};Fit._internal.Events={};Fit._internal.Events.Browser=Fit.Browser.GetInfo();Fit._internal.Events.KeysDown={Shift:false,Ctrl:false,Alt:false,Meta:false,KeyDown:-1,KeyUp:-1};Fit._internal.Events.Mouse={Buttons:{Primary:false,Secondary:false,Touch:false},Coordinates:{ViewPort:{X:-1,Y:-1},Document:{X:-1,Y:-1}},Target:null};Fit._internal.Events.OnReadyHandlers=[];Fit._internal.Events.OnDomReadyHandlers=[];Fit._internal.Events.OnRootedHandlers=[];setInterval(function(){var remove=[];Fit.Array.ForEach(Fit._internal.Events.OnRootedHandlers,function(handler){if(handler.Removed===true){Fit.Array.Add(remove,handler);return}if(Fit.Dom.IsRooted(handler.Element)===true&&handler.Parent!==handler.Element.parentElement){handler.Parent=handler.Element.parentElement;handler.Callback(handler.Element)}});Fit.Array.ForEach(remove,function(handler){Fit.Array.Remove(Fit._internal.Events.OnRootedHandlers,handler)})},100);Fit.Events.AddHandler(document,"keydown",true,function(e){var ev=Fit.Events.GetEvent(e);Fit._internal.Events.KeysDown.Shift=ev.shiftKey;Fit._internal.Events.KeysDown.Ctrl=ev.ctrlKey;Fit._internal.Events.KeysDown.Alt=ev.altKey;Fit._internal.Events.KeysDown.Meta=ev.metaKey;Fit._internal.Events.KeysDown.KeyUp=-1;Fit._internal.Events.KeysDown.KeyDown=ev.keyCode});Fit.Events.AddHandler(document,"keyup",true,function(e){var ev=Fit.Events.GetEvent(e);Fit._internal.Events.KeysDown.Shift=ev.shiftKey;Fit._internal.Events.KeysDown.Ctrl=ev.ctrlKey;Fit._internal.Events.KeysDown.Alt=ev.altKey;Fit._internal.Events.KeysDown.Meta=ev.metaKey;Fit._internal.Events.KeysDown.KeyUp=ev.keyCode;Fit._internal.Events.KeysDown.KeyDown=-1});Fit.Events.AddHandler(document,"mousedown",true,function(e){var ev=Fit.Events.GetEvent(e);if(Fit._internal.Events.Browser.Name==="MSIE"&&Fit._internal.Events.Browser.Version===8&&ev.button===1||ev.button===0){Fit._internal.Events.Mouse.Buttons.Primary=true;Fit._internal.Events.Mouse.Buttons.Secondary=false}else if(ev.button===2){Fit._internal.Events.Mouse.Buttons.Secondary=true;Fit._internal.Events.Mouse.Buttons.Primary=false}Fit._internal.Events.Mouse.Target=Fit.Events.GetTarget(ev)});Fit.Events.AddHandler(document,"mouseup",true,function(e){setTimeout(function(){Fit._internal.Events.Mouse.Buttons.Primary=false;Fit._internal.Events.Mouse.Buttons.Secondary=false;Fit._internal.Events.Mouse.Target=null},0)});Fit.Events.AddHandler(document,"mouseout",true,function(e){Fit._internal.Events.Mouse.Buttons.Primary=false;Fit._internal.Events.Mouse.Buttons.Secondary=false;Fit._internal.Events.Mouse.Target=null});Fit.Events.AddHandler(document,"mousemove",function(e){var ev=Fit.Events.GetEvent(e);if(document.body===null)return;Fit._internal.Events.Mouse.Coordinates.ViewPort.X=Math.floor(ev.clientX);Fit._internal.Events.Mouse.Coordinates.ViewPort.Y=Math.floor(ev.clientY);var scrollPos=Fit.Dom.GetScrollPosition(document.body);Fit._internal.Events.Mouse.Coordinates.Document.X=Fit._internal.Events.Mouse.Coordinates.ViewPort.X+scrollPos.X;Fit._internal.Events.Mouse.Coordinates.Document.Y=Fit._internal.Events.Mouse.Coordinates.ViewPort.Y+scrollPos.Y});Fit.Events.AddHandler(document,"touchstart",true,function(e){var ev=Fit.Events.GetEvent(e);Fit._internal.Events.Mouse.Buttons.Touch=true;Fit._internal.Events.Mouse.Coordinates.ViewPort.X=Math.floor(ev.touches[0].clientX);Fit._internal.Events.Mouse.Coordinates.ViewPort.Y=Math.floor(ev.touches[0].clientY);var scrollPos=Fit.Dom.GetScrollPosition(document.body);Fit._internal.Events.Mouse.Coordinates.Document.X=Fit._internal.Events.Mouse.Coordinates.ViewPort.X+scrollPos.X;Fit._internal.Events.Mouse.Coordinates.Document.Y=Fit._internal.Events.Mouse.Coordinates.ViewPort.Y+scrollPos.Y});Fit.Events.AddHandler(document,"touchend",true,function(e){var ev=Fit.Events.GetEvent(e);Fit._internal.Events.Mouse.Buttons.Touch=false});Fit.Events.AddHandler(document,"touchcancel",true,function(e){var ev=Fit.Events.GetEvent(e);Fit._internal.Events.Mouse.Buttons.Touch=false});Fit.Events.AddHandler(document,"touchmove",function(e){var ev=Fit.Events.GetEvent(e);Fit._internal.Events.Mouse.Coordinates.ViewPort.X=Math.floor(ev.touches[0].clientX);Fit._internal.Events.Mouse.Coordinates.ViewPort.Y=Math.floor(ev.touches[0].clientY);var scrollPos=Fit.Dom.GetScrollPosition(document.body);Fit._internal.Events.Mouse.Coordinates.Document.X=Fit._internal.Events.Mouse.Coordinates.ViewPort.X+scrollPos.X;Fit._internal.Events.Mouse.Coordinates.Document.Y=Fit._internal.Events.Mouse.Coordinates.ViewPort.Y+scrollPos.Y});Fit._internal.Events.MutationObservers=[];Fit._internal.Events.MutationObserverIds=-1;Fit._internal.Events.MutationObserverIntervalId=-1;Fit.Events.AddMutationObserver=function(elm,obs,deep){Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectFunction(obs);Fit.Validation.ExpectBoolean(deep,true);if(Fit._internal.Events.MutationObservers.length===0){Fit.Events.AddHandler(document,"click",Fit._internal.Events.CheckMutations);Fit.Events.AddHandler(document,"mousedown",Fit._internal.Events.CheckMutations);Fit.Events.AddHandler(document,"mouseup",Fit._internal.Events.CheckMutations);Fit.Events.AddHandler(document,"keypress",Fit._internal.Events.CheckMutations);Fit.Events.AddHandler(document,"keyup",Fit._internal.Events.CheckMutations);Fit.Events.AddHandler(document,"touchstart",Fit._internal.Events.CheckMutations);Fit.Events.AddHandler(document,"touchend",Fit._internal.Events.CheckMutations);Fit.Events.AddHandler(document,"touchcancel",Fit._internal.Events.CheckMutations);Fit._internal.Events.MutationObserverIntervalId=setInterval(Fit._internal.Events.CheckMutations,1e3)}var hashCode=0;var dimensions=elm.offsetWidth+"x"+elm.offsetHeight;if(deep===true){hashCode=Fit.String.Hash(elm.outerHTML+dimensions)}else{var clone=elm.cloneNode(false);hashCode=Fit.String.Hash(clone.outerHTML+dimensions)}Fit._internal.Events.MutationObserverIds++;Fit.Array.Add(Fit._internal.Events.MutationObservers,{Element:elm,Observer:obs,Hash:hashCode,Deep:deep===true,Id:Fit._internal.Events.MutationObserverIds});return Fit._internal.Events.MutationObserverIds};Fit.Events.RemoveMutationObserver=function(){var elm,obs,deep,id=undefined;if(arguments.length>1){elm=arguments[0];obs=arguments[1];deep=arguments[2];Fit.Validation.ExpectDomElement(elm);Fit.Validation.ExpectFunction(obs);Fit.Validation.ExpectBoolean(deep,true)}else{id=arguments[0];Fit.Validation.ExpectInteger(id)}var found=null;Fit.Array.ForEach(Fit._internal.Events.MutationObservers,function(mo){if(Fit.Validation.IsSet(id)===true&&mo.Id===id||mo.Element===elm&&mo.Observer===obs&&mo.Deep===(Fit.Validation.IsSet(deep)===true?deep:false)){found=mo;return false}});if(found!==null)Fit.Array.Remove(Fit._internal.Events.MutationObservers,found);if(Fit._internal.Events.MutationObservers.length===0){Fit.Events.RemoveHandler(document,"click",Fit._internal.Events.CheckMutations);Fit.Events.RemoveHandler(document,"mousedown",Fit._internal.Events.CheckMutations);Fit.Events.RemoveHandler(document,"mouseup",Fit._internal.Events.CheckMutations);Fit.Events.RemoveHandler(document,"keypress",Fit._internal.Events.CheckMutations);Fit.Events.RemoveHandler(document,"keyup",Fit._internal.Events.CheckMutations);Fit.Events.RemoveHandler(document,"touchstart",Fit._internal.Events.CheckMutations);Fit.Events.RemoveHandler(document,"touchend",Fit._internal.Events.CheckMutations);Fit.Events.RemoveHandler(document,"touchcancel",Fit._internal.Events.CheckMutations);clearInterval(Fit._internal.Events.MutationObserverIntervalId)}};Fit._internal.Events.CheckMutations=function(){var toRemove=[];Fit.Array.ForEach(Fit._internal.Events.MutationObservers,function(mo){var newHash=0;var dimensions=mo.Element.offsetWidth+"x"+mo.Element.offsetHeight;if(mo.Deep===true){newHash=Fit.String.Hash(mo.Element.outerHTML+dimensions)}else{var clone=mo.Element.cloneNode(false);newHash=Fit.String.Hash(clone.outerHTML+dimensions)}if(mo.Hash!==newHash){mo.Hash=newHash;var orgDisconnect=window.disconnect;window.disconnect=function(){Fit.Array.Add(toRemove,mo)};var error=null;try{mo.Observer(mo.Element)}catch(err){error=err}if(orgDisconnect){window.disconnect=orgDisconnect}else{try{delete window.disconnect}catch(err){window.disconnect=undefined}}if(error!==null)Fit.Validation.Throw(error)}});Fit.Array.ForEach(toRemove,function(mo){Fit.Events.RemoveMutationObserver(mo.Element,mo.Observer,mo.Deep)})};Fit.Events.OnReady=function(callback){Fit.Validation.ExpectFunction(callback);if(Fit._internal.Events.OnReadyFired===true){callback()}else{Fit._internal.Events.OnReadyHandlers.push(callback)}};Fit.Events.AddHandler(window,"load",function(){Fit._internal.Events.OnReadyFired=true;Fit.Array.ForEach(Fit._internal.Events.OnReadyHandlers,function(handler){handler()});Fit.Array.Clear(Fit._internal.Events.OnReadyHandlers)});Fit.Events.OnDomReady=function(callback){Fit.Validation.ExpectFunction(callback);if(Fit._internal.Events.OnDomReadyFired===true){callback()}else{Fit._internal.Events.OnDomReadyHandlers.push(callback)}};Fit.Events.AddHandler(document,"DOMContentLoaded",function(){Fit._internal.Events.OnDomReadyFired=true;Fit.Array.ForEach(Fit._internal.Events.OnDomReadyHandlers,function(handler){handler()});Fit.Array.Clear(Fit._internal.Events.OnDomReadyHandlers)});Fit.Http={};Fit._internal.Http={};Fit._internal.Http.JsonpRequest={};Fit._internal.Http.JsonpRequest.Callbacks={};Fit.Http.Request=function(uri){Fit.Validation.ExpectStringValue(uri);var me=this;var url=uri;var httpRequest=getHttpRequestObject();var customHeaders={};var customProperties={};var data="";var method="";var onStateChange=[];var onRequestHandlers=[];var onSuccessHandlers=[];var onFailureHandlers=[];var onAbortHandlers=[];httpRequest.onreadystatechange=function(){Fit.Array.ForEach(onStateChange,function(handler){handler(me)});if(httpRequest.readyState===4){if(httpRequest.status===0){Fit.Array.ForEach(onAbortHandlers,function(handler){handler(me)})}else if(httpRequest.status>=200&&httpRequest.status<=299){Fit.Array.ForEach(onSuccessHandlers,function(handler){handler(me)})}else{Fit.Array.ForEach(onFailureHandlers,function(handler){handler(me)})}}};this.AddHeader=function(key,value){Fit.Validation.ExpectStringValue(key);Fit.Validation.ExpectString(value);customHeaders[key]=value};this.SetData=function(dataStr){Fit.Validation.ExpectString(dataStr,true);data=Fit.Validation.IsSet(dataStr)===true?dataStr:""};this.GetData=function(){return data};this.AddData=function(key,value,uriEncode){Fit.Validation.ExpectStringValue(key);Fit.Validation.ExpectString(value);Fit.Validation.ExpectBoolean(uriEncode,true);data+=(data!==""?"&":"")+key+"="+(uriEncode===false?value:encodeURIComponent(value).replace(/%20/g,"+"))};this.Method=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){method=val}return method};this.Url=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){url=val}return url};this.Start=function(){var cancel=false;Fit.Array.ForEach(onRequestHandlers,function(handler){if(handler(me)===false)cancel=true});if(cancel===true)return;var httpMethod=method!==""?method:data!==""?"POST":"GET";var async=onStateChange.length>0||onSuccessHandlers.length>0||onFailureHandlers.length>0;httpRequest.open(httpMethod,url,async);var usingCustomHeaders=false;for(var header in customHeaders){httpRequest.setRequestHeader(header,customHeaders[header]);usingCustomHeaders=true}Fit.Array.ForEach(customProperties,function(key){httpRequest[key]=customProperties[key]});if((httpMethod==="POST"||httpMethod==="PUT")&&usingCustomHeaders===false)httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");httpRequest.send(data)};this.Abort=function(){httpRequest.abort()};this.GetResponseXml=function(){return httpRequest.responseXML};this.GetResponseText=function(){return httpRequest.responseText};this.GetResponseJson=function(){return httpRequest.responseText!==""?JSON.parse(httpRequest.responseText):null};this.GetResponse=function(){return(!httpRequest.responseType||httpRequest.responseType==="text")&&typeof httpRequest.responseText==="string"?httpRequest.responseText:httpRequest.response};this.GetCurrentState=function(){return httpRequest.readyState};this.GetHttpStatus=function(){return httpRequest.status};this.GetResponseHeaders=function(){var headers=[];if(httpRequest.getAllResponseHeaders()==="")return headers;Fit.Array.ForEach(Fit.String.Trim(httpRequest.getAllResponseHeaders()).split("\n"),function(h){var info=h.split(":");Fit.Array.Add(headers,{Key:Fit.String.Trim(info[0]),Value:Fit.String.Trim(info[1])})});return headers};this.GetResponseHeader=function(key){Fit.Validation.ExpectString(key);return httpRequest.getResponseHeader(key)};this.OnStateChange=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onStateChange,func)};this.SetStateListener=this.OnStateChange;this.OnRequest=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onRequestHandlers,func)};this.OnSuccess=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onSuccessHandlers,func)};this.OnFailure=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onFailureHandlers,func)};this.OnAbort=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onAbortHandlers,func)};this.RequestProperties=function(propertyObject){Fit.Validation.ExpectObject(propertyObject,true);if(Fit.Validation.IsSet(propertyObject)===true){customProperties=propertyObject}return customProperties};function getHttpRequestObject(){if(window.XMLHttpRequest)return new XMLHttpRequest;else if(window.ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP");throw new Error("Http Request object not supported")}};Fit.Http.JsonRequest=function(url){Fit.Validation.ExpectStringValue(url);Fit.Core.Extend(this,Fit.Http.Request).Apply(url);var me=this;var data=null;function init(){me.AddHeader("Content-Type","application/json; charset=UTF-8");me.AddHeader("X-Requested-With","XMLHttpRequest")}var baseSetData=me.SetData;this.SetData=function(json){Fit.Validation.ExpectIsSet(json);data=json;baseSetData(JSON.stringify(data))};this.GetData=function(dataStr){return data};this.Start=Fit.Core.CreateOverride(this.Start,function(){baseSetData(JSON.stringify(data));base()});this.AddData=function(key,value,uriEncode){Fit.Validation.ThrowError("Use SetData(..) to set JSON request data for JSON WebService")};var baseGetResponseJson=me.GetResponseJson;this.GetResponseJson=function(){var resp=baseGetResponseJson();if(url.toLowerCase().indexOf(".asmx/")!==-1&&resp&&resp.d)resp=resp.d;return resp};init()};Fit.Http.JsonpRequest=function(uri,jsonpCallbackName){Fit.Validation.ExpectStringValue(uri);Fit.Validation.ExpectStringValue(jsonpCallbackName,true);var me=this;var url=uri;var cbKey=Fit.Validation.IsSet(jsonpCallbackName)===true?jsonpCallbackName:"callback";var cbId=null;var data={};var timeout=3e4;var timer=-1;var response=null;var onRequestHandlers=[];var onSuccessHandlers=[];var onTimeoutHandlers=[];this.Url=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){url=val}return url};this.Callback=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){cbKey=val}return cbKey};this.Timeout=function(val){Fit.Validation.ExpectInteger(val,true);if(Fit.Validation.IsSet(val)===true){timeout=val}return timeout};this.SetParameter=function(key,value,uriEncode){Fit.Validation.ExpectStringValue(key);Fit.Validation.ExpectString(value);Fit.Validation.ExpectBoolean(uriEncode,true);data[key]=uriEncode===false?value:encodeURIComponent(value).replace(/%20/g,"+")};this.GetParameter=function(key){Fit.Validation.ExpectString(key);var val=data[key];return val!==undefined?val:null};this.GetParameters=function(){var keys=[];Fit.Array.ForEach(data,function(key){Fit.Array.Add(keys,key)});return keys};this.Start=function(){if(fireEvent(onRequestHandlers)===false)return;response=null;if(timer!==-1){clearTimeout(timer);timer=-1;Fit._internal.Http.JsonpRequest.Callbacks[cbId]=function(response){}}cbId="CB"+Fit.Data.CreateGuid(false);Fit._internal.Http.JsonpRequest.Callbacks[cbId]=function(resp){clearTimeout(timer);timer=-1;response=resp;delete Fit._internal.Http.JsonpRequest.Callbacks[cbId];fireEvent(onSuccessHandlers)};timer=setTimeout(function(){timer=-1;Fit._internal.Http.JsonpRequest.Callbacks[cbId]=function(response){};fireEvent(onTimeoutHandlers)},timeout);var newUrl=url;var cbName="Fit._internal.Http.JsonpRequest.Callbacks."+cbId;newUrl+=(newUrl.indexOf("?")===-1?"?":"&")+cbKey+"="+cbName;Fit.Array.ForEach(data,function(key){newUrl+="&"+key+"="+data[key]});var script=document.createElement("script");script.type="text/javascript";script.src=newUrl;document.getElementsByTagName("head")[0].appendChild(script)};this.GetResponse=function(){return response};this.OnRequest=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onRequestHandlers,func)};this.OnSuccess=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onSuccessHandlers,func)};this.OnTimeout=function(func){Fit.Validation.ExpectFunction(func);Fit.Array.Add(onTimeoutHandlers,func)};function fireEvent(handlers){var canceled=false;Fit.Array.ForEach(handlers,function(handler){if(handler(me)===false)canceled=true});return!canceled}};Fit.Http.DotNetJsonRequest=Fit.Http.JsonRequest;Fit.Language={};Fit.Language.Translations={};Fit.Language.Translations.Required="Field is required";Fit.Language.Translations.InvalidSelection="Invalid selection";Fit.Language.Translations.SelectFile="Select file";Fit.Language.Translations.SelectFiles="Select file(s)";Fit.Language.Translations.Ok="OK";Fit.Language.Translations.Cancel="Cancel";Fit.Loader={};Fit.Loader.ExecuteScript=function(src,onSuccess,onFailure,context){Fit.Validation.ExpectStringValue(src);Fit.Validation.ExpectFunction(onSuccess,true);Fit.Validation.ExpectFunction(onFailure,true);var r=new Fit.Http.Request(src);r.OnSuccess(function(sender){var js=r.GetResponseText();var error=null;if(Fit.Validation.IsSet(context)===false||context===window){try{eval(js)}catch(err){error=err}}else{var args="";var parms="";for(var prop in context?context:{}){args+=(args!==""?", ":"")+prop;parms+=(parms!==""?", ":"")+"this."+prop}try{eval("(function() { (function("+args+") { "+js+" })("+parms+"); })").call(context?context:this)}catch(err){error=err}}if(error===null&&Fit.Validation.IsSet(onSuccess)===true){onSuccess(src)}else if(error!==null){if(window.console){console.log(error.message);console.log(error.stack);console.log(error)}if(Fit.Validation.IsSet(onFailure)===true)onFailure(src)}});r.OnFailure(function(sender){if(Fit.Validation.IsSet(onFailure)===true){onFailure(src)}});r.Start()};Fit.Loader.LoadScript=function(src,callback){Fit.Validation.ExpectStringValue(src);Fit.Validation.ExpectFunction(callback,true);if(arguments.length>2){Fit.Validation.ThrowError("Argument(s) do not match function signature - did you intend to use Fit.Loader.ExecuteScript instead ?")}var script=document.createElement("script");script.type="text/javascript";script.charset="UTF-8";if(Fit.Validation.IsSet(callback)===true&&(Fit.Browser.GetBrowser()!=="MSIE"||Fit.Browser.GetBrowser()==="MSIE"&&Fit.Browser.GetVersion()>=9)){script.onload=function(){callback(src)};script.onerror=function(){callback(src)}}else if(Fit.Validation.IsSet(callback)===true&&Fit.Browser.GetBrowser()==="MSIE"&&Fit.Browser.GetVersion()<=8){script.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded")callback(src)}}script.src=src;document.getElementsByTagName("head")[0].appendChild(script)};Fit.Loader.LoadScripts=function(cfg,callback,skipValidation){Fit.Validation.ExpectArray(cfg);Fit.Validation.ExpectFunction(callback,true);Fit.Validation.ExpectBoolean(skipValidation,true);if(skipValidation!==true){for(var i=0;i<cfg.length;i++){Fit.Validation.ExpectStringValue(cfg[i].source);Fit.Validation.ExpectFunction(cfg[i].loaded,true)}}var toLoad=null;for(var i=0;i<cfg.length;i++){if(cfg[i].handled!==true){toLoad=cfg[i];break}}if(toLoad===null){if(Fit.Validation.IsSet(callback)===true)callback(cfg);return}toLoad.handled=true;Fit.Loader.LoadScript(toLoad.source,function(){if(Fit.Validation.IsSet(toLoad.loaded)===true){try{toLoad.loaded(toLoad)}catch(err){if(window.console){console.log(err.message);console.log(err.stack);console.log(err)}}}Fit.Loader.LoadScripts(cfg,callback,true)})};Fit.Loader.LoadStyleSheet=function(src,callback){Fit.Validation.ExpectStringValue(src);Fit.Validation.ExpectFunction(callback,true);var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";if(Fit.Validation.IsSet(callback)===true&&(Fit.Browser.GetBrowser()!=="MSIE"||Fit.Browser.GetBrowser()==="MSIE"&&Fit.Browser.GetVersion()>=9)){link.onload=function(){callback(src)};link.onerror=function(){callback(src)}}else if(Fit.Validation.IsSet(callback)===true&&Fit.Browser.GetBrowser()==="MSIE"&&Fit.Browser.GetVersion()<=8){link.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded")callback(src)}}link.href=src;document.getElementsByTagName("head")[0].appendChild(link)};Fit.Loader.LoadStyleSheets=function(cfg,callback){Fit.Validation.ExpectArray(cfg);Fit.Validation.ExpectFunction(callback,true);for(var i=0;i<cfg.length;i++){Fit.Validation.ExpectStringValue(cfg[i].source);Fit.Validation.ExpectFunction(cfg[i].loaded,true)}if(cfg.length===0){if(Fit.Validation.IsSet(callback)===true)callback(cfg);return}for(var i=0;i<cfg.length;i++){Fit.Loader.LoadStyleSheet(cfg[i].source,function(src){for(var j=0;j<cfg.length;j++){if(cfg[j].source===src){cfg[j].handled=true;if(Fit.Validation.IsSet(cfg[j].loaded)===true){try{cfg[j].loaded(cfg[j])}catch(err){if(window.console){console.log(err.message);console.log(err.stack);console.log(err)}}}break}}for(var j=0;j<cfg.length;j++){if(cfg[j].handled!==true)return}if(Fit.Validation.IsSet(callback)===true)callback(cfg)})}};Fit.Template=function(refreshable){Fit.Validation.ExpectBoolean(refreshable,true);var me=this;var htmlContent="";var container=null;var elements=[];var eventHandlers=[];function init(){if(refreshable===true)container=document.createElement("div")}this.Content=null;this.LoadHtml=function(htmlSource){Fit.Validation.ExpectString(htmlSource);parse(htmlSource)};this.LoadUrl=function(url,cb){Fit.Validation.ExpectString(url);Fit.Validation.ExpectFunction(cb);var r=new Fit.Http.Request(url);r.OnSuccess(function(sender){parse(r.GetResponseText());cb(me,r.GetResponseText())});r.Start()};this.Reset=function(){parse(htmlContent);eventHandlers=[]};this.GetHtml=function(){return me.toString()};this.Render=function(toElement){Fit.Validation.ExpectDomElement(toElement,true);var html=me.toString();var dom=Fit.Dom.CreateElement("<div>"+html+"</div>");Fit.Array.ForEach(elements,function(elm){var element=dom.querySelector("var.FitTemplate[id='PH"+elm.Id+"']");if(element!==null){Fit.Dom.Replace(element,elm.Element)}});Fit.Array.ForEach(eventHandlers,function(ev){if(ev===null)return;var elm=dom.querySelector("#"+ev.ElementId);if(elm!==null)Fit.Events.AddHandler(elm,ev.EventType,ev.Callback)});var renderTarget=container!==null?container:toElement;var nodes=Fit.Array.Copy(dom.childNodes);if(Fit.Validation.IsSet(renderTarget)===true){Fit.Array.ForEach(nodes,function(n){Fit.Dom.Add(renderTarget,n)})}else{var script=document.scripts[document.scripts.length-1];Fit.Array.ForEach(nodes,function(n){Fit.Dom.InsertBefore(script,n)})}if(container!==null){if(Fit.Validation.IsSet(toElement)===true){Fit.Dom.Add(toElement,container)}else{var script=document.scripts[document.scripts.length-1];Fit.Dom.InsertBefore(script,container)}}};this.AddEventHandler=function(elmId,eventType,cb){Fit.Validation.ExpectStringValue(elmId);Fit.Validation.ExpectStringValue(eventType);Fit.Validation.ExpectFunction(cb);Fit.Array.Add(eventHandlers,{ElementId:elmId,EventType:eventType,Callback:cb});return eventHandlers.length-1};this.RemoveEventHandler=function(eventId){Fit.Validation.ExpectInteger(eventId);if(eventHandlers.length-1>=eventId)eventHandlers[eventId]=null};this.Update=function(){if(container===null)throw"UpdateTemplateError: Template has not been configured to allow updates";var html=me.toString();var dom=Fit.Dom.CreateElement("<div>"+html+"</div>");Fit.Array.ForEach(elements,function(elm){var element=dom.querySelector("var.FitTemplate[id='PH"+elm.Id+"']");if(element!==null){Fit.Dom.Replace(element,elm.Element)}});Fit.Array.ForEach(eventHandlers,function(ev){if(ev===null)return;var elm=dom.querySelector("#"+ev.ElementId);if(elm!==null)Fit.Events.AddHandler(elm,ev.EventType,ev.Callback)});container.innerHTML="";var nodes=Fit.Array.Copy(dom.childNodes);Fit.Array.ForEach(nodes,function(n){Fit.Dom.Add(container,n)})};this.toString=function(){var newHtml=htmlContent;Fit.Array.Clear(elements);Fit.Array.ForEach(me.Content,function(key){var obj=me.Content[key];if(!obj)return;if(obj._internal!==undefined&&obj._internal.IsFitTemplate===true){newHtml=newHtml.replace(obj._internal.Block,obj.toString())}else{if(typeof obj==="object"&&(obj instanceof Element||obj instanceof Text)){var id=Fit.Data.CreateGuid();Fit.Array.Add(elements,{Id:id,Element:obj});newHtml=newHtml.replace("{["+key+"]}","<var class='FitTemplate' id='PH"+id+"'></var>")}else{newHtml=newHtml.replace(new RegExp("{\\["+key+"\\]}","g"),obj)}}});newHtml=newHtml.replace(/\{\[(\S+?)\]\}/g,"");return newHtml};function parse(sourceHtml){Fit.Validation.ExpectString(sourceHtml);htmlContent=sourceHtml;var result={};var lists=handleLists(htmlContent);Fit.Array.ForEach(lists,function(l){result[l]=lists[l]});var placeHolders=handlePlaceHolders(htmlContent);Fit.Array.ForEach(placeHolders,function(ph){result[ph]=placeHolders[ph]});me.Content=result}function handleLists(html){Fit.Validation.ExpectString(html);var regEx=/<!-- LIST (\S+) -->[\S\s]*<!-- \/LIST \1 -->/g;var match;var res={};while(match=regEx.exec(html)){res[match[1]]=createListObject(match[1],match[0])}return res}function handlePlaceHolders(html){Fit.Validation.ExpectString(html);var regExLists=/<!-- LIST (\S+) -->[\S\s]*<!-- \/LIST \1 -->/g;html=html.replace(regExLists,"");var regEx=/\{\[(\S+?)\]\}/g;var match;var res={};while(match=regEx.exec(html)){res[match[1]]=null}return res}function createListObject(name,html){Fit.Validation.ExpectString(name);Fit.Validation.ExpectString(html);var res={_internal:{}};res._internal.Id=name;res._internal.Block=html;res._internal.Html=html.replace("\x3c!-- LIST "+name+" --\x3e","").replace("\x3c!-- /LIST "+name+" --\x3e","");res._internal.Items=[];res._internal.Elements=elements;res._internal.IsFitTemplate=true;res.AddItem=function(){var item=handlePlaceHolders(res._internal.Html);var nestedLists=handleLists(res._internal.Html);Fit.Array.ForEach(nestedLists,function(l){item[l]=nestedLists[l]});Fit.Array.Add(res._internal.Items,item);return item};res.GetItems=function(){return res._internal.Items};res.RemoveItem=function(item){Fit.Array.Remove(res._internal.Items,item)};res.Clear=function(){Fit.Array.Clear(res._internal.Items)};res.toString=function(){var listHtml="";function populateItem(itemHtml,item){Fit.Array.ForEach(item,function(prop){var obj=item[prop];if(!obj)return;if(obj._internal!==undefined&&obj._internal.IsFitTemplate===true){var allSubItems="";Fit.Array.ForEach(obj._internal.Items,function(subItem){allSubItems+=populateItem(obj._internal.Html,subItem)});itemHtml=itemHtml.replace(obj._internal.Block,allSubItems)}else if(typeof obj==="object"&&(obj instanceof Element||obj instanceof Text)){var id=Fit.Data.CreateGuid();Fit.Array.Add(res._internal.Elements,{Id:id,Element:obj});itemHtml=itemHtml.replace("{["+prop+"]}","<var class='FitTemplate' id='PH"+id+"'></var>")}else{itemHtml=itemHtml.replace(new RegExp("{\\["+prop+"\\]}","g"),obj)}});return itemHtml}var itmHtml=res._internal.Html;Fit.Array.ForEach(res._internal.Items,function(item){listHtml+=populateItem(itmHtml,item)});return listHtml};return res}init()};Fit.Controls.Button=function(controlId){Fit.Validation.ExpectStringValue(controlId,true);if(Fit.Validation.IsSet(controlId)===true){if(Fit._internal.ControlBase.Controls[controlId]!==undefined)Fit.Validation.ThrowError("Control with ID '"+controlId+"' has already been defined - Control IDs must be unique!");Fit._internal.ControlBase.Controls[controlId]=this}var me=this;var id=controlId?controlId:null;var element=null;var wrapper=null;var icon=null;var label=null;var width={Value:-1,Unit:"px"};var height={Value:-1,Unit:"px"};var onClickHandlers=[];function init(){Fit._internal.Core.EnsureStyles();element=document.createElement("div");if(id!==null)element.id=id;Fit.Events.AddHandler(element,"click",function(e){if(me.Enabled()===true)me.Click()});Fit.Events.AddHandler(element,"keydown",function(e){var ev=Fit.Events.GetEvent(e);if(me.Enabled()===true&&(ev.keyCode===13||ev.keyCode===32)){me.Click();Fit.Events.PreventDefault(ev)}});Fit.Dom.AddClass(element,"FitUiControl");Fit.Dom.AddClass(element,"FitUiControlButton");wrapper=document.createElement("div");Fit.Dom.Add(element,wrapper);icon=document.createElement("span");Fit.Dom.Add(wrapper,icon);label=document.createElement("span");Fit.Dom.Add(wrapper,label);me.Enabled(true);me.Type(Fit.Controls.ButtonType.Default)}this.GetId=function(){return id};this.Title=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){Fit.Dom.Data(element,"title",val!==""?val:null);label.innerHTML=val}return Fit.Dom.Data(element,"title")!==null?Fit.Dom.Data(element,"title"):""};this.Icon=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){Fit.Dom.Data(element,"icon",val!==""?val:null);icon.className=val!==""?"fa "+(val.indexOf("fa-")!==0?"fa-":"")+val:""}return Fit.Dom.Data(element,"icon")!==null?Fit.Dom.Data(element,"icon"):""};this.Type=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){if(Fit.Validation.IsSet(Fit.Controls.ButtonType[val])===false)Fit.Validation.ThrowError("Unsupported button type specified - use e.g. Fit.Controls.ButtonType.Default");Fit.Dom.Data(element,"type",val)}return Fit.Dom.Data(element,"type")};this.Enabled=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){Fit.Dom.Data(element,"enabled",val===true?"true":"false");element.tabIndex=val===true?0:-1}return Fit.Dom.Data(element,"enabled")==="true"};this.Focused=function(focus){Fit.Validation.ExpectBoolean(focus,true);if(Fit.Validation.IsSet(focus)===true){if(focus===true)element.focus();else element.blur()}return Fit.Dom.GetFocused()===element||Fit.Dom.GetFocused()&&Fit.Dom.Contained(element,Fit.Dom.GetFocused())};this.Width=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){if(val>-1){width={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};element.style.width=width.Value+width.Unit}else{width={Value:-1,Unit:"px"};element.style.width=""}}return width};this.Height=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){if(val>-1){height={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};element.style.height=height.Value+height.Unit;wrapper.style.position="relative"}else{height={Value:-1,Unit:"px"};element.style.height="";wrapper.style.position=""}}return height};this.OnClick=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onClickHandlers,cb)};this.Click=function(){Fit.Array.ForEach(onClickHandlers,function(handler){handler(me)})};this.GetDomElement=function(){return element};this.Render=function(toElement){Fit.Validation.ExpectDomElement(toElement,true);if(Fit.Validation.IsSet(toElement)===true){Fit.Dom.Add(toElement,element)}else{var script=document.scripts[document.scripts.length-1];Fit.Dom.InsertBefore(script,element)}};this.Dispose=function(){Fit.Dom.Remove(element);me=id=element=wrapper=icon=label=width=height=onClickHandlers=null;if(Fit.Validation.IsSet(controlId)===true)delete Fit._internal.ControlBase.Controls[controlId]};init()};Fit.Controls.ButtonType={Default:"Default",Primary:"Primary",Success:"Success",Info:"Info",Warning:"Warning",Danger:"Danger"};Fit.Controls.Button.Type=Fit.Controls.ButtonType;Fit.Controls.CheckBox=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.ControlBase).Apply(ctlId);var me=this;var checkbox=null;var label=null;var width={Value:-1,Unit:"px"};var orgChecked=false;var isIe8=Fit.Browser.GetInfo().Name==="MSIE"&&Fit.Browser.GetInfo().Version===8;function init(){me.AddCssClass("FitUiControlCheckBox");me.GetDomElement().tabIndex=0;checkbox=document.createElement("div");Fit.Dom.AddClass(checkbox,"fa");Fit.Dom.AddClass(checkbox,"fa-check");Fit.Events.AddHandler(me.GetDomElement(),"click",function(e){if(me.Enabled()===true){me.Checked(!me.Checked(),true)}});Fit.Events.AddHandler(me.GetDomElement(),"keydown",function(e){var ev=Fit.Events.GetEvent(e);if(me.Enabled()===true&&ev.keyCode===32){me.Checked(!me.Checked(),true);Fit.Events.PreventDefault(ev)}});label=document.createElement("span");me._internal.AddDomElement(checkbox);me._internal.AddDomElement(label);me.Enabled(true);me.Checked(false);me.Width(-1)}this.Focused=function(focus){Fit.Validation.ExpectBoolean(focus,true);if(Fit.Validation.IsSet(focus)===true){if(focus===true)me.GetDomElement().focus();else me.GetDomElement().blur()}return Fit.Dom.GetFocused()===me.GetDomElement()||Fit.Dom.GetFocused()&&Fit.Dom.Contained(me.GetDomElement(),Fit.Dom.GetFocused())};this.Value=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){var valStr=val.toLowerCase();if(valStr==="true"){me.Checked(true)}else if(valStr==="false"){me.Checked(false)}}return me.Checked()===true?"true":"false"};this.Checked=function(val,preserveDirtyState){Fit.Validation.ExpectBoolean(val,true);Fit.Validation.ExpectBoolean(preserveDirtyState,true);if(Fit.Validation.IsSet(val)===true){var before=Fit.Dom.Data(me.GetDomElement(),"checked")==="true";Fit.Dom.Data(me.GetDomElement(),"checked",val.toString());if(preserveDirtyState!==true)orgChecked=Fit.Dom.Data(me.GetDomElement(),"checked")==="true";if(before!==val){repaint();me._internal.FireOnChange()}}return Fit.Dom.Data(me.GetDomElement(),"checked")==="true"};this.Width=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){if(val>-1){width={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};me.GetDomElement().style.width=width.Value+width.Unit}else{width={Value:-1,Unit:"px"};me.GetDomElement().style.width=""}}return width};this.IsDirty=function(){return orgChecked!==me.Checked()};this.Clear=function(){me.Checked(false)};this.Dispose=Fit.Core.CreateOverride(this.Dispose,function(){me=checkbox=label=width=orgChecked=isIe8=null;base()});this.IsValid=Fit.Core.CreateOverride(this.IsValid,function(){if(me.Required()===true&&me.Checked()===false){return false}return base()});this._internal.Validate=Fit.Core.CreateOverride(this._internal.Validate,function(){if(me.Required()===true&&me.Checked()===false){me._internal.Data("errormessage",Fit.Language.Translations.Required)}base()});this.Label=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){label.innerHTML=val}return label.innerHTML};this.Enabled=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){Fit.Dom.Data(me.GetDomElement(),"enabled",val.toString());me.GetDomElement().tabIndex=val===true?0:-1}return Fit.Dom.Data(me.GetDomElement(),"enabled")==="true"};function repaint(){if(isIe8===true){var focused=Fit.Dom.GetFocused();var elm=document.createElement("");Fit.Dom.Replace(checkbox,elm);Fit.Dom.Replace(elm,checkbox);if(Fit.Dom.GetFocused()!==focused)focused.focus()}}init()};Fit.Controls.ContextMenu=function(){var me=this;var tree=new Fit.Controls.TreeView("ContextMenuTreeView_"+Fit.Data.CreateGuid());var prevFocused=null;var detectBoundaries=true;var highlightOnInitKeyStroke=true;var isIe8=Fit.Browser.GetInfo().Name==="MSIE"&&Fit.Browser.GetInfo().Version===8;var onShowing=[];var onShown=[];var onHide=[];var onSelect=[];function init(){Fit._internal.Core.EnsureStyles();Fit.Dom.Data(tree.GetDomElement(),"keynav","false");Fit.Dom.Data(tree.GetDomElement(),"sticky","false");Fit.Dom.Data(tree.GetDomElement(),"viewportcollision","false");tree.AddCssClass("FitUiControlContextMenu");tree.Selectable(true);tree.KeyboardNavigation(false);Fit.Events.AddHandler(tree.GetDomElement(),"keydown",function(e){var ev=Fit.Events.GetEvent(e);if(ev.keyCode===27){me.Hide();if(prevFocused!==null){prevFocused.focus();prevFocused=null}return}var node=tree.GetNodeFocused();if(node===null)return;if(highlightOnInitKeyStroke===true){highlightOnInitKeyStroke=false;Fit.Dom.Data(tree.GetDomElement(),"keynav","true");repaint();if(ev.keyCode===40&&tree.GetChildren().length>0){tree.GetChildren()[0].Focused(true);Fit.Events.PreventDefault(ev);return}}if(ev.keyCode===37){if(node.Expanded()===true){node.Expanded(false)}else if(node.GetParent()!==null){node.GetParent().Focused(true)}Fit.Events.PreventDefault(ev);return}if(ev.keyCode===39){if(node.GetChildren().length>0){node.Expanded(true);node.GetChildren()[0].Focused(true)}Fit.Events.PreventDefault(ev);return}if(ev.keyCode===38){var newNode=tree.GetNodeAbove(node);if(newNode!==null)newNode.Focused(true);Fit.Events.PreventDefault(ev);return}if(ev.keyCode===40){var newNode=tree.GetNodeBelow(node);if(newNode!==null)newNode.Focused(true);Fit.Events.PreventDefault(ev);return}if(ev.keyCode===13){if(node.Selectable()===true)node.Selected(true);return}});tree.OnSelected(function(sender,node){if(node.Selected()===true){node.Selected(false);node.Expanded(!node.Expanded());var links=node.GetDomElement().getElementsByTagName("a");if(links.length===1&&Fit.Dom.GetParentOfType(links[0],"li")===node.GetDomElement()){if(links[0]!==Fit.Events.GetPointerState().Target)links[0].click();me.Hide()}else{fireEventHandlers(onSelect,node.GetDomElement()._internal.ContextMenuItem)}}});tree.OnToggled(function(sender,node){if(node.Expanded()===false){Fit.Array.ForEach(node.GetChildren(),function(c){c.Expanded(false)})}else{if(node.Focused()===true){Fit.Dom.Data(tree.GetDomElement(),"sticky","true");highlightOnInitKeyStroke=false;var expanded=null;var currentNode=node;while(currentNode!==null){if(currentNode.GetParent()!==null)expanded=getExpandedChild(currentNode.GetParent().GetChildren(),currentNode);else expanded=getExpandedChild(tree.GetChildren(),currentNode);if(expanded!==null){expanded.Expanded(false);break}currentNode=currentNode.GetParent()}}if(node.GetParent()!==null)node.GetParent().Expanded(true);if(detectBoundaries===true)handleViewPortCollision(node.GetDomElement())}});Fit.Events.AddHandler(tree.GetDomElement(),"mouseover",function(e){if(detectBoundaries===true&&Fit.Dom.Data(tree.GetDomElement(),"sticky")==="false"){var elm=Fit.Events.GetTarget(e);elm=elm.tagName==="LI"?elm:Fit.Dom.GetParentOfType(elm,"li");if(elm!==null)handleViewPortCollision(elm)}});Fit.Events.AddHandler(tree.GetDomElement(),"click",function(e){Fit.Events.StopPropagation(e)})}this.Show=function(x,y){Fit.Validation.ExpectInteger(x,true);Fit.Validation.ExpectInteger(y,true);if(fireEventHandlers(onShowing)===false)return;if(Fit._internal.ContextMenu.Current!==null&&Fit._internal.ContextMenu.Current!==me&&Fit._internal.ContextMenu.Current.IsVisible()===true){Fit._internal.ContextMenu.Current.Hide();Fit._internal.ContextMenu.Current=null}var pos=Fit.Events.GetPointerState().Coordinates.Document;var posX=Fit.Validation.IsSet(x)===true?x:pos.X;var posY=Fit.Validation.IsSet(y)===true?y:pos.Y;tree.GetDomElement().style.left=posX+"px";tree.GetDomElement().style.top=posY+"px";tree.GetDomElement().style.width="auto";if(me.IsVisible()===false){Fit.Dom.Add(document.body,tree.GetDomElement());Fit._internal.ContextMenu.Current=me}Fit.Array.Recurse(tree.GetChildren(),"GetChildren",function(child){Fit.Dom.Data(child.GetDomElement(),"deep","false");if(child.GetChildren().length>0){if(child.GetParent()!==null)Fit.Dom.Data(child.GetParent().GetDomElement(),"deep","true");else Fit.Dom.Data(child.GetTreeView().GetDomElement().children[0].children[0],"deep","true")}});if(detectBoundaries===true){var treeElm=tree.GetDomElement();Fit.Dom.Data(treeElm,"viewportcollision","false");if(Fit.Browser.GetViewPortDimensions().Height<posY-Fit.Dom.GetScrollPosition(document.body).Y+treeElm.offsetHeight){Fit.Dom.Data(treeElm,"viewportcollision","true");treeElm.style.top=posY-treeElm.offsetHeight+"px"}}me.Focused(true);fireEventHandlers(onShown);Fit._internal.ContextMenu.SkipClickClose=true;setTimeout(function(){Fit._internal.ContextMenu.SkipClickClose=false},0)};this.Hide=function(){if(me.IsVisible()===true){Fit.Dom.Remove(tree.GetDomElement());fireEventHandlers(onHide);Fit.Array.ForEach(tree.GetChildren(),function(n){n.Expanded(false)});highlightOnInitKeyStroke=true;Fit.Dom.Data(tree.GetDomElement(),"keynav","false");Fit.Dom.Data(tree.GetDomElement(),"viewportcollision","false");Fit.Dom.Data(tree.GetDomElement(),"sticky","false");Fit.Array.ForEach(tree.GetDomElement().getElementsByTagName("ul"),function(ul){Fit.Dom.Data(ul,"viewportcollision",null)})}};this.DetectBoundaries=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(val===false){Fit.Dom.Data(tree.GetDomElement(),"viewportcollision","false");Fit.Array.ForEach(tree.GetDomElement().getElementsByTagName("ul"),function(ul){Fit.Dom.Data(ul,"viewportcollision",null)})}detectBoundaries=val}return detectBoundaries};this.IsVisible=function(){return tree.GetDomElement().parentElement!==null};this.GetDomElement=function(){return tree.GetDomElement()};this.AddChild=function(item){Fit.Validation.ExpectInstance(item,Fit.Controls.ContextMenuItem);var tvNode=item.GetDomElement()._internal.Node;tree.AddChild(tvNode)};this.RemoveChild=function(item){Fit.Validation.ExpectInstance(item,Fit.Controls.ContextMenuItem);var tvNode=tree.GetChild(item.Value());if(tvNode!==null)tree.RemoveChild(tvNode)};this.RemoveAllChildren=function(dispose){Fit.Validation.ExpectBoolean(dispose,true);tree.RemoveAllChildren(dispose)};this.GetChild=function(val,recursive){Fit.Validation.ExpectString(val);Fit.Validation.ExpectBoolean(recursive,true);var tvNode=tree.GetChild(val,recursive);if(tvNode===null)return null;return tvNode.GetDomElement()._internal.ContextMenuItem};this.GetChildren=function(){var items=[];Fit.Array.ForEach(tree.GetChildren(),function(tvNode){Fit.Array.Add(items,tvNode.GetDomElement()._internal.ContextMenuItem)});return items};this.GetAllChildren=function(){var items=[];Fit.Array.ForEach(tree.GetAllNodes(),function(tvNode){Fit.Array.Add(items,tvNode.GetDomElement()._internal.ContextMenuItem)});return items};this.Focused=function(value){Fit.Validation.ExpectBoolean(value,true);if(Fit.Validation.IsSet(value)===true){prevFocused=Fit.Dom.GetFocused()}return tree.Focused(value)};this.Dispose=function(){if(me===Fit._internal.ContextMenu.Current)Fit._internal.ContextMenu.Current=null;tree.Dispose();me=tree=prevFocused=detectBoundaries=highlightOnInitKeyStroke=isIe8=onShowing=onShown=onHide=onSelect=null};this.OnShowing=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onShowing,cb)};this.OnShown=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onShown,cb)};this.OnHide=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onHide,cb)};this.OnSelect=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onSelect,cb)};this._internal=this._internal?this._internal:{};this._internal.FireOnShowing=function(){return fireEventHandlers(onShowing)};this._internal.FireOnShown=function(){fireEventHandlers(onShown)};this._internal.FireOnHide=function(){fireEventHandlers(onHide)};this._internal.FireOnSelect=function(){fireEventHandlers(onSelect)};function fireEventHandlers(handlers,item){var cancel=false;Fit.Array.ForEach(handlers,function(cb){if(cb(me,item)===false)cancel=true});return!cancel}function getExpandedChild(children,childToIgnore){Fit.Validation.ExpectInstanceArray(children,Fit.Controls.TreeViewNode);Fit.Validation.ExpectInstance(childToIgnore,Fit.Controls.TreeViewNode);var found=null;Fit.Array.ForEach(children,function(c){if(c.Expanded()===true&&c!==childToIgnore){found=c;return false}});return found}function handleViewPortCollision(nodeElm){Fit.Validation.ExpectDomElement(nodeElm);if(nodeElm.getElementsByTagName("ul").length>0){var ul=nodeElm.getElementsByTagName("ul")[0];Fit.Dom.Data(ul,"viewportcollision",null);repaint(function(){var pos=Fit.Dom.GetPosition(ul,true);if(Fit.Browser.GetViewPortDimensions().Height<pos.Y+ul.offsetHeight)Fit.Dom.Data(ul,"viewportcollision","true")})}}function repaint(f){Fit.Validation.ExpectFunction(f,true);var cb=Fit.Validation.IsSet(f)===true?f:function(){};if(isIe8===false){cb()}else{Fit.Dom.AddClass(tree.GetDomElement(),"FitUi_Non_Existing_ContextMenu_Class");Fit.Dom.RemoveClass(tree.GetDomElement(),"FitUi_Non_Existing_ContextMenu_Class");setTimeout(function(){cb();Fit.Dom.AddClass(tree.GetDomElement(),"FitUi_Non_Existing_ContextMenu_Class");Fit.Dom.RemoveClass(tree.GetDomElement(),"FitUi_Non_Existing_ContextMenu_Class")},0)}}init()};Fit.Controls.ContextMenuItem=function(displayTitle,itemValue){Fit.Validation.ExpectString(displayTitle);Fit.Validation.ExpectString(itemValue);var me=this;var node=new Fit.Controls.TreeViewNode(displayTitle,itemValue);function init(){node.GetDomElement()._internal.ContextMenuItem=me}this.Title=function(val){Fit.Validation.ExpectStringValue(val,true);return node.Title(val)};this.Value=function(){return node.Value()};this.Selectable=function(val){Fit.Validation.ExpectBoolean(val,true);return node.Selectable(val)};this.GetDomElement=function(){return node.GetDomElement()};this.AddChild=function(item){Fit.Validation.ExpectInstance(item,Fit.Controls.ContextMenuItem);var tvNode=item.GetDomElement()._internal.Node;node.AddChild(tvNode)};this.RemoveChild=function(item){Fit.Validation.ExpectInstance(item,Fit.Controls.ContextMenuItem);var tvNode=node.GetChild(item.Value());if(tvNode!==null)node.RemoveChild(tvNode)};this.GetChild=function(val,recursive){Fit.Validation.ExpectString(val);Fit.Validation.ExpectBoolean(recursive,true);var tvNode=node.GetChild(val,recursive);if(tvNode===null)return null;return tvNode.GetDomElement()._internal.ContextMenuItem};this.GetChildren=function(){var items=[];Fit.Array.ForEach(node.GetChildren(),function(tvNode){Fit.Array.Add(items,tvNode.GetDomElement()._internal.ContextMenuItem)});return items};this.GetParent=function(){var parent=node.GetParent();return parent!==null?parent.GetDomElement()._internal.ContextMenuItem:null};this.Dispose=function(){node.Dispose();node=null};init()};Fit.Controls.ContextMenu.Item=Fit.Controls.ContextMenuItem;Fit._internal.ContextMenu={};Fit._internal.ContextMenu.SkipClickClose=false;Fit._internal.ContextMenu.Current=null;Fit.Events.OnReady(function(){Fit.Events.AddHandler(document,"click",function(e){if(Fit._internal.ContextMenu.SkipClickClose===true)return;var target=Fit.Events.GetTarget(e);var ctx=Fit._internal.ContextMenu.Current;if(ctx===null||target===ctx.GetDomElement()||Fit.Dom.Contained(ctx.GetDomElement(),target)===true)return;ctx.Hide()})});Fit.Controls.WSContextMenu=function(){Fit.Core.Extend(this,Fit.Controls.ContextMenu).Apply();var me=this;var url=null;var jsonpCallback=null;var onRequestHandlers=[];var onResponseHandlers=[];var onPopulatedHandlers=[];function init(){}this.Show=function(x,y){Fit.Validation.ExpectInteger(x,true);Fit.Validation.ExpectInteger(y,true);if(me._internal.FireOnShowing()===false)return;if(Fit._internal.ContextMenu.Current!==null&&Fit._internal.ContextMenu.Current!==me&&Fit._internal.ContextMenu.Current.IsVisible()===true){Fit._internal.ContextMenu.Current.Hide();Fit._internal.ContextMenu.Current=null}getData(function(eventArgs){me.RemoveAllChildren();Fit.Array.ForEach(eventArgs.Children,function(c){me.AddChild(createItemFromJson(c))});var pos=Fit.Events.GetPointerState().Coordinates.Document;var posX=Fit.Validation.IsSet(x)===true?x:pos.X;var posY=Fit.Validation.IsSet(y)===true?y:pos.Y;me.GetDomElement().style.left=posX+"px";me.GetDomElement().style.top=posY+"px";me.GetDomElement().style.width="auto";if(me.IsVisible()===false){Fit.Dom.Add(document.body,me.GetDomElement());Fit._internal.ContextMenu.Current=me}if(me.DetectBoundaries()===true){var treeElm=me.GetDomElement();Fit.Dom.Data(treeElm,"viewportcollision","false");if(Fit.Browser.GetViewPortDimensions().Height<posY-Fit.Dom.GetScrollPosition(document.body).Y+treeElm.offsetHeight){Fit.Dom.Data(treeElm,"viewportcollision","true");treeElm.style.top=posY-treeElm.offsetHeight+"px"}}me.Focused(true);me._internal.FireOnShown()})};this.Url=function(wsUrl){Fit.Validation.ExpectString(wsUrl,true);if(Fit.Validation.IsSet(wsUrl)===true){url=wsUrl}return url};this.JsonpCallback=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true||val===null){jsonpCallback=val}return jsonpCallback};this.OnRequest=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onRequestHandlers,cb)};this.OnResponse=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onResponseHandlers,cb)};this.OnPopulated=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onPopulatedHandlers,cb)};function getData(cb){Fit.Validation.ExpectFunction(cb);if(url===null)Fit.Validation.ThrowError("Unable to get data, no WebService URL has been specified");var request=null;if(jsonpCallback!==null){request=new Fit.Http.JsonpRequest(url,jsonpCallback)}else{request=new Fit.Http.JsonRequest(url)}var eventArgs={Sender:null,Request:null,Children:null};eventArgs.Sender=me;eventArgs.Request=request;if(fireEventHandlers(onRequestHandlers,eventArgs)===false)return;var onSuccess=function(children){eventArgs.Children=children instanceof Array?children:[];fireEventHandlers(onResponseHandlers,eventArgs);cb(eventArgs);fireEventHandlers(onPopulatedHandlers,eventArgs)};var onFailure=function(httpStatusCode){Fit.Validation.ThrowError("Unable to load data for context menu - request failed with HTTP Status Code "+httpStatusCode)};if(Fit.Core.InstanceOf(request,Fit.Http.JsonpRequest)===false){request.OnSuccess(function(req){var children=request.GetResponseJson();onSuccess(children)});request.OnFailure(function(req){onFailure(request.GetHttpStatus())})}else{request.OnSuccess(function(req){var children=req.GetResponse();onSuccess(children)});request.OnTimeout(function(){onFailure("UNKNOWN (JSONP)")})}request.Start()}function createItemFromJson(jsonNode){Fit.Validation.ExpectIsSet(jsonNode);var item=new Fit.Controls.ContextMenuItem(jsonNode.Title?jsonNode.Title:jsonNode.Value,jsonNode.Value);if(jsonNode.Selectable!==undefined)item.Selectable(jsonNode.Selectable===true);if(jsonNode.Children instanceof Array){Fit.Array.ForEach(jsonNode.Children,function(c){item.AddChild(createItemFromJson(c))})}return item}function fireEventHandlers(handlers,eventArgs){var cancel=false;Fit.Array.ForEach(handlers,function(cb){if(cb(me,eventArgs)===false)cancel=true});return!cancel}init()};Fit.Controls.DatePicker=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.ControlBase).Apply(ctlId);var me=this;var input=null;var inputTime=null;var orgVal=null;var preVal="";var prevTimeVal="";var locale="en";var format="MM/DD/YYYY";var weeks=false;var jquery=undefined;var datepicker=null;var startDate=null;var open=false;var focused=false;var restoreView=false;var updateCalConf=true;var isMobile=Fit.Browser.GetInfo().IsMobile;var inputMobile=null;var inputTimeMobile=null;function init(){input=document.createElement("input");input.type="text";input.autocomplete="off";input.spellcheck=false;input.placeholder=Fit.Date.Format(new Date,format);input.tabIndex=isMobile===true?-1:0;input.onkeydown=function(e){var ev=Fit.Events.GetEvent(e);if(ev.keyCode===40){me.Show()}};input.onkeyup=function(){var curDateTime=me.Date();if(input.value!==""&&curDateTime===null)return;var curDateStr=curDateTime!==null?Fit.Date.Format(curDateTime,me.Format()):"";if(curDateStr!==preVal){if(input.value===""&&open===true){restoreView=true;me.Hide();me.Show();restoreView=false}preVal=curDateStr;me._internal.FireOnChange()}};input.onchange=function(){if(me===null){return}input.onkeyup()};input.onpaste=function(){setTimeout(function(){input.onkeyup();if(open===true){me.Hide();me.Show()}startDate=null},0)};input.onclick=function(){me.Show()};me._internal.FireOnFocus=Fit.Core.CreateOverride(me._internal.FireOnFocus,function(){if(focused===false){focused=true;base()}});me._internal.FireOnBlur=Fit.Core.CreateOverride(me._internal.FireOnBlur,function(){if(open===false){focused=false;base()}});input.onblur=function(){if(me===null){return}if(open===true)return;if(input.value!=="")input.value=preVal};me.OnBlur(function(sender){if(input.value===""&&inputTime!==null){inputTime.value="";prevTimeVal="00:00"}if(input.value!==""&&inputTime!==null&&inputTime.value===""){inputTime.value="00:00";prevTimeVal="00:00"}});me._internal.AddDomElement(input);me.AddCssClass("FitUiControlDatePicker");me._internal.Data("weeks","false");me._internal.Data("time","false");if(isMobile===true){inputMobile=document.createElement("input");inputMobile.type="date";inputMobile.onchange=function(){if(inputMobile.valueAsDate!==null)input.value=Fit.Date.Format(inputMobile.valueAsDate,me.Format());else input.value="";input.onchange()};me._internal.AddDomElement(inputMobile)}}this.Focused=function(focus){Fit.Validation.ExpectBoolean(focus,true);if(Fit.Validation.IsSet(focus)===true){var inp=inputMobile===null?input:inputMobile;if(focus===true){inp.focus()}else{inp.blur();if(isMobile===false)me.Hide()}}return focused};this.Value=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){var fireOnChange=me.Value()!==val;var wasOpen=open;if(wasOpen===true){restoreView=true;me.Hide()}if(val!==""){if(val.indexOf(":")===-1)val+=" 00:00";var date=Fit.Date.Parse(val,"YYYY-MM-DD hh:mm");date.setSeconds(0);date.setMilliseconds(0);input.value=Fit.Date.Format(date,me.Format());preVal=input.value;orgVal=date;if(inputTime!==null){inputTime.value=Fit.Date.Format(date,"hh:mm");prevTimeVal=inputTime.value}if(inputMobile!==null)inputMobile.valueAsDate=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()));if(inputTimeMobile!==null)inputTimeMobile.value=inputTime.value}else{input.value="";preVal="";orgVal=null;if(inputTime!==null){inputTime.value="";prevTimeVal="00:00"}if(inputMobile!==null)inputMobile.valueAsDate=null;if(inputTimeMobile!==null)inputTimeMobile.value=""}if(wasOpen===true){me.Show();restoreView=false}if(fireOnChange===true)me._internal.FireOnChange()}if(input.value==="")return"";try{var value=input.value+(inputTime!==null?" "+(inputTime.value!==""?inputTime.value:"00:00"):"");var dtFormat=me.Format()+(value.indexOf(":")>-1?" hh:mm":"");var d=Fit.Date.Parse(value,dtFormat);return Fit.Date.Format(d,"YYYY-MM-DD"+(value.indexOf(":")>-1?" hh:mm":""))}catch(err){}return""};this.IsDirty=function(){if(inputTime!==null){return Fit.Core.IsEqual(orgVal,me.Date())===false}else{var curDate=me.Date();if(orgVal===null&&curDate!==null||orgVal!==null&&curDate===null)return true;else if(orgVal===null&&curDate===null)return false;else return Fit.Date.Format(orgVal,"YYYY-MM-DD")!==Fit.Date.Format(me.Date(),"YYYY-MM-DD")}};this.Clear=function(){me.Value("")};this.Dispose=Fit.Core.CreateOverride(this.Dispose,function(){if(datepicker!==null){me.Hide();datepicker.datepicker("destroy")}me=input=inputTime=orgVal=preVal=prevTimeVal=locale=format=weeks=jquery=datepicker=startDate=open=focused=restoreView=isMobile=inputMobile=inputTimeMobile=null;base()});this.Date=function(val){Fit.Validation.ExpectDate(val,true);if(val!==undefined){if(val!==null)me.Value(val.getFullYear()+"-"+(val.getMonth()+1)+"-"+val.getDate()+" "+val.getHours()+":"+val.getMinutes());else me.Clear()}var value=me.Value();var date=null;if(value!==""){try{date=Fit.Date.Parse(value,"YYYY-MM-DD"+(inputTime!==null?" hh:mm":""))}catch(err){}}if(date!==null){if(inputTime===null){date.setHours(0);date.setMinutes(0)}date.setSeconds(0);date.setMilliseconds(0)}return date};this.GetText=function(){var date=me.Date();return date!==null?Fit.Date.Format(date,me.Format()+(inputTime!==null?" hh:mm":"")):""};this.Locale=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){var newFormat=getJqueryDateFormatFromLocale(val);if(newFormat===null)Fit.Validation.ThrowError("Unknown locale '"+val+"'");var wasOpen=open;if(wasOpen===true){restoreView=true;me.Hide()}locale=val;updateCalConf=true;me.Format(getFitUiDateFormat(newFormat));if(wasOpen===true){me.Show();restoreView=false}}return locale};this.Format=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){try{var date=Fit.Date.Parse("2016-06-24 00:00:00","YYYY-MM-DD hh:mm:ss");var dateStr=Fit.Date.Format(date,val+" hh:mm:ss");var parsed=Fit.Date.Parse(dateStr,val+" hh:mm:ss");if(date.getTime()!==parsed.getTime())throw"Invalid"}catch(err){Fit.Validation.ThrowError("Invalid date format '"+val+"'")}var wasOpen=open;if(wasOpen===true){restoreView=true;me.Hide()}var curVal=me.Value();format=val;updateCalConf=true;input.placeholder=Fit.Date.Format(new Date,format);me._internal.ExecuteWithNoOnChange(function(){var ov=orgVal;var tv=inputTime!==null?inputTime.value:"";me.Value(curVal);orgVal=ov;if(inputTime!==null)inputTime.value=tv});if(wasOpen===true){me.Show();restoreView=false}}return format};this.WeekNumbers=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){var wasOpen=open;if(wasOpen===true){restoreView=true;me.Hide()}weeks=val;updateCalConf=true;if(wasOpen===true){me.Show();restoreView=false}me._internal.Data("weeks",val.toString())}return weeks};this.Time=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(val===true&&inputTime===null){prevTimeVal="00:00";inputTime=document.createElement("input");inputTime.type="text";inputTime.autocomplete="off";inputTime.spellcheck=false;inputTime.placeholder=Fit.Date.Format(new Date,"hh:mm");inputTime.value=me.Date()!==null?"00:00":"";inputTime.tabIndex=isMobile===true?-1:0;if(me.Date()!==null&&orgVal!==null){inputTime.value=Fit.Date.Format(orgVal,"hh:mm");prevTimeVal=inputTime.value}inputTime.onkeydown=function(e){var ev=Fit.Events.GetEvent(e);var mod=Fit.Events.GetModifierKeys();if(ev.keyCode===9||ev.keyCode===8||ev.keyCode===37||ev.keyCode===39||ev.keyCode===46||mod.Ctrl===true||mod.Meta===true)return;var tv=inputTime.value;var isColon=ev.keyCode===186||mod.Shift===true&&ev.keyCode===190;var valid=isColon===true||ev.keyCode>=48&&ev.keyCode<=58||ev.keyCode>=96&&ev.keyCode<=105;if(isColon===true&&(tv.length===0||tv.substring(tv.length-1)===":")){valid=false}if(valid===false){Fit.Events.PreventDefault(ev);return}};inputTime.onkeyup=function(e){if(e!==null){var ev=Fit.Events.GetEvent(e);if(inputTime.value.length===2&&inputTime.value.substring(1)!==":"&&ev.keyCode!==8&&ev.keyCode!==46){inputTime.value+=":";return}}var dt=null;try{dt=Fit.Date.Parse(inputTime.value!==""?inputTime.value:"00:00","hh:mm")}catch(err){}if(dt===null)return;var newVal=Fit.Date.Format(dt,"hh:mm");if(newVal!==prevTimeVal){prevTimeVal=newVal;if(input.value!=="")me._internal.FireOnChange()}};inputTime.onchange=function(){if(me===null){return}inputTime.onkeyup(null)};inputTime.onpaste=function(){setTimeout(function(){inputTime.onkeyup(null)},0)};inputTime.onblur=function(){if(me===null){return}if(inputTime.value===""){inputTime.value=input.value!==""?"00:00":"";prevTimeVal="00:00"}else{inputTime.value=prevTimeVal}};Fit.Dom.InsertAfter(input,inputTime);if(isMobile===true){inputTimeMobile=document.createElement("input");inputTimeMobile.type="time";inputTimeMobile.onchange=function(){if(inputTimeMobile.value===""&&inputMobile.value!=="")inputTimeMobile.value="00:00";inputTime.value=inputTimeMobile.value;inputTime.onchange()};me._internal.AddDomElement(inputTimeMobile)}me._internal.FireOnChange()}else if(val===false&&inputTime!==null){Fit.Dom.Remove(inputTime);if(isMobile===true){Fit.Dom.Remove(inputTimeMobile)}inputTime=null;prevTimeVal="";me._internal.FireOnChange()}me._internal.Data("time",(inputTime!==null).toString())}return inputTime!==null};this.Show=function(){if(isMobile===false){initializeOnDemand(function(){var focused=Fit.Dom.GetFocused();datepicker.datepicker("show");if(focused===inputTime)inputTime.focus()})}else{me.Focused(false);me.Focused(true)}};this.Hide=function(){if(isMobile===false){if(datepicker!==null)datepicker.datepicker("hide")}else{me.Focused(false)}};this.GetLocales=function(){var locales=[];Fit.Array.ForEach(getLocales(),function(locale){if(locale==="")return;Fit.Array.Add(locales,locale)});return locales};function initializeOnDemand(cb){Fit.Validation.ExpectFunction(cb);if(datepicker!==null){cb();return}jquery=Fit._internal.Controls.DatePicker.jQuery;if(jquery===undefined){jquery=null;Fit._internal.Controls.DatePicker.jQuery=null;Fit.Loader.ExecuteScript(Fit.GetUrl()+"/Resources/JqueryUI-1.11.4.custom/external/jquery/jquery.js",function(src){jquery=$;Fit._internal.Controls.DatePicker.jQuery=$;$.noConflict(true);Fit.Loader.ExecuteScript(Fit.GetUrl()+"/Resources/JqueryUI-1.11.4.custom/jquery-ui.js",function(src){createDatePicker();cb()},null,{jQuery:jquery,$:jquery})})}else if(jquery&&jquery.datepicker){createDatePicker();cb()}}function createDatePicker(){var jq=jquery;datepicker=jq(input).datepicker({showOn:"none",showAnim:false,showWeek:weeks,changeMonth:true,changeYear:true,dateFormat:getJqueryUiDatePickerFormat(me.Format()),defaultDate:null,onChangeMonthYear:function(year,month,dp){if(open===true){try{startDate=Fit.Date.Parse(year+"-"+month+"-"+"01","YYYY-MM-DD")}catch(err){}}},onSelect:function(dateText,dp){startDate=null;me.Focused(true);input.onchange()},beforeShow:function(elm,dp){if(datepicker.jq.datepicker.regional[locale]===null)return false;if(datepicker.jq.datepicker.regional[locale]===undefined){datepicker.jq.datepicker.regional[locale]=null;Fit.Loader.ExecuteScript(Fit.GetUrl()+"/Resources/JqueryUI-1.11.4.custom/i18n/datepicker-"+locale+".js",function(src){if(datepicker.jq.datepicker.regional[locale]){me.Show()}},null,{jQuery:datepicker.jq,$:datepicker.jq});return false}var val=me.Value();if(updateCalConf===true){updateCalConf=false;datepicker.datepicker("option",datepicker.jq.datepicker.regional[locale]);datepicker.datepicker("option","dateFormat",getJqueryUiDatePickerFormat(me.Format()));datepicker.datepicker("option","showWeek",weeks)}if(startDate!==null&&restoreView===true){setTimeout(function(){var year=Fit.Date.Format(startDate,"YYYY");var month=Fit.Date.Format(startDate,"M");var yearPicker=document.querySelector("select.fitui-datepicker-year");yearPicker.value=year;datepicker.jq(yearPicker).trigger("change");var monthPicker=document.querySelector("select.fitui-datepicker-month");monthPicker.value=(parseInt(month)-1).toString();datepicker.jq(monthPicker).trigger("change")},0)}open=true;if(val!==me.Value()){me._internal.ExecuteWithNoOnChange(function(){me.Value(val)})}},onClose:function(dateText,dp){open=false;input.onblur()}});datepicker.jq=jq}function getJqueryUiDatePickerFormat(){return me.Format().replace(/D/g,"d").replace(/M/g,"m").replace(/YY/g,"y")}function getFitUiDateFormat(jqueryFormat){Fit.Validation.ExpectString(jqueryFormat);return jqueryFormat.replace(/d/g,"D").replace(/m/g,"M").replace(/y/g,"YY")}function getJqueryDateFormatFromLocale(lc){Fit.Validation.ExpectString(lc);var locales=getLocales();if(locales[lc]!==undefined)return locales[lc];return null}function getLocales(){return{"":"mm/dd/yy",en:"mm/dd/yy","en-US":"mm/dd/yy",da:"dd-mm-yy",af:"dd/mm/yy","ar-DZ":"dd/mm/yy",ar:"dd/mm/yy",az:"dd.mm.yy",be:"dd.mm.yy",bg:"dd.mm.yy",bs:"dd.mm.yy",ca:"dd/mm/yy",cs:"dd.mm.yy","cy-GB":"dd/mm/yy",de:"dd.mm.yy",el:"dd/mm/yy","en-AU":"dd/mm/yy","en-GB":"dd/mm/yy","en-NZ":"dd/mm/yy",eo:"dd/mm/yy",es:"dd/mm/yy",et:"dd.mm.yy",eu:"yy-mm-dd",fa:"yy/mm/dd",fi:"d.m.yy",fo:"dd-mm-yy","fr-CA":"yy-mm-dd","fr-CH":"dd.mm.yy",fr:"dd/mm/yy",gl:"dd/mm/yy",he:"dd/mm/yy",hi:"dd/mm/yy",hr:"dd.mm.yy.",hu:"yy.mm.dd.",hy:"dd.mm.yy",id:"dd/mm/yy",is:"dd.mm.yy","it-CH":"dd.mm.yy",it:"dd/mm/yy",ja:"yy/mm/dd",ka:"dd-mm-yy",kk:"dd.mm.yy",km:"dd-mm-yy",ko:"yy. m. d.",ky:"dd.mm.yy",lb:"dd.mm.yy",lt:"yy-mm-dd",lv:"dd.mm.yy",mk:"dd.mm.yy",ml:"dd/mm/yy",ms:"dd/mm/yy",nb:"dd.mm.yy","nl-BE":"dd/mm/yy",nl:"dd-mm-yy",nn:"dd.mm.yy",no:"dd.mm.yy",pl:"dd.mm.yy","pt-BR":"dd/mm/yy",pt:"dd/mm/yy",rm:"dd/mm/yy",ro:"dd.mm.yy",ru:"dd.mm.yy",sk:"dd.mm.yy",sl:"dd.mm.yy",sq:"dd.mm.yy",sr:"dd.mm.yy","sr-SR":"dd.mm.yy",sv:"yy-mm-dd",ta:"dd/mm/yy",th:"dd/mm/yy",tj:"dd.mm.yy",tr:"dd.mm.yy",uk:"dd.mm.yy",vi:"dd/mm/yy","zh-CN":"yy-mm-dd","zh-HK":"dd-mm-yy","zh-TW":"yy/mm/dd"}}init()};Fit._internal.Controls.DatePicker={};Fit.Controls.Dialog=function(){var me=this;var dialog=null;var content=null;var buttons=null;var modal=false;var layer=null;var width=null;var minWidth=null;var maxWidth=null;function init(){Fit._internal.Core.EnsureStyles();dialog=document.createElement("div");Fit.Dom.AddClass(dialog,"FitUiControl");Fit.Dom.AddClass(dialog,"FitUiControlDialog");content=document.createElement("div");Fit.Dom.AddClass(content,"FitUiControlDialogContent");Fit.Dom.Add(dialog,content);buttons=document.createElement("div");Fit.Dom.AddClass(buttons,"FitUiControlDialogButtons");Fit.Dom.Add(dialog,buttons);layer=document.createElement("div");Fit.Dom.AddClass(layer,"FitUiControlDialogModalLayer");Fit.Events.AddHandler(dialog,"keydown",function(e){var ev=Fit.Events.GetEvent(e);var key=Fit.Events.GetModifierKeys();if(modal===true&&buttons.children.length>0&&ev.keyCode===9){var buttonFocused=Fit.Dom.GetFocused();if(ev.shiftKey===false){if(buttonFocused===buttons.children[buttons.children.length-1]){buttons.children[0].focus();Fit.Events.PreventDefault(ev)}}else{if(buttonFocused===buttons.children[0]){buttons.children[buttons.children.length-1].focus();Fit.Events.PreventDefault(ev)}}}});Fit.Events.AddHandler(dialog,"click",function(e){if(me===null)return;if(buttons.children.length>0&&(Fit.Dom.GetFocused()===null||Fit.Dom.Contained(dialog,Fit.Dom.GetFocused())===false))buttons.children[0].focus()});Fit.Events.AddHandler(layer,"click",function(e){if(buttons.children.length>0&&(Fit.Dom.GetFocused()===null||Fit.Dom.Contained(dialog,Fit.Dom.GetFocused())===false))buttons.children[0].focus()})}this.Width=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);var defaultValue=Fit.Browser.GetInfo().Name!=="MSIE"||Fit.Browser.GetInfo().Version>=9?{Value:-1,Unit:"px"}:{Value:50,Unit:"%"};if(Fit.Validation.IsSet(val)===true){if(val>-1){width={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};dialog.style.width=width.Value+width.Unit;if(minWidth===null){dialog.style.minWidth="0"}if(maxWidth===null){dialog.style.maxWidth="none"}}else{width=null;dialog.style.width="";if(minWidth===null){dialog.style.minWidth=""}if(maxWidth===null){dialog.style.maxWidth=""}}}return width!==null?width:defaultValue};this.MinimumWidth=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);var defaultValue={Value:280,Unit:"px"};if(Fit.Validation.IsSet(val)===true){if(val>-1){minWidth={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};dialog.style.minWidth=minWidth.Value+minWidth.Unit}else{minWidth=null;dialog.style.minWidth=width!==null?"0":""}}return minWidth!==null?minWidth:width!==null?width:defaultValue};this.MaximumWidth=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);var defaultValue={Value:800,Unit:"px"};if(Fit.Validation.IsSet(val)===true){if(val>-1){maxWidth={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};dialog.style.maxWidth=maxWidth.Value+maxWidth.Unit}else{maxWidth=null;dialog.style.maxWidth=width!==null?"none":""}}return maxWidth!==null?maxWidth:width!==null?width:defaultValue};this.Modal=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){modal=val}return modal};this.Content=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){content.innerHTML=val}return content.innerHTML};this.ContentDomElement=function(elm){Fit.Validation.ExpectElementNode(elm,true);if(Fit.Validation.IsSet(elm)===true){Fit.Dom.Replace(content,elm);content=elm}return content};this.AddButton=function(btn){Fit.Validation.ExpectInstance(btn,Fit.Controls.Button);Fit.Dom.Add(buttons,btn.GetDomElement())};this.Open=function(){Fit.Dom.Add(document.body,dialog);if(modal===true)Fit.Dom.Add(document.body,layer)};this.Close=function(){Fit.Dom.Remove(dialog);if(layer!==null)Fit.Dom.Remove(layer)};this.GetDomElement=function(){return dialog};this.Dispose=function(){Fit.Dom.Remove(dialog);if(layer!==null)Fit.Dom.Remove(layer);Fit.Array.ForEach(Fit.Array.Copy(buttons.children),function(buttonElm){Fit.Controls.Find(buttonElm.id).Dispose()});me=dialog=content=buttons=modal=layer=null};init()};Fit.Controls.Dialog._internal={};Fit.Controls.Dialog._internal.BaseDialog=function(content,showCancel,cb){Fit.Validation.ExpectString(content);Fit.Validation.ExpectBoolean(showCancel);Fit.Validation.ExpectFunction(cb,true);var d=new Fit.Controls.Dialog;d.Content(content.replace(/\n/g,"<br>"));d.Modal(true);Fit.Dom.AddClass(d.GetDomElement(),"FitUiControlDialogBase");var cmdOk=new Fit.Controls.Button(Fit.Data.CreateGuid());cmdOk.Title(Fit.Language.Translations.Ok);cmdOk.Icon("check");cmdOk.Type(Fit.Controls.ButtonType.Success);cmdOk.OnClick(function(sender){d.Dispose();if(Fit.Validation.IsSet(cb)===true)cb(true)});d.AddButton(cmdOk);if(showCancel===true){var cmdCancel=new Fit.Controls.Button(Fit.Data.CreateGuid());cmdCancel.Title(Fit.Language.Translations.Cancel);cmdCancel.Icon("ban");cmdCancel.Type(Fit.Controls.ButtonType.Danger);cmdCancel.OnClick(function(sender){d.Dispose();if(Fit.Validation.IsSet(cb)===true)cb(false)});d.AddButton(cmdCancel)}d.Open();cmdOk.Focused(true);return d};Fit.Controls.Dialog.Alert=function(content,cb){Fit.Validation.ExpectString(content);Fit.Validation.ExpectFunction(cb,true);Fit.Controls.Dialog._internal.BaseDialog(content,false,function(res){if(Fit.Validation.IsSet(cb)===true)cb()})};Fit.Controls.Dialog.Confirm=function(content,cb){Fit.Validation.ExpectString(content);Fit.Validation.ExpectFunction(cb);Fit.Controls.Dialog._internal.BaseDialog(content,true,cb)};Fit.Controls.Dialog.Prompt=function(content,defaultValue,cb){Fit.Validation.ExpectString(content);Fit.Validation.ExpectString(defaultValue);Fit.Validation.ExpectFunction(cb);var txt=new Fit.Controls.Input("FitUiControlDialogPrompt"+Fit.Data.CreateGuid());txt.Width(100,"%");txt.Value(defaultValue);var dia=Fit.Controls.Dialog._internal.BaseDialog(content+"<br><br>",true,function(res){var val=txt.Value();txt.Dispose();if(res===true){cb(val)}else{cb(null)}});Fit.Dom.Add(dia.ContentDomElement(),txt.GetDomElement());txt.Focused(true)};Fit.Controls.DropDown=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.ControlBase).Apply(ctlId);var me=this;var itemContainer=null;var arrow=null;var hidden=null;var spanFitWidth=null;var txtPrimary=null;var txtCssWidth=-1;var txtActive=null;var txtEnabled=false;var dropDownMenu=null;var picker=null;var orgSelections=[];var invalidMessage="Invalid selection";var initialFocus=true;var maxHeight={Value:150,Unit:"px"};var prevValue="";var focusAssigned=false;var visibilityObserverId=-1;var widthObserverId=-1;var tabOrderObserverId=-1;var partiallyHidden=null;var closeHandlers=[];var dropZone=null;var isMobile=false;var focusInputOnMobile=false;var onInputChangedHandlers=[];var onPasteHandlers=[];var onOpenHandlers=[];var onCloseHandlers=[];function init(){invalidMessage=Fit.Language.Translations.InvalidSelection;me._internal.Data("multiselect","false");if(Fit.Browser.GetInfo().IsMobile===true)isMobile=true;itemContainer=document.createElement("div");itemContainer.onmousedown=function(e){itemContainer.tabIndex=0};itemContainer.onmouseup=function(e){itemContainer.tabIndex=-1};itemContainer.onclick=function(e){if(Fit.Events.GetTarget(e)===itemContainer){focusInputOnMobile=true;focusAssigned=true;focusInput(partiallyHidden!==null?partiallyHidden.previousSibling:txtPrimary)}me.OpenDropDown()};Fit.Dom.AddClass(itemContainer,"FitUiControlDropDownItems");arrow=document.createElement("i");Fit.Dom.AddClass(arrow,"fa");Fit.Dom.AddClass(arrow,"fa-chevron-down");arrow.tabIndex=isMobile===true?0:-1;arrow.onmousedown=function(e){if(isMobile===false)arrow.tabIndex=0};arrow.onmouseup=function(e){if(isMobile===false){arrow.tabIndex=-1;focusAssigned=true;focusInput(partiallyHidden!==null?partiallyHidden.previousSibling:txtPrimary)}};arrow.onclick=function(e){focusInputOnMobile=false;if(me.IsDropDownOpen()===true){me.CloseDropDown();Fit.Events.StopPropagation(e);if(isMobile===true){me.Focused(false)}}};txtPrimary=createSearchField();txtActive=txtPrimary;dropDownMenu=document.createElement("div");if(Fit.Browser.GetBrowser()!=="MSIE"||Fit.Browser.GetVersion()>=9){dropDownMenu.onmousewheel=function(e){var ev=Fit.Events.GetEvent(e);dropDownMenu.firstChild.scrollTop-=ev.wheelDeltaY!==undefined?ev.wheelDeltaY:ev.wheelDelta;Fit.Events.PreventDefault(ev)}}Fit.Dom.AddClass(dropDownMenu,"FitUiControlDropDownPicker");dropDownMenu.style.display="none";hidden=document.createElement("div");Fit.Dom.AddClass(hidden,"FitUiControlDropDownHidden");spanFitWidth=document.createElement("span");if(isMobile===false){var eventId=Fit.Events.AddHandler(document,"click",function(e){var target=Fit.Events.GetTarget(e);if(me.IsDropDownOpen()===true&&target!==me.GetDomElement()&&Fit.Dom.Contained(me.GetDomElement(),target)===false)me.CloseDropDown()});Fit.Array.Add(closeHandlers,eventId)}else{var coords=null;var eventId=-1;eventId=Fit.Events.AddHandler(document,"touchstart",function(e){var target=Fit.Events.GetTarget(e);coords=null;if(me.IsDropDownOpen()===true&&target!==me.GetDomElement()&&Fit.Dom.Contained(me.GetDomElement(),target)===false){coords=Fit.Events.GetPointerState().Coordinates.Document}});Fit.Array.Add(closeHandlers,eventId);eventId=Fit.Events.AddHandler(document,"touchend",function(e){if(coords===null)return;var curCoords=Fit.Events.GetPointerState().Coordinates.Document;var moved=Math.abs(coords.X-curCoords.X)>10||Math.abs(coords.Y-curCoords.Y)>10;if(moved===false){me.CloseDropDown();me.Focused(false)}});Fit.Array.Add(closeHandlers,eventId)}me.OnBlur(function(){if(isMobile===true){focusInputOnMobile=false;me.CloseDropDown()}});Fit.Events.AddHandler(me.GetDomElement(),"contextmenu",function(e){if(Fit.Events.GetTarget(e).tagName!=="INPUT")return Fit.Events.PreventDefault(e)});Fit.Dom.Add(hidden,spanFitWidth);Fit.Dom.Add(itemContainer,txtPrimary);Fit.Dom.Add(itemContainer,arrow);me._internal.AddDomElement(itemContainer);me._internal.AddDomElement(dropDownMenu);me._internal.AddDomElement(hidden);me.AddCssClass("FitUiControlDropDown")}this.InvalidSelectionMessage=function(msg){Fit.Validation.ExpectString(msg,true);if(Fit.Validation.IsSet(msg)===true){invalidMessage=msg;Fit.Array.ForEach(getSelectionElements(),function(selection){if(Fit.Dom.HasClass(selection,"FitUiControlDropDownInvalid")===true)Fit.Dom.Attribute(selection,"title",invalidMessage)})}return invalidMessage};this.Width=Fit.Core.CreateOverride(this.Width,function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);var rtn=base(val,unit);if(Fit.Validation.IsSet(val)===true){if((rtn.Unit==="%"||rtn.Unit==="em"||rtn.Unit==="rem")&&widthObserverId===-1){var prevWidth=me.GetDomElement().offsetWidth;var moTimeout=-1;widthObserverId=Fit.Events.AddMutationObserver(me.GetDomElement(),function(elm){var newWidth=me.GetDomElement().offsetWidth;if(prevWidth!==newWidth){prevWidth=newWidth;if(moTimeout!==-1)clearTimeout(moTimeout);moTimeout=setTimeout(function(){if(me===null){return}moTimeout=-1;optimizeTabOrder()},250)}})}else{if(widthObserverId!==-1){Fit.Events.RemoveMutationObserver(widthObserverId);widthObserverId=-1}}optimizeTabOrder()}return rtn});this.DropDownMaxHeight=function(value,unit){Fit.Validation.ExpectNumber(value,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(value)===true){maxHeight={Value:value,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};if(picker!==null)picker.MaxHeight(maxHeight.Value,maxHeight.Unit)}return maxHeight};this.DropDownMaxWidth=function(value,unit){Fit.Validation.ExpectNumber(value,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(value)===true){if(value!==-1){dropDownMenu.style.width="auto";dropDownMenu.style.maxWidth=value+(Fit.Validation.IsSet(unit)===true?unit:"px")}else{dropDownMenu.style.width="";dropDownMenu.style.maxWidth=""}}var res={Value:-1,Unit:"px"};if(dropDownMenu.style.maxWidth!==""){res.Value=parseFloat(dropDownMenu.style.maxWidth);res.Unit=dropDownMenu.style.maxWidth.replace(res.Value,"")}return res};this.Value=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){orgSelections=[];var fireChange=getSelectionElements().length>0||val!=="";me._internal.ExecuteWithNoOnChange(function(){me.Clear();if(val!==""){Fit.Array.ForEach(val.split(";"),function(item){var info=item.split("=");if(info.length===2)me.AddSelection(decodeReserved(info[0]),decodeReserved(info[1]));else me.AddSelection(decodeReserved(info[0]),decodeReserved(info[0]))})}});orgSelections=me.GetSelections();if(fireChange===true)fireOnChange()}var selections=me.GetSelections();var value="";Fit.Array.ForEach(selections,function(item){value+=(value!==""?";":"")+encodeReserved(item.Title)+"="+encodeReserved(item.Value)});return value};this.IsDirty=function(){return Fit.Core.IsEqual(orgSelections,me.GetSelections())===false};this.Clear=function(){me.ClearSelections()};this.Focused=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(val===true){var c=txtPrimary;var v=c.value;c.focus();c.value="";c.value=v}else if(val===false&&Fit.Dom.Contained(me.GetDomElement(),Fit.Dom.GetFocused())===true){me.CloseDropDown();Fit.Dom.GetFocused().blur()}}return txtActive===Fit.Dom.GetFocused()};this.Dispose=Fit.Core.CreateOverride(this.Dispose,function(){if(picker!==null)picker.Destroy();if(Fit._internal.DropDown.Current===me){Fit._internal.DropDown.Current=null}if(widthObserverId!==-1){Fit.Events.RemoveMutationObserver(widthObserverId)}if(tabOrderObserverId!==-1){Fit.Events.RemoveMutationObserver(tabOrderObserverId)}Fit.Array.ForEach(closeHandlers,function(eventId){Fit.Events.RemoveHandler(document,eventId)});me=itemContainer=arrow=hidden=spanFitWidth=txtPrimary=txtCssWidth=txtActive=txtEnabled=dropDownMenu=picker=orgSelections=invalidMessage=initialFocus=maxHeight=prevValue=focusAssigned=visibilityObserverId=widthObserverId=tabOrderObserverId=partiallyHidden=closeHandlers=dropZone=isMobile=focusInputOnMobile=onInputChangedHandlers=onPasteHandlers=onOpenHandlers=onCloseHandlers=null;base()});this.MultiSelectionMode=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true&&me.MultiSelectionMode()!==val){me.ClearSelections();me._internal.Data("multiselect",val.toString());optimizeTabOrder()}return me._internal.Data("multiselect")==="true"};var suppressUpdateItemSelectionState=false;var suppressOnItemSelectionChanged=false;this.GetPicker=function(){return picker};this.SetPicker=function(pickerControl){Fit.Validation.ExpectInstance(pickerControl,Fit.Controls.PickerBase,true);if(picker!==null)Fit.Dom.Remove(picker.GetDomElement());if(!pickerControl){picker=null;return}pickerControl._internal.InitializePicker();picker=pickerControl;Fit.Dom.Add(dropDownMenu,picker.GetDomElement());suppressOnItemSelectionChanged=true;picker.SetSelections(me.GetSelections());suppressOnItemSelectionChanged=false;picker.MaxHeight(maxHeight.Value,maxHeight.Unit);if(!picker._internal)picker._internal={};if(picker._internal.HostControl)return;picker._internal.HostControl=me;var fireChangeEvent=false;picker.OnItemSelectionChanged(function(sender,eventArgs){if(suppressOnItemSelectionChanged===true)return;var txt=null;suppressUpdateItemSelectionState=true;if(eventArgs.Selected===true&&me.GetSelectionByValue(eventArgs.Value)===null){fireChangeEvent=true;me._internal.ExecuteWithNoOnChange(function(){me.AddSelection(eventArgs.Title,eventArgs.Value)});if(me.MultiSelectionMode()===false)me.CloseDropDown()}else if(eventArgs.Selected===false&&me.GetSelectionByValue(eventArgs.Value)!==null){fireChangeEvent=true;txt=txtActive;me._internal.ExecuteWithNoOnChange(function(){me.RemoveSelection(eventArgs.Value)});if(txt.parentElement.parentElement===null)txt=txtPrimary}if(isMobile===false||focusInputOnMobile===true){focusAssigned=true;focusInput(txt!==null?txt:txtActive)}suppressUpdateItemSelectionState=false});picker.OnItemSelectionComplete(function(sender){if(suppressOnItemSelectionChanged===true)return;if(fireChangeEvent===true){me._internal.FireOnChange();fireChangeEvent=false}})};this.AddSelection=function(title,value,valid){Fit.Validation.ExpectString(title);Fit.Validation.ExpectString(value);Fit.Validation.ExpectBoolean(valid,true);if(me.GetSelectionByValue(value)!==null)return;if(picker!==null&&suppressUpdateItemSelectionState===false){suppressOnItemSelectionChanged=true;var res=true;var error=null;try{res=picker.UpdateItemSelection(value,true)}catch(err){error=err}suppressOnItemSelectionChanged=false;if(error!==null)Fit.Validation.ThrowError(error);if(res===false)return}if(me.MultiSelectionMode()===false){var error=null;suppressOnItemSelectionChanged=true;try{me._internal.ExecuteWithNoOnChange(function(){me.ClearSelections()})}catch(err){error=err}suppressOnItemSelectionChanged=false;if(error!==null)Fit.Validation.ThrowError(error);if(getSelectionElements().length>0)return}var cmdDelete=document.createElement("i");Fit.Dom.AddClass(cmdDelete,"fa");Fit.Dom.AddClass(cmdDelete,"fa-times");cmdDelete.tabIndex=0;cmdDelete.onclick=function(e){me.RemoveSelection(decode(Fit.Dom.Data(cmdDelete.parentElement,"value")));if(isMobile===false||focusInputOnMobile===true){focusAssigned=true;focusInput(txtPrimary)}else{arrow.focus()}Fit.Events.StopPropagation(e)};cmdDelete.onmouseup=function(){if(isMobile===false||focusInputOnMobile===true){focusAssigned=true;focusInput(txtPrimary)}else{arrow.focus()}};var container=document.createElement("span");container.onmousedown=function(e){container.tabIndex=0};container.onmouseup=function(e){container.tabIndex=-1};container.onclick=function(e){focusAssigned=true;focusInput(partiallyHidden!==null?partiallyHidden.previousSibling:txtPrimary)};var searchLeft=createSearchField();var searchRight=createSearchField();var item=document.createElement("span");Fit.Dom.Data(item,"value",encode(value));if(valid===false){Fit.Dom.Attribute(item,"title",invalidMessage);Fit.Dom.AddClass(item,"FitUiControlDropDownInvalid")}Fit.Dom.Add(item,document.createTextNode(Fit.String.StripHtml(title)));Fit.Dom.Add(item,cmdDelete);Fit.Dom.Add(container,searchLeft);Fit.Dom.Add(container,item);Fit.Dom.Add(container,searchRight);var before=null;if(txtActive!==txtPrimary&&me.MultiSelectionMode()===true&&Fit.Dom.GetIndex(txtActive)===0)before=txtActive.parentElement;else if(txtActive!==txtPrimary&&me.MultiSelectionMode()===true&&Fit.Dom.GetIndex(txtActive)===2)before=txtActive.parentElement.nextSibling;else before=txtPrimary;itemContainer.insertBefore(container,before);me.ClearInput();if(Fit.Dom.IsVisible(me.GetDomElement())===true){if(me.MultiSelectionMode()===true)optimizeTabOrder(item);else optimizeTabOrder()}else{if(tabOrderObserverId===-1){tabOrderObserverId=Fit.Events.AddMutationObserver(me.GetDomElement(),function(elm){if(Fit.Dom.IsVisible(me.GetDomElement())===true){optimizeTabOrder();disconnect();tabOrderObserverId=-1}})}}var drg=new Fit.DragDrop.Draggable(container,item);drg.OnDragStop(onDragStop);drg.OnDragging(onDragging);var drp=new Fit.DragDrop.DropZone(container);drp.OnDrop(onDrop);drp.OnEnter(onDropZoneEnter);drp.OnLeave(onDropZoneLeave);if(me.MultiSelectionMode()===true){if(txtActive!==txtPrimary&&Fit.Dom.GetIndex(txtActive)===2){if(searchRight.tabIndex!==-1)focusInput(searchRight);else if(container.nextSibling.tagName==="SPAN")focusInput(container.nextSibling.children[0])}}else{focusInput(partiallyHidden!==null?partiallyHidden.previousSibling:txtPrimary)}fireOnChange()};this.GetSelections=function(includeInvalid){Fit.Validation.ExpectBoolean(includeInvalid,true);var selections=Fit.Array.ToArray(itemContainer.children);Fit.Array.RemoveAt(selections,selections.length-1);Fit.Array.RemoveAt(selections,selections.length-1);var toReturn=[];Fit.Array.ForEach(selections,function(selection){if(includeInvalid===true||Fit.Dom.HasClass(selection.children[1],"FitUiControlDropDownInvalid")===false)Fit.Array.Add(toReturn,{Title:Fit.Dom.Text(selection.children[1]),Value:decode(Fit.Dom.Data(selection.children[1],"value")),Valid:!Fit.Dom.HasClass(selection.children[1],"FitUiControlDropDownInvalid")})});return toReturn};this.GetSelectionByValue=function(val){Fit.Validation.ExpectString(val);var found=null;Fit.Array.ForEach(me.GetSelections(),function(selection){if(selection.Value===val){found=selection;return false}});return found};this.ClearSelections=function(){var fireEvent=false;var wasFocused=focusAssigned;me._internal.ExecuteWithNoOnChange(function(){Fit.Array.ForEach(getSelectionElements(),function(selection){if(picker!==null){suppressOnItemSelectionChanged=true;var res=true;var error=null;try{var res=picker.UpdateItemSelection(decode(Fit.Dom.Data(selection,"value")),false)}catch(err){error=err}suppressOnItemSelectionChanged=false;if(error!==null)Fit.Validation.ThrowError(error);if(res!==false&&selection.parentElement.parentElement!==null){Fit.Dom.Remove(selection.parentElement)}if(res!==false)fireEvent=true}else{Fit.Dom.Remove(selection.parentElement);fireEvent=true}})});focusAssigned=wasFocused;optimizeTabOrder();focusInput(txtPrimary);if(fireEvent===true)fireOnChange()};this.RemoveSelection=function(value){Fit.Validation.ExpectString(value);if(picker!==null&&suppressUpdateItemSelectionState===false){suppressOnItemSelectionChanged=true;var res=false;var error=null;try{res=picker.UpdateItemSelection(value,false)}catch(err){error=err}suppressOnItemSelectionChanged=false;if(error!==null)Fit.Validation.ThrowError(error);if(res===false)return}var found=null;var txt=null;Fit.Array.ForEach(getSelectionElements(),function(selection){if(decode(Fit.Dom.Data(selection,"value"))===value){if(me.MultiSelectionMode()===true&&selection.parentElement.nextSibling!==null&&selection.parentElement.nextSibling!==txtPrimary)txt=selection.parentElement.nextSibling.children[0];found=selection.parentElement;return false}});if(found===null)return;if(me.MultiSelectionMode()===false)focusInput(txtPrimary);else focusInput(txt!==null?txt:txtPrimary);Fit.Dom.Remove(found);if(me.MultiSelectionMode()===false){optimizeTabOrder()}else{if(getSelectionElements().length===0)optimizeTabOrder()}fireOnChange()};this.ClearInput=function(input){Fit.Validation.ExpectInstance(input,HTMLInputElement,true);var inp=Fit.Validation.IsSet(input)===true?input:txtActive;if(inp.value==="")return;inp.value="";inp.style.width="";fireOnInputChanged("")};this.SetInputValue=function(val){Fit.Validation.ExpectString(val);if(txtActive.value===val)return;txtActive.value="";txtActive.style.width="";var txt=focusAssigned===true?txtActive:txtPrimary;if(partiallyHidden!==null)txt=partiallyHidden.previousSibling;txt.value=val;txtActive=txt;fitWidthToContent(txt);fireOnInputChanged(txt.value);if(visibilityObserverId!==-1){Fit.Events.RemoveMutationObserver(visibilityObserverId);visibilityObserverId=-1}if(val.length>0&&txt.offsetWidth===0){var observe=null;if(Fit.Dom.IsRooted(txt)===false)observe=txt;else observe=Fit.Dom.GetConcealer(txt);if(observe!==null){visibilityObserverId=Fit.Events.AddMutationObserver(observe,function(elm){if(Fit.Dom.IsVisible(txt)===true){fitWidthToContent(txt);disconnect();visibilityObserverId=-1}})}}};this.GetInputValue=function(){return txtActive.value};this.InputEnabled=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){txtEnabled=val}return txtEnabled};this.OpenDropDown=function(){if(dropDownMenu.style.display==="block")return;if(Fit._internal.DropDown.Current!==null&&Fit._internal.DropDown.Current!==me)Fit._internal.DropDown.Current.CloseDropDown();dropDownMenu.style.minWidth=me.GetDomElement().offsetWidth+"px";dropDownMenu.style.display="block";Fit._internal.DropDown.Current=me;fireOnDropDownOpen()};this.CloseDropDown=function(){if(dropDownMenu.style.display==="none")return;dropDownMenu.style.display="none";Fit._internal.DropDown.Current=null;fireOnDropDownClose()};this.IsDropDownOpen=function(){return dropDownMenu.style.display==="block"};this.OnInputChanged=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onInputChangedHandlers,cb)};this.OnPaste=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onPasteHandlers,cb)};this.OnOpen=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onOpenHandlers,cb)};this.OnClose=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onCloseHandlers,cb)};function createSearchField(){var txt=document.createElement("input");txt.autocomplete="off";txt.onpaste=function(e){var orgValue=txt.value;setTimeout(function(){var pastedValue=txt.value;if(fireOnPaste(txt.value)===true){fitWidthToContent(txt);fireOnInputChanged(txt.value)}else{if(txt.value===pastedValue)txt.value=orgValue}},0)};txt.onfocus=function(e){focusAssigned=true;if(initialFocus===true){initialFocus=false;me.ClearInput(txtPrimary)}txtActive=txt;prevValue=txtActive.value;clearAllInputsButActive()};txt.onblur=function(e){if(me===null){return}focusAssigned=false};var timeOutId=-1;txt.onkeydown=function(e){var ev=Fit.Events.GetEvent(e);txtActive=txt;clearAllInputsButActive();if(picker!==null){if(me.IsDropDownOpen()===true){var res=picker.HandleEvent(ev);if(res===false)return}}if(ev.keyCode===9){if(ev.shiftKey===true){if(me.GetSelections().length===0){me.CloseDropDown();return}else if(txt!==txtPrimary&&txt.parentElement.previousSibling===null){me.CloseDropDown();return}moveToInput("Prev")}else{if(me.MultiSelectionMode()===false&&partiallyHidden!==null){me.CloseDropDown();return}else if(txt===txtPrimary){me.CloseDropDown();return}moveToInput("Next")}return false}else if(ev.keyCode===38){me.OpenDropDown()}else if(ev.keyCode===40){me.OpenDropDown()}else if(ev.keyCode===37){moveToInput("Prev")}else if(ev.keyCode===39){if(me.MultiSelectionMode()===false&&partiallyHidden!==null)return;moveToInput("Next")}else if(ev.keyCode===27){if(Fit.Browser.GetInfo().Name==="MSIE")Fit.Events.PreventDefault(ev);me.CloseDropDown()}else if(ev.keyCode===8){if(txt.value.length===0){if(Fit.Browser.GetInfo().Name==="MSIE")Fit.Events.PreventDefault(ev);var toRemove=null;if(txt!==txtPrimary&&Fit.Dom.GetIndex(txt)===2)toRemove=txt.parentElement;else if(txt!==txtPrimary&&Fit.Dom.GetIndex(txt)===0&&txt.parentElement.previousSibling!==null)toRemove=txt.parentElement.previousSibling;else if(txt.previousSibling!==null)toRemove=txt.previousSibling;if(toRemove!==null){me.RemoveSelection(decode(Fit.Dom.Data(toRemove.children[1],"value")))}}else{if(timeOutId!==-1)clearTimeout(timeOutId);timeOutId=setTimeout(function(){if(me===null){return}fitWidthToContent(txt);timeOutId=-1},50)}}else if(ev.keyCode===46){if(txt.value.length===0){var toRemove=null;if(txt!==txtPrimary&&Fit.Dom.GetIndex(txt)===0)toRemove=txt.parentElement;else if(txt!==txtPrimary&&Fit.Dom.GetIndex(txt)===2&&txt.parentElement.nextSibling.tagName==="SPAN")toRemove=txt.parentElement.nextSibling;if(toRemove!==null){me.RemoveSelection(decode(Fit.Dom.Data(toRemove.children[1],"value")))}}else{if(timeOutId!==null)clearTimeout(timeOutId);timeOutId=setTimeout(function(){fitWidthToContent(txt);timeOutId=null},50)}}else if(ev.keyCode===13){Fit.Events.PreventDefault(e)}else{if(txtEnabled===false){Fit.Events.PreventDefault(ev);return}if(timeOutId!==null)clearTimeout(timeOutId);var mods=Fit.Events.GetModifierKeys();if(mods.Ctrl===true||mods.Meta===true)timeOutId=setTimeout(function(){fitWidthToContent(txt);timeOutId=null},0);else fitWidthToContent(txt,txt.value+String.fromCharCode(ev.keyCode|ev.charCode))}};txt.onkeyup=function(e){var ev=Fit.Events.GetEvent(e);if(ev.keyCode!==37&&ev.keyCode!==38&&ev.keyCode!==39&&ev.keyCode!==40&&ev.keyCode!==27&&ev.keyCode!==9&&ev.keyCode!==16&&ev.ctrlKey===false&&ev.keyCode!==17){if(txt.value!==prevValue){prevValue=txt.value;fireOnInputChanged(txt.value)}}};txt.onclick=function(e){focusInputOnMobile=true;Fit.Events.StopPropagation(e)};return txt}function getSelectionElements(){return itemContainer.querySelectorAll("span[data-value]")}function fitWidthToContent(input,val){Fit.Validation.ExpectInstance(input,HTMLInputElement);Fit.Validation.ExpectString(val,true);var value=Fit.Validation.IsSet(val)===true?val:input.value;if(txtCssWidth<=0)txtCssWidth=txtPrimary.offsetWidth;spanFitWidth.innerHTML=value;var newWidth=(value!==""?spanFitWidth.offsetWidth:0)+txtCssWidth;var offsetLeft=input.offsetLeft;var innerWidth=Fit.Dom.GetInnerWidth(itemContainer);newWidth=offsetLeft+newWidth>innerWidth?innerWidth-offsetLeft:newWidth;input.style.width=newWidth+"px"}function moveToInput(direction){Fit.Validation.ExpectString(direction);var newInput=null;if(direction==="Prev"){if(txtActive!==txtPrimary&&Fit.Dom.GetIndex(txtActive)===0&&txtActive.parentElement.previousSibling!==null)newInput=txtActive.parentElement.previousSibling.children[0];else if(txtActive!==txtPrimary&&Fit.Dom.GetIndex(txtActive)===2)newInput=txtActive.parentElement.children[0];else if(txtActive.previousSibling!==null)newInput=txtActive.previousSibling.children[0]}else{var itemContainer=null;if(txtActive!==txtPrimary&&Fit.Dom.GetIndex(txtActive)===0)itemContainer=txtActive.parentElement;else if(txtActive!==txtPrimary&&Fit.Dom.GetIndex(txtActive)===2&&txtActive.parentElement.nextSibling.tagName==="SPAN")itemContainer=txtActive.parentElement.nextSibling;if(itemContainer!==null){if(itemContainer.children[2].tabIndex!==-1)newInput=itemContainer.children[2];else if(itemContainer.nextSibling.tagName==="SPAN")newInput=itemContainer.nextSibling.children[0];else newInput=txtPrimary}if(newInput!==null&&newInput.parentElement.nextSibling===txtPrimary&&Fit.Dom.GetIndex(newInput)===2)newInput=txtPrimary}if(newInput===null)return;focusInput(newInput)}function focusInput(input){Fit.Validation.ExpectInstance(input,HTMLInputElement);txtActive=input;if(focusAssigned===true)txtActive.focus()}function clearAllInputsButActive(){var inputs=itemContainer.getElementsByTagName("input");Fit.Array.ForEach(inputs,function(input){if(input===txtActive)return;me.ClearInput(input)})}function optimizeTabOrder(item){Fit.Validation.ExpectDomElement(item,true);if(Fit.Validation.IsSet(item)===true){if(item.parentElement.offsetWidth+1>Fit.Dom.GetInnerWidth(itemContainer))item.nextSibling.tabIndex=-1;return}if(me.MultiSelectionMode()===false){var selections=getSelectionElements();partiallyHidden=selections.length>0&&selections[0].parentElement.offsetWidth+1>Fit.Dom.GetInnerWidth(itemContainer)?selections[0]:null;var inputs=itemContainer.querySelectorAll("input");Fit.Array.ForEach(inputs,function(input){input.tabIndex=partiallyHidden!==null?-1:0});if(partiallyHidden!==null)inputs[0].tabIndex=0}else{partiallyHidden=null;Fit.Array.ForEach(getSelectionElements(),function(item){if(item.parentElement.offsetWidth+1>Fit.Dom.GetInnerWidth(itemContainer))item.nextSibling.tabIndex=-1;else item.nextSibling.tabIndex=0})}}function onDragStop(draggable){draggable.Reset()}function onDragging(draggable){if(dropZone===null)return;var pointerPos=Fit.Events.GetPointerState().Coordinates.ViewPort;var elmPos=Fit.Dom.GetPosition(dropZone.GetDomElement(),true);if(elmPos.X+dropZone.GetDomElement().offsetWidth/2<pointerPos.X){Fit.Dom.Data(dropZone.GetDomElement(),"dropping","right")}else{Fit.Dom.Data(dropZone.GetDomElement(),"dropping","left")}me._internal.Repaint()}function onDrop(dropzone,draggable){var fireChange=false;if(Fit.Dom.Data(dropzone.GetDomElement(),"dropping")==="right"&&dropzone.GetDomElement()!==draggable.GetDomElement().previousSibling){focusAssigned=true;focusInput(txtPrimary);Fit.Dom.InsertAfter(dropzone.GetDomElement(),draggable.GetDomElement());fireChange=true}else if(Fit.Dom.Data(dropzone.GetDomElement(),"dropping")==="left"&&dropzone.GetDomElement().previousSibling!==draggable.GetDomElement()){focusAssigned=true;focusInput(txtPrimary);Fit.Dom.InsertBefore(dropzone.GetDomElement(),draggable.GetDomElement());fireChange=true}Fit.Dom.Data(dropZone.GetDomElement(),"dropping",null);dropZone=null;me._internal.Repaint();if(fireChange===true)fireOnChange()}function onDropZoneEnter(dropzone){dropZone=dropzone}function onDropZoneLeave(dropzone){Fit.Dom.Data(dropzone.GetDomElement(),"dropping",null);dropZone=null;me._internal.Repaint()}function decodeReserved(str){Fit.Validation.ExpectString(str);return str.replace(/%3B/g,";").replace(/%3D/g,"=")}function encodeReserved(str){Fit.Validation.ExpectString(str);return str.replace(/;/g,"%3B").replace(/=/g,"%3D")}function decode(str){Fit.Validation.ExpectString(str);return decodeURIComponent(str)}function encode(str){Fit.Validation.ExpectString(str);return encodeURIComponent(str)}function fireOnInputChanged(val){Fit.Validation.ExpectString(val);Fit.Array.ForEach(onInputChangedHandlers,function(handler){handler(me,val)})}function fireOnChange(){me._internal.FireOnChange()}function fireOnPaste(val){Fit.Validation.ExpectString(val);var proceed=true;Fit.Array.ForEach(onPasteHandlers,function(handler){if(handler(me,val)===false)proceed=false});return proceed}function fireOnDropDownOpen(){Fit.Array.ForEach(onOpenHandlers,function(handler){handler(me)});if(picker!==null)picker._internal.FireOnShow()}function fireOnDropDownClose(){Fit.Array.ForEach(onCloseHandlers,function(handler){handler(me)});if(picker!==null)picker._internal.FireOnHide()}init()};Fit._internal.DropDown={};Fit._internal.DropDown.Current=null;Fit.Controls.PickerBase=function(controlId){Fit.Validation.ExpectStringValue(controlId,true);if(Fit.Validation.IsSet(controlId)===true){if(Fit._internal.ControlBase.Controls[controlId]!==undefined)Fit.Validation.ThrowError("Control with ID '"+controlId+"' has already been defined - Control IDs must be unique!");Fit._internal.ControlBase.Controls[controlId]=this}var me=this;var id=controlId?controlId:null;var onShowHandlers=[];var onHideHandlers=[];var onChangingHandlers=[];var onChangeHandlers=[];var onCompleteHandlers=[];this.GetId=function(){return id};this.MaxHeight=function(value,unit){Fit.Validation.ExpectNumber(value,true);Fit.Validation.ExpectStringValue(unit,true);var elm=me.GetDomElement();if(Fit.Validation.IsSet(value)===true){if(value!==-1){elm.style.maxHeight=value+(Fit.Validation.IsSet(unit)===true?unit:"px")}else{elm.style.maxHeight=""}}var res={Value:-1,Unit:"px"};if(elm.style.maxHeight!==""){res.Value=parseFloat(elm.style.maxHeight);res.Unit=elm.style.maxHeight.replace(res.Value,"")}return res};this.OnShow=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onShowHandlers,cb)};this.OnHide=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onHideHandlers,cb)};this.OnItemSelectionChanging=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onChangingHandlers,cb)};this.OnItemSelectionChanged=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onChangeHandlers,cb)};this.OnItemSelectionComplete=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onCompleteHandlers,cb)};this.GetDomElement=function(){Fit.Validation.ThrowError("Function not implemented")};this.UpdateItemSelection=function(value,selected){Fit.Validation.ExpectString(value);Fit.Validation.ExpectBoolean(selected);if(me._internal.FireOnItemSelectionChanging("",value,!selected)===false)return false;me._internal.FireOnItemSelectionChanged("",value,selected)};this.SetSelections=function(items){Fit.Validation.ExpectArray(items);Fit.Array.ForEach(items,function(item){Fit.Validation.ExpectString(item.Title);Fit.Validation.ExpectString(item.Value)})};this.HandleEvent=function(e){Fit.Validation.ExpectEvent(e,true)};this.Destroy=function(){me=id=onShowHandlers=onHideHandlers=onChangingHandlers=onChangeHandlers=onCompleteHandlers=null;if(Fit.Validation.IsSet(controlId)===true)delete Fit._internal.ControlBase.Controls[controlId]};this._internal=this._internal?this._internal:{};this._internal.InitializePicker=function(){};this._internal.FireOnShow=function(){Fit.Array.ForEach(onShowHandlers,function(handler){handler(me)})},this._internal.FireOnHide=function(){Fit.Array.ForEach(onHideHandlers,function(handler){handler(me)})},this._internal.FireOnItemSelectionChanging=function(title,value,selected){Fit.Validation.ExpectString(title);Fit.Validation.ExpectString(value);Fit.Validation.ExpectBoolean(selected);var cancel=false;Fit.Array.ForEach(onChangingHandlers,function(handler){if(handler(me,{Title:title,Value:value,Selected:selected})===false)cancel=true});return!cancel};this._internal.FireOnItemSelectionChanged=function(title,value,selected){Fit.Validation.ExpectString(title);Fit.Validation.ExpectString(value);Fit.Validation.ExpectBoolean(selected);Fit.Array.ForEach(onChangeHandlers,function(handler){handler(me,{Title:title,Value:value,Selected:selected})})};this._internal.FireOnItemSelectionComplete=function(){Fit.Array.ForEach(onCompleteHandlers,function(handler){handler(me)})}};Fit.Controls.WSDropDown=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.DropDown).Apply(ctlId);var me=this;var list=null;var tree=null;var search="";var forceNewSearch=false;var suppressTreeOnOpen=false;var timeOut=null;var currentRequest=null;var classes=null;var onRequestHandlers=[];var onResponseHandlers=[];var onAbortHandlers=[];function init(){me.OnInputChanged(function(sender,value){if(me.Focused()===true)searchData(value)});var cmdOpen=me.GetDomElement().firstChild.children[me.GetDomElement().firstChild.children.length-1];classes=cmdOpen.className;list=new Fit.Controls.WSListView(ctlId+"__WSListView");list.OnRequest(function(sender,eventArgs){if(fireEventHandlers(onRequestHandlers,list,eventArgs)===false)return false;currentRequest=eventArgs.Request;cmdOpen.className="fa fa-refresh fa-spin"});list.OnResponse(function(sender,eventArgs){fireEventHandlers(onResponseHandlers,list,eventArgs);cmdOpen.className=classes;currentRequest=null;if(forceNewSearch===true){forceNewSearch=false;eventArgs.Items=[];searchData(me.GetInputValue())}});list.OnItemSelectionChanging(function(sender,item){var node=tree.GetChild(item.Value,true);if(node!==null&&node.Selectable()===false)return false});list.OnItemSelectionChanged(function(sender,item){if(item.Selected===true)me.CloseDropDown()});var initialLoad=true;tree=new Fit.Controls.WSTreeView(ctlId+"__WSTreeView");tree.Selectable(true);tree.Width(100,"%");tree.OnRequest(function(sender,eventArgs){if(fireEventHandlers(onRequestHandlers,tree,eventArgs)===false)return false;if(eventArgs.Node===null)cmdOpen.className="fa fa-refresh fa-spin"});tree.OnResponse(function(sender,eventArgs){fireEventHandlers(onResponseHandlers,tree,eventArgs);cmdOpen.className=classes});tree.OnAbort(function(sender,eventArgs){fireEventHandlers(onAbortHandlers,tree,eventArgs);cmdOpen.className=classes});tree.OnPopulated(function(sender,eventArgs){if(initialLoad===true){var hasChildren=false;Fit.Array.ForEach(tree.GetChildren(),function(c){if(c.GetChildren().length>0){hasChildren=true;return false}});if(hasChildren===false){tree.Lines(false)}initialLoad=false}});tree.OnSelectAll(function(sender,eventArgs){me.Focused(false);if(me.GetPicker()!==tree)me.SetPicker(tree)});me.OnOpen(function(){if(suppressTreeOnOpen===true){suppressTreeOnOpen=false;return}me.SetPicker(tree);if(tree.GetChildren().length===0){var selected=tree.Selected();tree.Reload();tree.Selected(selected)}})}this.Url=function(wsUrl){Fit.Validation.ExpectString(wsUrl,true);if(Fit.Validation.IsSet(wsUrl)===true){list.Url(wsUrl);tree.Url(wsUrl)}return list.Url()};this.JsonpCallback=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true||val===null){list.JsonpCallback(val);tree.JsonpCallback(val)}return list.JsonpCallback()};this.MultiSelectionMode=Fit.Core.CreateOverride(this.MultiSelectionMode,function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){tree.Selectable(true,val)}return base(val)});this.GetListView=function(){return list};this.GetTreeView=function(){return tree};this.Dispose=Fit.Core.CreateOverride(this.Dispose,function(){me.SetPicker(null);list.Destroy();tree.Destroy();me=list=tree=search=forceNewSearch=suppressTreeOnOpen=timeOut=currentRequest=classes=onRequestHandlers=onResponseHandlers=null;base()});this.OnRequest=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onRequestHandlers,cb)};this.OnResponse=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onResponseHandlers,cb)};this.OnAbort=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onAbortHandlers,cb)};function searchData(value){if(timeOut!==null){clearTimeout(timeOut);timeOut=null}if(currentRequest!==null){forceNewSearch=true;return}search=value;if(search!==""){list.RemoveItems();me.SetPicker(list);timeOut=setTimeout(function(){if(me.IsDropDownOpen()===false){suppressTreeOnOpen=true;me.OpenDropDown()}list.Reload();timeOut=null},500)}}function fireEventHandlers(handlers,picker,eventArgs){var cancel=false;Fit.Array.ForEach(handlers,function(cb){var data=null;if(eventArgs.Children)data=eventArgs.Children;else if(eventArgs.Items)data=eventArgs.Items;var newArgs={Sender:me,Picker:picker,Node:eventArgs.Node?eventArgs.Node:null,SelectAll:eventArgs.SelectAll,Search:search,Data:data,Request:eventArgs.Request};if(cb(me,newArgs)===false)cancel=true;if(eventArgs.Children)eventArgs.Children=newArgs.Data;else if(eventArgs.Items)eventArgs.Items=newArgs.Data});return!cancel}init()};Fit.Controls.FilePicker=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.ControlBase).Apply(ctlId);var me=this;var button=null;var input=null;var width={Value:-1,Unit:"px"};var url=null;var files=[];var inputs=[];var onUploadHandlers=[];var onProgressHandlers=[];var onSuccessHandlers=[];var onFailureHandlers=[];var onCompletedHandlers=[];function init(){createUploadField();if(inputs.length===0){button=new Fit.Controls.Button("Button"+me.GetId());button.Title(Fit.Language.Translations.SelectFile);button.Icon("upload");button.OnClick(function(sender){input.click()});Fit.Dom.Add(button.GetDomElement(),input);me._internal.AddDomElement(button.GetDomElement())}me.AddCssClass("FitUiControlFilePicker");me.Width(-1);me.Enabled(true);me._internal.Data("legacy",(inputs.length>0).toString())}function createUploadField(){var inp=document.createElement("input");inp.type="file";inp.onchange=function(e){if(inputs.length===0){files=[];Fit.Array.ForEach(inp.files,function(file){Fit.Array.Add(files,{Filename:file.name,Type:file.type,Size:file.size,Id:Fit.Data.CreateGuid(),Processed:false,Input:inp,FileObject:file,GetImagePreview:function(){return getImagePreview(file)},ServerResponse:null})})}else{files=[];Fit.Array.ForEach(Fit.Array.Copy(inputs),function(i){if(i.value===""){if(me.MultiSelectionMode()===true){Fit.Dom.Remove(i);Fit.Array.Remove(inputs,i)}return}var file=null;if(me.MultiSelectionMode()===true&&i._file!==undefined&&i._file.Processed===true){file=i._file}else{file={Filename:i.value,Type:"Unknown",Size:-1,Id:Fit.Data.CreateGuid(),Processed:false,Input:i,FileObject:null,GetImagePreview:function(){return null},ServerResponse:null}}i._file=file;Fit.Array.Add(files,file)});if(me.MultiSelectionMode()===true)createUploadField()}me._internal.FireOnChange();if(me.AutoPostBack()===true)me.Upload()};if(inp.files&&!Fit.Controls.FilePicker.ForceLegacyMode){input=inp;input.tabIndex=-1;Fit.Events.AddHandler(input,"click",function(e){Fit.Events.StopPropagation(e)})}else{inp.name="SelectedFile";Fit.Array.Add(inputs,inp);me._internal.AddDomElement(inp)}}this.Focused=function(focus){Fit.Validation.ExpectBoolean(focus,true);if(Fit.Validation.IsSet(focus)===true){if(inputs.length===0){if(focus===true)input.focus();else input.blur()}else{if(focus===true)inputs[0].focus();else inputs[0].blur()}}return Fit.Dom.GetFocused()===input};this.Value=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){Fit.Validation.ThrowError("SecurityError: Due to security restrictions, the value of an upload control cannot be set")}var strFiles="";Fit.Array.ForEach(files,function(file){strFiles+=(strFiles!==""?";":"")+file.Filename});return strFiles};this.IsDirty=function(){return files.length>0};this.Clear=function(){if(files.length===0)return;if(inputs.length===0){input.value="";input.onchange(null)}else{Fit.Array.ForEach(Fit.Array.Copy(inputs),function(i){Fit.Dom.Remove(i);Fit.Array.Remove(inputs,i)});createUploadField();inputs[0].onchange(null)}};this.Dispose=Fit.Core.CreateOverride(this.Dispose,function(){me=button=input=width=url=files=inputs=onUploadHandlers=onProgressHandlers=onSuccessHandlers=onFailureHandlers=onCompletedHandlers=null;base()});this.Width=Fit.Core.CreateOverride(this.Width,function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){if(val>-1){width=base(val,unit);if(inputs.length===0)button.Width(100,"%")}else{width={Value:-1,Unit:"px"};me.GetDomElement().style.width="auto";if(inputs.length===0)button.Width(-1)}}return width});this.Height=Fit.Core.CreateOverride(this.Height,function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true&&inputs.length===0){base(val,unit);if(val>-1)button.Height(100,"%");else button.Height(-1)}return base()});this.Url=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){url=val}return url};this.Title=function(val){Fit.Validation.ExpectString(val,true);if(button===null)return"";if(Fit.Validation.IsSet(val)===true){button.Title(val);Fit.Dom.Add(button.GetDomElement(),input)}return button.Title()};this.GetFiles=function(){return files};this.MultiSelectionMode=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(inputs.length===0){if(val===true&&me.MultiSelectionMode()===false){input.multiple="multiple";if(me.Title()===Fit.Language.Translations.SelectFile)me.Title(Fit.Language.Translations.SelectFiles)}else if(val===false&&me.MultiSelectionMode()===true){if(files.length>1)me.Clear();input.multiple="";if(me.Title()===Fit.Language.Translations.SelectFiles)me.Title(Fit.Language.Translations.SelectFile)}}else{me.Clear()}me._internal.Data("multiple",val.toString())}return me._internal.Data("multiple")==="true"};this.Enabled=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){me._internal.Data("enabled",val.toString());if(inputs.length===0){input.disabled=!val;button.Enabled(val)}else{Fit.Array.ForEach(inputs,function(inp){inp.disabled=!val;if(me.MultiSelectionMode()===true&&val===true&&inp._file!==undefined&&inp._file.Processed===true)inp.disabled=true})}}return me._internal.Data("enabled")==="true"};this.IsLegacyModeEnabled=function(){return inputs.length>0};this.Upload=function(skip){Fit.Validation.ExpectTypeArray(skip,Fit.Validation.ExpectStringValue,true);if(url===null)Fit.Validation.ThrowError("Unable to upload file(s), no URL has been specified");if(me.Enabled()===false)return;var filesToUpload=[];Fit.Array.ForEach(files,function(file){if(Fit.Validation.IsSet(skip)===false||Fit.Array.Contains(skip,file.Filename)===false){if(file.Processed===true)return;Fit.Array.Add(filesToUpload,file)}});if(filesToUpload.length===0)return;if(fireEvent(onUploadHandlers)===false)return;var completed=[];Fit.Array.ForEach(filesToUpload,function(file){file.Processed=true;if(inputs.length===0){var data=new FormData;data.append("SelectedFile",file.FileObject);var req=new XMLHttpRequest;Fit.Events.AddHandler(req.upload,"progress",function(e){var ev=Fit.Events.GetEvent(e);fireEvent(onProgressHandlers,file,ev.loaded>0&&ev.total>0?Math.floor(ev.loaded/ev.total*100):0)});Fit.Events.AddHandler(req,"readystatechange",function(e){if(req.readyState===4){if(req.status===200){file.ServerResponse=req.responseText;Fit.Array.Add(completed,file);fireEvent(onSuccessHandlers,file)}else{Fit.Array.Add(completed,file);fireEvent(onFailureHandlers,file)}if(completed.length===filesToUpload.length)fireEvent(onCompletedHandlers)}});req.open("POST",url);req.send(data)}else{var enforcedOnModernBrowser=Fit.Browser.GetInfo().Name!=="MSIE"||Fit.Browser.GetInfo().Version>8;var picker=file.Input;var iFrame=null;var form=null;var progress=0;var interval=null;iFrame=document.createElement("iframe");iFrame.name="iFrame"+Fit.Data.CreateGuid();iFrame.style.display="none";if(enforcedOnModernBrowser===true){Fit.Dom.InsertAfter(picker,iFrame)}Fit.Events.AddHandler(iFrame,"load",function(e){try{file.ServerResponse=iFrame.contentDocument.body.innerHTML}catch(err){Fit.Browser.Log("Unable to read server response, most likely due to violation of Same-Origin Policy")}Fit.Dom.Remove(iFrame);clearInterval(interval);Fit.Array.Add(completed,file);fireEvent(onProgressHandlers,file,100);fireEvent(onSuccessHandlers,file);if(completed.length===filesToUpload.length)fireEvent(onCompletedHandlers)});if(enforcedOnModernBrowser===false){Fit.Dom.InsertAfter(picker,iFrame)}form=document.createElement("form");form.action=url;form.method="POST";form.setAttribute("enctype","multipart/form-data");form.target=iFrame.name;Fit.Dom.InsertAfter(picker,form);form.appendChild(picker);form.submit();Fit.Dom.InsertBefore(iFrame,picker);Fit.Dom.Remove(form);interval=setInterval(function(){if(me===null){clearInterval(interval);return}progress=progress+5;fireEvent(onProgressHandlers,file,progress);if(progress===90)clearInterval(interval)},1e3);if(me.MultiSelectionMode()===true)picker.disabled=true}})};function getImagePreview(file){if(inputs.length>0)return null;if(file.type==="image/png"||file.type==="image/jpg"||file.type==="image/jpeg"||file.type==="image/svg"||file.type==="image/gif"){var img=new Image;setTimeout(function(){var fr=new FileReader;fr.onload=function(e){var ev=Fit.Events.GetEvent(e);img.src=ev.target.result};fr.readAsDataURL(file)},0);return img}return null}function fireEvent(handlers,file,progress){var canceled=false;Fit.Array.ForEach(handlers,function(cb){if(Fit.Validation.IsSet(file)===true){var eventArgs=file;eventArgs.Progress=100;if(Fit.Validation.IsSet(progress)===true)eventArgs.Progress=progress;if(cb(me,eventArgs)===false)canceled=true}else{if(cb(me)===false)canceled=true}});return!canceled}this.OnUpload=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onUploadHandlers,cb)};this.OnProgress=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onProgressHandlers,cb)};this.OnSuccess=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onSuccessHandlers,cb)};this.OnFailure=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onFailureHandlers,cb)};this.OnCompleted=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onCompletedHandlers,cb)};init()};Fit.Controls.Input=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.ControlBase).Apply(ctlId);var me=this;var orgVal="";var preVal="";var input=null;var cmdResize=null;var designEditor=null;var wasMultiLineBefore=false;var minimizeHeight=-1;var maximizeHeight=-1;var minMaxUnit=null;var mutationObserverId=-1;var isIe8=Fit.Browser.GetInfo().Name==="MSIE"&&Fit.Browser.GetInfo().Version===8;function init(){input=document.createElement("input");input.type="text";input.autocomplete="off";input.spellcheck=true;input.onkeyup=function(){if(me.Value()!==preVal){preVal=me.Value();me._internal.FireOnChange()}};input.onchange=function(){if(me===null){return}input.onkeyup()};me._internal.AddDomElement(input);me.AddCssClass("FitUiControlInput");me._internal.Data("multiline","false");me._internal.Data("maximizable","false");me._internal.Data("maximized","false");me._internal.Data("designmode","false")}this.Focused=function(focus){Fit.Validation.ExpectBoolean(focus,true);var elm=designEditor!==null?designEditor:input;if(Fit.Validation.IsSet(focus)===true){if(focus===true)elm.focus();else if(elm!==designEditor)elm.blur()}return Fit.Dom.GetFocused()===elm};this.Value=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){var fireOnChange=me.Value()!==val;orgVal=val;preVal=val;if(designEditor!==null)CKEDITOR.instances[me.GetId()+"_DesignMode"].setData(val);else input.value=val;if(fireOnChange===true)me._internal.FireOnChange()}if(designEditor!==null)return CKEDITOR.instances[me.GetId()+"_DesignMode"].getData();return input.value};this.IsDirty=function(){return orgVal!==me.Value()};this.Clear=function(){me.Value("")};var baseDispose=me.Dispose;this.Dispose=function(){if(designEditor!==null)designEditor.destroy();me=orgVal=preVal=input=cmdResize=designEditor=wasMultiLineBefore=minimizeHeight=maximizeHeight=minMaxUnit=mutationObserverId=isIe8=null;baseDispose()};var baseWidth=me.Width;this.Width=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){baseWidth(val,unit);updateDesignEditorSize()}return baseWidth()};var baseHeight=me.Height;this.Height=function(val,unit,suppressMinMax){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);Fit.Validation.ExpectBoolean(suppressMinMax,true);if(Fit.Validation.IsSet(val)===true){var h=baseHeight(val,unit);updateDesignEditorSize();if(me.Maximizable()===true&&suppressMinMax!==true){minimizeHeight=h.Value;maximizeHeight=maximizeHeight>h.Value&&h.Unit===minMaxUnit?maximizeHeight:h.Value*2;minMaxUnit=h.Unit;me.Maximized(false)}}return baseHeight()};this.Placeholder=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){input.placeholder=val}return input.placeholder?input.placeholder:""};this.CheckSpelling=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){input.spellcheck=val}return input.spellcheck};this.Type=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){if(Fit.Validation.IsSet(Fit.Controls.InputType[val])===false||val===Fit.Controls.InputType.Unknown)Fit.Validation.ThrowError("Unsupported input type specified - use e.g. Fit.Controls.InputType.Text");if(val===Fit.Controls.InputType.Textarea){me.MultiLine(true)}else{me.MultiLine(false);if(val===Fit.Controls.InputType.Color)input.type="color";else if(val===Fit.Controls.InputType.Date)input.type="date";else if(val===Fit.Controls.InputType.DateTime)input.type="datetime";else if(val===Fit.Controls.InputType.Email)input.type="email";else if(val===Fit.Controls.InputType.Month)input.type="month";else if(val===Fit.Controls.InputType.Number)input.type="number";else if(val===Fit.Controls.InputType.Password)input.type="password";else if(val===Fit.Controls.InputType.PhoneNumber)input.type="tel";else if(val===Fit.Controls.InputType.Text)input.type="text";else if(val===Fit.Controls.InputType.Time)input.type="time";else if(val===Fit.Controls.InputType.Week)input.type="week"}}if(me.MultiLine()===true||me.DesignMode()===true)return Fit.Controls.InputType.Textarea;else if(input.type==="color")return Fit.Controls.InputType.Color;else if(input.type==="date")return Fit.Controls.InputType.Date;else if(input.type==="datetime")return Fit.Controls.InputType.DateTime;else if(input.type==="email")return Fit.Controls.InputType.Email;else if(input.type==="month")return Fit.Controls.InputType.Month;else if(input.type==="number")return Fit.Controls.InputType.Number;else if(input.type==="password")return Fit.Controls.InputType.Password;else if(input.type==="tel")return Fit.Controls.InputType.PhoneNumber;else if(input.type==="text")return Fit.Controls.InputType.Text;else if(input.type==="time")return Fit.Controls.InputType.Time;else if(input.type==="week")return Fit.Controls.InputType.Week;return Fit.Controls.InputType.Unknown};this.MultiLine=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(me.DesignMode()===true)me.DesignMode(false);if(val===true&&input.tagName==="INPUT"){var oldInput=input;me._internal.RemoveDomElement(oldInput);input=document.createElement("textarea");input.value=oldInput.value;input.spellcheck=oldInput.spellcheck;input.onkeyup=oldInput.onkeyup;input.onchange=oldInput.onchange;me._internal.AddDomElement(input);if(me.Height().Value===-1)me.Height(150);me._internal.Data("multiline","true");repaint()}else if(val===false&&input.tagName==="TEXTAREA"){var oldInput=input;me._internal.RemoveDomElement(oldInput);if(cmdResize!==null){me._internal.RemoveDomElement(cmdResize);cmdResize=null;me._internal.Data("maximized","false");me._internal.Data("maximizable","false");repaint()}input=document.createElement("input");input.autocomplete="off";input.type="text";input.value=oldInput.value;input.spellcheck=oldInput.spellcheck;input.onkeyup=oldInput.onkeyup;input.onchange=oldInput.onchange;me._internal.AddDomElement(input);me.Height(-1);wasMultiLineBefore=false;me._internal.Data("multiline","false");repaint()}}return input.tagName==="TEXTAREA"&&designEditor===null};this.Maximizable=function(val,heightMax){Fit.Validation.ExpectBoolean(val,true);Fit.Validation.ExpectNumber(heightMax,true);if(Fit.Validation.IsSet(val)===true){if(val===true&&cmdResize===null){if(me.MultiLine()===true)wasMultiLineBefore=true;if(me.MultiLine()===false&&designEditor===null)me.MultiLine(true);var h=me.Height();if(designEditor===null){minimizeHeight=h.Value;maximizeHeight=Fit.Validation.IsSet(heightMax)===true?heightMax:minimizeHeight!==-1?minimizeHeight*2:150;minMaxUnit=h.Unit}else{minimizeHeight=h.Value;maximizeHeight=Fit.Validation.IsSet(heightMax)===true?heightMax:minimizeHeight!==-1?minimizeHeight*2:300;minMaxUnit="px"}cmdResize=document.createElement("span");cmdResize.onclick=function(){me.Maximized(!me.Maximized())};Fit.Dom.AddClass(cmdResize,"fa");Fit.Dom.AddClass(cmdResize,"fa-chevron-down");me._internal.AddDomElement(cmdResize);me._internal.Data("maximizable","true");repaint()}else if(val===false&&cmdResize!==null){me._internal.RemoveDomElement(cmdResize);cmdResize=null;if(wasMultiLineBefore===true)me.Height(minimizeHeight,minMaxUnit);else me.MultiLine(false);me._internal.Data("maximizable","false");repaint()}}return cmdResize!==null};this.Maximized=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true&&cmdResize!==null){if(val===true&&Fit.Dom.HasClass(cmdResize,"fa-chevron-up")===false){me.Height(maximizeHeight,minMaxUnit,true);Fit.Dom.RemoveClass(cmdResize,"fa-chevron-down");Fit.Dom.AddClass(cmdResize,"fa-chevron-up");me._internal.Data("maximized","true");repaint()}else if(val===false&&Fit.Dom.HasClass(cmdResize,"fa-chevron-down")===false){me.Height(minimizeHeight,minMaxUnit,true);Fit.Dom.RemoveClass(cmdResize,"fa-chevron-up");Fit.Dom.AddClass(cmdResize,"fa-chevron-down");me._internal.Data("maximized","false");repaint()}}return cmdResize!==null&&Fit.Dom.HasClass(cmdResize,"fa-chevron-up")===true};this.DesignMode=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){var designMode=me._internal.Data("designmode")==="true";if(val===true&&designMode===false){if(me.MultiLine()===true)wasMultiLineBefore=true;else me.MultiLine(true);input.id=me.GetId()+"_DesignMode";if(window.CKEDITOR===undefined){window.CKEDITOR=null;Fit.Loader.LoadScript(Fit.GetUrl()+"/Resources/CKEditor/ckeditor.js",function(src){createEditor()})}else if(window.CKEDITOR===null){var iId=-1;iId=setInterval(function(){if(me===null){clearInterval(iId);return}if(window.CKEDITOR!==null){clearInterval(iId);createEditor()}},500)}else{createEditor()}me._internal.Data("designmode","true");repaint()}else if(val===false&&designMode===true){designEditor.destroy();designEditor=null;if(wasMultiLineBefore===false)me.MultiLine(false);me._internal.Data("designmode","false");repaint()}}return me._internal.Data("designmode")==="true"};function createEditor(){if(CKEDITOR._loading===true){setTimeout(function(){if(me===null){return}createEditor()},100);return}CKEDITOR._loading=true;CKEDITOR.on("instanceLoaded",function(){CKEDITOR._loading=false});if(Fit.Dom.IsRooted(me.GetDomElement())===false){CKEDITOR._loading=false;Fit.Validation.ThrowError("Control must be appended/rendered to DOM before DesignMode can be initialized")}designEditor=CKEDITOR.replace(me.GetId()+"_DesignMode",{skin:Fit.Validation.IsSet(Fit._internal.Controls.Input.DefaultSkin)===true?Fit._internal.Controls.Input.DefaultSkin:"moono",language:Fit.Browser.GetInfo().Language==="da"?"da":"en",extraPlugins:"justify,pastefromword",toolbar:[{name:"BasicFormatting",items:["Bold","Italic","Underline"]},{name:"Justify",items:["JustifyLeft","JustifyCenter","JustifyRight"]},{name:"Lists",items:["NumberedList","BulletedList","Indent","Outdent"]},{name:"Links",items:["Link","Unlink"]}],removeButtons:"",on:{instanceReady:function(){var h=me.Height();me.Height(h.Value>=150&&h.Unit==="px"?h.Value:150)},change:function(){input.onkeyup()},focus:function(){me._internal.FireOnFocus()},blur:function(){me._internal.FireOnBlur()}}})}function updateDesignEditorSize(){if(designEditor!==null){var w=me.Width();var h=me.Height();if(w.Unit!=="px"||h.Unit!=="px")throw new Error("DesignMode does not support resizing in units different from px");designEditor.resize(w.Value>-1?w.Value:200,h.Value>-1?h.Value:150);if(mutationObserverId!==-1){Fit.Events.RemoveMutationObserver(mutationObserverId);mutationObserverId=-1}var concealer=Fit.Dom.GetConcealer(me.GetDomElement());if(concealer!==null){mutationObserverId=Fit.Events.AddMutationObserver(concealer,function(elm){if(Fit.Dom.IsVisible(me.GetDomElement())===true){designEditor.resize(w.Value>-1?w.Value:200,h.Value>-1?h.Value:150);disconnect()}})}}}function repaint(){if(isIe8===true){me.AddCssClass("FitUi_Non_Existing_Input_Class");me.RemoveCssClass("FitUi_Non_Existing_Input_Class")}}init()};Fit.Controls.InputType={Textarea:"Textarea",Color:"Color",Date:"Date",DateTime:"DateTime",Email:"Email",Month:"Month",Number:"Number",Password:"Password",PhoneNumber:"PhoneNumber",Text:"Text",Time:"Time",Week:"Week",Unknown:"Unknown"};Fit.Controls.Input.Type=Fit.Controls.InputType;Fit._internal.Controls.Input={};Fit._internal.Controls.Input.DefaultSkin=null;Fit.Controls.ListView=function(controlId){Fit.Validation.ExpectStringValue(controlId,true);Fit.Core.Extend(this,Fit.Controls.PickerBase).Apply(controlId);var me=this;var list=null;var active=null;var isIe8=Fit.Browser.GetInfo().Name==="MSIE"&&Fit.Browser.GetInfo().Version===8;function init(){Fit._internal.Core.EnsureStyles();list=document.createElement("div");list.tabIndex="0";Fit.Dom.AddClass(list,"FitUiControlListView");me.OnShow(function(){list.scrollTop=0;setActive(null)});list.onclick=function(e){var ev=Fit.Events.GetEvent(e);var elm=Fit.Events.GetTarget(e);if(elm===list)return;while(elm.parentElement!==list)elm=elm.parentElement;setActive(elm);if(me._internal.FireOnItemSelectionChanging(Fit.Dom.Text(elm),decode(Fit.Dom.Data(elm,"value")),false)===true){me._internal.FireOnItemSelectionChanged(Fit.Dom.Text(elm),decode(Fit.Dom.Data(elm,"value")),true);me._internal.FireOnItemSelectionComplete()}};list.onfocus=function(e){var ev=Fit.Events.GetEvent(e);if(Fit.Events.GetPointerState().Buttons.Primary===true)return;if(Fit.Events.GetModifierKeys().Shift===true){if(list.children.length>0)setActive(list.children[list.children.length-1])}else{if(list.children.length>0)setActive(list.children[0])}};list.onkeydown=function(e){var ev=Fit.Events.GetEvent(e);if(ev.keyCode===9&&ev.shiftKey===false){if(active!==list.children[list.children.length-1]){moveDown();Fit.Events.PreventDefault(ev);return false}}else if(ev.keyCode===9&&ev.shiftKey===true){if(active!==list.firstChild){moveUp();Fit.Events.PreventDefault(ev);return false}}else{me.HandleEvent(ev)}}}this.AddItem=function(title,value){Fit.Validation.ExpectString(title);Fit.Validation.ExpectString(value);var entry=document.createElement("div");entry.innerHTML=title;Fit.Dom.Data(entry,"value",encode(value));Fit.Dom.Data(entry,"active","false");list.appendChild(entry)};this.HasItem=function(value){Fit.Validation.ExpectString(value);var exists=false;Fit.Array.ForEach(list.children,function(child){if(decode(Fit.Dom.Data(child,"value"))===value){exists=true;return false}});return exists};this.RemoveItem=function(value){Fit.Validation.ExpectString(value);Fit.Array.ForEach(Fit.Array.Copy(list.children),function(child){if(decode(Fit.Dom.Data(child,"value"))===value){Fit.Dom.Remove(child);return false}})};this.RemoveItems=function(){list.innerHTML="";setActive(null)};this.GetDomElement=function(){return list};this.HandleEvent=function(e){Fit.Validation.ExpectEvent(e,true);var ev=Fit.Events.GetEvent(e);if(ev.type==="keydown"){if(ev.keyCode===38){moveUp();Fit.Events.PreventDefault(ev)}else if(ev.keyCode===40){moveDown();Fit.Events.PreventDefault(ev)}else if(ev.keyCode===13){if(active===null&&list.children.length===1)moveDown();if(active!==null){if(me._internal.FireOnItemSelectionChanging(Fit.Dom.Text(active),decode(Fit.Dom.Data(active,"value")),false)===true){me._internal.FireOnItemSelectionChanged(Fit.Dom.Text(active),decode(Fit.Dom.Data(active,"value")),true);me._internal.FireOnItemSelectionComplete()}}Fit.Events.PreventDefault(ev)}}};this.Destroy=Fit.Core.CreateOverride(this.Destroy,function(){Fit.Dom.Remove(list);me=list=active=isIe8=null;base()});function setActive(elm){Fit.Validation.ExpectDomElement(elm,true);if(active!==null)Fit.Dom.Data(active,"active","false");active=elm?elm:null;if(active!==null){Fit.Dom.Data(active,"active","true");list.scrollTop=active.offsetHeight*Fit.Dom.GetIndex(active);repaint()}}function moveUp(){if(list.children.length===0)return;if(active===null){setActive(list.firstChild)}else if(active.previousSibling!==null){setActive(active.previousSibling)}}function moveDown(){if(list.children.length===0)return;if(active===null){setActive(list.firstChild)}else if(active.nextSibling!==null){setActive(active.nextSibling)}}function repaint(){if(isIe8===true){Fit.Dom.AddClass(list,"FitUi_Non_Existing_ListView_Class");Fit.Dom.RemoveClass(list,"FitUi_Non_Existing_ListView_Class")}}function decode(str){Fit.Validation.ExpectString(str);return decodeURIComponent(str)}function encode(str){Fit.Validation.ExpectString(str);return encodeURIComponent(str)}init()};Fit.Controls.WSListView=function(ctlId){Fit.Validation.ExpectStringValue(ctlId,true);Fit.Core.Extend(this,Fit.Controls.ListView).Apply(ctlId);var me=this;var url=null;var jsonpCallback=null;var onRequestHandlers=[];var onResponseHandlers=[];var onAbortHandlers=[];var onPopulatedHandlers=[];function init(){}this.Url=function(wsUrl){Fit.Validation.ExpectString(wsUrl,true);if(Fit.Validation.IsSet(wsUrl)===true){url=wsUrl}return url};this.JsonpCallback=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true||val===null){jsonpCallback=val}return jsonpCallback};this.Reload=function(){getData()};this.Destroy=Fit.Core.CreateOverride(this.Destroy,function(){me=url=jsonpCallback=onRequestHandlers=onResponseHandlers=onAbortHandlers=onPopulatedHandlers=null;base()});this.OnRequest=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onRequestHandlers,cb)};this.OnResponse=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onResponseHandlers,cb)};this.OnAbort=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onAbortHandlers,cb)};this.OnPopulated=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onPopulatedHandlers,cb)};function getData(){if(url===null)Fit.Validation.ThrowError("Unable to get data, no WebService URL has been specified");var request=null;if(jsonpCallback!==null){request=new Fit.Http.JsonpRequest(url,jsonpCallback)}else{request=new Fit.Http.JsonRequest(url)}var eventArgs={Sender:me,Request:request,Items:null};if(fireEventHandlers(onRequestHandlers,eventArgs)===false)return;var onSuccess=function(data){eventArgs.Items=data instanceof Array?data:[];fireEventHandlers(onResponseHandlers,eventArgs);me.RemoveItems();Fit.Array.ForEach(eventArgs.Items,function(item){populate(item)});fireEventHandlers(onPopulatedHandlers,eventArgs)};var onFailure=function(httpStatusCode){Fit.Validation.ThrowError("Unable to get data - request failed with HTTP Status code "+httpStatusCode)};var onAbort=function(){fireEventHandlers(onAbortHandlers,eventArgs)};if(Fit.Core.InstanceOf(request,Fit.Http.JsonpRequest)===false){request.OnSuccess(function(req){var data=request.GetResponseJson();onSuccess(data)});request.OnFailure(function(req){onFailure(request.GetHttpStatus())});request.OnAbort(function(req){onAbort()})}else{request.OnSuccess(function(req){var children=req.GetResponse();onSuccess(children)});request.OnTimeout(function(){onFailure("UNKNOWN (JSONP)")})}request.Start()}function populate(jsonItem){Fit.Validation.ExpectIsSet(jsonItem);Fit.Validation.ExpectString(jsonItem.Value);Fit.Validation.ExpectString(jsonItem.Title,true);Fit.Validation.ExpectBoolean(jsonItem.Selectable,true);Fit.Validation.ExpectArray(jsonItem.Children,true);if(jsonItem.Selectable!==false)me.AddItem(jsonItem.Title?jsonItem.Title:jsonItem.Value,jsonItem.Value);if(jsonItem.Children){Fit.Array.ForEach(jsonItem.Children,function(c){populate(c)})}}function fireEventHandlers(handlers,eventArgs){var cancel=false;Fit.Array.ForEach(handlers,function(cb){if(cb(me,eventArgs)===false)cancel=true});return!cancel}init()};Fit.Controls.ProgressBar=function(controlId){Fit.Validation.ExpectStringValue(controlId,true);if(Fit.Validation.IsSet(controlId)===true){if(Fit._internal.ControlBase.Controls[controlId]!==undefined)Fit.Validation.ThrowError("Control with ID '"+controlId+"' has already been defined - Control IDs must be unique!");Fit._internal.ControlBase.Controls[controlId]=this}var me=this;var id=controlId?controlId:null;var element=null;var status=null;var title="";var width={Value:200,Unit:"px"};var onProgressHandlers=[];function init(){Fit._internal.Core.EnsureStyles();element=document.createElement("div");if(id!==null)element.id=id;Fit.Dom.AddClass(element,"FitUiControl");Fit.Dom.AddClass(element,"FitUiControlProgressBar");status=document.createElement("div");status.style.width="0%";Fit.Dom.AddClass(status,"FitUiControlProgressBarStatus");Fit.Dom.Add(element,status);title=document.createElement("span");Fit.Dom.Add(status,title)}this.GetId=function(){return id};this.Title=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){title.innerHTML=val}return title.innerHTML};this.Width=function(val,unit){Fit.Validation.ExpectNumber(val,true);Fit.Validation.ExpectStringValue(unit,true);if(Fit.Validation.IsSet(val)===true){if(val>-1){width={Value:val,Unit:Fit.Validation.IsSet(unit)===true?unit:"px"};element.style.width=width.Value+width.Unit}else{width={Value:200,Unit:"px"};element.style.width=""}}return width};this.GetDomElement=function(){return element};this.Render=function(toElement){Fit.Validation.ExpectDomElement(toElement,true);if(Fit.Validation.IsSet(toElement)===true){Fit.Dom.Add(toElement,element)}else{var script=document.scripts[document.scripts.length-1];Fit.Dom.InsertBefore(script,element)}};this.Progress=function(val){Fit.Validation.ExpectInteger(val,true);if(Fit.Validation.IsSet(val)===true&&val>=0&&val<=100&&status.style.width!==val+"%"){status.style.width=val+"%";Fit.Array.ForEach(onProgressHandlers,function(cb){cb(me)})}return parseInt(status.style.width)};this.OnProgress=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onProgressHandlers,cb)};this.Dispose=function(){Fit.Dom.Remove(element);me=id=element=status=title=width=onProgressHandlers=null;if(Fit.Validation.IsSet(controlId)===true)delete Fit._internal.ControlBase.Controls[controlId]};init()};Fit.Controls.TreeView=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.PickerBase).Apply();Fit.Core.Extend(this,Fit.Controls.ControlBase).Apply(ctlId);var me=this;var rootContainer=null;var rootNode=null;var keyNavigationEnabled=true;var selectable=false;var multiSelect=false;var showSelectAll=false;var allowDeselect=true;var selected=createInternalCollection();var selectedOrg=[];var ctx=null;var onSelectHandlers=[];var onSelectedHandlers=[];var onToggleHandlers=[];var onToggledHandlers=[];var onSelectAllHandlers=[];var onContextMenuHandlers=[];var forceClear=false;var isIe8=Fit.Browser.GetInfo().Name==="MSIE"&&Fit.Browser.GetInfo().Version===8;function init(){me.AddCssClass("FitUiControlTreeView");me._internal.Data("selectable","false");me._internal.Data("multiselect","false");me._internal.Data("wordwrap","false");rootContainer=document.createElement("ul");me._internal.AddDomElement(rootContainer);rootNode=new Fit.Controls.TreeViewNode(" ","TREEVIEW_ROOT_NODE");rootNode.GetDomElement().tabIndex=-1;rootContainer.appendChild(rootNode.GetDomElement());var treeViewNodeInterface={Select:function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);if(multiSelect===false&&selected.length>0)executeWithNoOnChange(function(){selected[0].Selected(false)});Fit.Array.Add(selected,node)},Deselect:function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);Fit.Array.Remove(selected,node)},Selected:function(val){Fit.Validation.ExpectArray(val,true);return me.Selected(val)},IsSelectable:function(){return selectable},IsMultiSelect:function(){return multiSelect},ShowSelectAll:function(){return showSelectAll},Repaint:function(){repaint()},FireToggle:function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);return fireEventHandlers(onToggleHandlers,node)},FireToggled:function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);return fireEventHandlers(onToggledHandlers,node)},FireSelect:function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);if(forceClear===false&&multiSelect===false&&selected.length>0&&selected[0].Selectable()===false)return false;return fireEventHandlers(onSelectHandlers,node)},FireSelected:function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);fireEventHandlers(onSelectedHandlers,node)},FireOnChange:function(){me._internal.FireOnChange()},GetTreeView:function(){return me}};rootNode.GetDomElement()._internal.TreeView=treeViewNodeInterface;rootNode.GetDomElement().onkeydown=function(e){var ev=Fit.Events.GetEvent(e);var elm=Fit.Events.GetTarget(e);if(keyNavigationEnabled===false)return;if(isPicker===true&&isNodeSet(activeNode)===false&&rootNode.GetChildren().length>0){focusNode(rootNode.GetChildren()[0]);return}if(elm.tagName!=="LI"&&isPicker===true&&isNodeSet(activeNode)===true)elm=activeNode.GetDomElement();if(elm.tagName!=="LI")return;if(elm===rootNode.GetDomElement()){if(rootNode.GetChildren().length>0)focusNode(rootNode.GetChildren()[0]);Fit.Events.PreventDefault(ev);return}var node=elm._internal.Node;if(ev.keyCode===93||Fit.Events.GetModifierKeys().Shift===true&&ev.keyCode===121){var label=node.GetDomElement().querySelector("span");var pos=Fit.Dom.GetPosition(label);var scrollContainers=Fit.Dom.GetScrollPosition(label);var scrollDocument=Fit.Dom.GetScrollPosition(document.body);pos.X=pos.X-scrollContainers.X+scrollDocument.X+label.offsetWidth-10;pos.Y=pos.Y-scrollContainers.Y+scrollDocument.Y+label.offsetHeight-5;openContextMenu(node,pos);Fit.Events.PreventDefault(ev);return}if(ev.keyCode===13){if(node.Selectable()===true){node.Selected(true)}else{var links=node.GetDomElement().getElementsByTagName("a");if(links.length===1)links[0].click()}Fit.Events.PreventDefault(ev);return}if(ev.keyCode===32){if(node.Selectable()===true)toggleNodeSelection(node);Fit.Events.PreventDefault(ev);return}var next=null;if(ev.keyCode===37){if(node.Expanded()===true){node.Expanded(false)}else{next=node.GetParent()}Fit.Events.PreventDefault(ev)}else if(ev.keyCode===39){if(node.Expanded()===false&&node.GetChildren().length>0)node.Expanded(true);Fit.Events.PreventDefault(ev)}else if(ev.keyCode===38){next=getNodeAbove(node);Fit.Events.PreventDefault(ev)}else if(ev.keyCode===40){next=getNodeBelow(node);Fit.Events.PreventDefault(ev)}if(next!==null)focusNode(next)};rootNode.GetDomElement().onclick=function(e){var elm=Fit.Events.GetTarget(e);if(elm.tagName==="INPUT"&&elm.parentElement.tagName==="LI")elm.checked=!elm.checked;var nodeElm=elm.tagName==="LI"?elm:Fit.Dom.GetParentOfType(elm,"LI");var node=nodeElm._internal.Node;focusNode(node);if(elm===node.GetDomElement().children[0])node.Expanded(!node.Expanded());if(elm!==node.GetDomElement().children[0]&&node.Selectable()===true){toggleNodeSelection(node)}};Fit.Events.AddHandler(me.GetDomElement(),"contextmenu",function(e){return Fit.Events.PreventDefault(e)});Fit.Events.AddHandler(me.GetDomElement(),"mouseup",function(e){if(Fit.Events.GetPointerState().Buttons.Secondary===true){var target=Fit.Events.GetTarget(e);if(target!==me.GetDomElement()){var node=target.tagName==="LI"?target._internal.Node:Fit.Dom.GetParentOfType(target,"li")._internal.Node;openContextMenu(node)}return Fit.Events.PreventDefault(e)}});var touchTimeout=-1;Fit.Events.AddHandler(me.GetDomElement(),"touchstart",function(e){var target=Fit.Events.GetTarget(e);if(target!==me.GetDomElement()){touchTimeout=setTimeout(function(){if(me===null){return}var node=target.tagName==="LI"?target._internal.Node:Fit.Dom.GetParentOfType(target,"li")._internal.Node;openContextMenu(node);touchTimeout=-1},500)}});Fit.Events.AddHandler(me.GetDomElement(),"touchend",function(e){var elm=Fit.Events.GetTarget(e);if(touchTimeout!==-1){clearTimeout(touchTimeout);touchTimeout=-1}})}this.WordWrap=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){me._internal.Data("wordwrap",val.toString());repaint()}return me._internal.Data("wordwrap")==="true"};this.Selectable=function(val,multi,showSelAll){Fit.Validation.ExpectBoolean(val,true);Fit.Validation.ExpectBoolean(multi,true);Fit.Validation.ExpectBoolean(showSelAll,true);if(Fit.Validation.IsSet(val)===true){selectable=val;multiSelect=multi===true?true:false;showSelectAll=showSelAll===true?true:false;me._internal.Data("selectable",selectable.toString());me._internal.Data("multiselect",multiSelect.toString());var fireOnChange=selected.length>0;selected=createInternalCollection();executeWithNoOnChange(function(){executeRecursively(rootNode,function(n){if(n===rootNode)return;n.Selectable(selectable,multiSelect,showSelectAll);n.Selected(false)})});repaint();if(fireOnChange===true)me._internal.FireOnChange()}return selectable};this.Selected=function(val){Fit.Validation.ExpectArray(val,true);if(Fit.Validation.IsSet(val)===true){selectedOrg=[];var fireOnChange=selected.length>0;executeWithNoOnChange(function(){me.Clear();Fit.Array.ForEach(val,function(n){Fit.Validation.ExpectInstance(n,Fit.Controls.TreeViewNode);var node=n.GetTreeView()===me?n:me.GetChild(n.Value(),true);if(node===null)Fit.Validation.ThrowError("Node is not assiciated with this TreeView, unable to change selection");Fit.Array.Add(selectedOrg,node);node.Selected(true);fireOnChange=true})});if(fireOnChange===true)me._internal.FireOnChange()}return Fit.Array.Copy(selected)};this.SelectAll=function(selected,selectAllNode){Fit.Validation.ExpectBoolean(selected);Fit.Validation.ExpectInstance(selectAllNode,Fit.Controls.TreeViewNode,true);var node=selectAllNode?selectAllNode:null;if(fireEventHandlers(onSelectAllHandlers,{Node:node,Selected:selected})===false)return;var changed=false;executeWithNoOnChange(function(){var nodes=node!==null?[node]:rootNode.GetChildren();Fit.Array.Recurse(nodes,"GetChildren",function(child){if(child.Selectable()===true){if(child.Selected()!==selected){changed=true;child.Selected(selected)}}child.Expanded(true)})});if(changed===true)me._internal.FireOnChange()};this.AllowDeselect=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){allowDeselect=val}return allowDeselect};this.Value=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){selectedOrg=[];var fireOnChange=selected.length>0;executeWithNoOnChange(function(){me.Clear();var values=val.split(";");Fit.Array.ForEach(values,function(nodeValue){var nodeVal=decodeReserved(nodeValue.indexOf("=")===-1?nodeValue:nodeValue.split("=")[1]);var child=me.GetChild(nodeVal,true);if(child!==null){Fit.Array.Add(selectedOrg,child);child.Selected(true);fireOnChange=true}})});if(fireOnChange===true)me._internal.FireOnChange()}var nodes=me.Selected();var value="";Fit.Array.ForEach(nodes,function(node){value+=(value!==""?";":"")+encodeReserved(node.Title())+"="+encodeReserved(node.Value())});return value};this.IsDirty=function(){if(selected.length!==selectedOrg.length)return true;var dirty=false;Fit.Array.ForEach(selectedOrg,function(node){if(Fit.Array.Contains(selected,node)===false){dirty=true;return false}});return dirty};this.Focused=function(focus){Fit.Validation.ExpectBoolean(focus,true);if(Fit.Validation.IsSet(focus)===true){var focused=getNodeFocused();if(focus===true&&focused===null){var nodes=rootNode.GetChildren();if(nodes.length>0)nodes[0].Focused(true)}else if(focus===false&&focused!==null){focused.Focused(false)}}return getNodeFocused()!==null};this.Lines=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(val===true){me.AddCssClass("FitUiControlTreeViewLines");me.AddCssClass("FitUiControlTreeViewDotLines")}else{me.RemoveCssClass("FitUiControlTreeViewLines");me.RemoveCssClass("FitUiControlTreeViewDotLines")}repaint()}return me.HasCssClass("FitUiControlTreeViewLines")};this.ContextMenu=function(contextMenu){Fit.Validation.ExpectInstance(contextMenu,Fit.Controls.ContextMenu,true);if(contextMenu!==undefined){ctx=contextMenu}return ctx};this.Clear=function(preserveNonSelectable){if(selected.length===0)return;forceClear=preserveNonSelectable!==true;var sel=Fit.Array.Copy(selected);executeWithNoOnChange(function(){Fit.Array.ForEach(sel,function(node){if(preserveNonSelectable!==true||node.Selectable()===true)node.Selected(false)})});forceClear=false;me._internal.FireOnChange()};this.AddChild=function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);rootNode.AddChild(node)};this.RemoveChild=function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);rootNode.RemoveChild(node)};this.RemoveAllChildren=function(dispose){Fit.Validation.ExpectBoolean(dispose,true);var fireOnChange=selected.length>0;selected=createInternalCollection();executeWithNoOnChange(function(){var children=rootNode.GetChildren();Fit.Array.ForEach(children,function(child){if(dispose===true)child.Dispose();else rootNode.RemoveChild(child)})});if(fireOnChange===true)me._internal.FireOnChange()};this.GetChild=function(val,recursive){Fit.Validation.ExpectString(val);Fit.Validation.ExpectBoolean(recursive,true);return rootNode.GetChild(val,recursive)};this.GetChildren=function(){return rootNode.GetChildren()};this.GetAllNodes=function(){var nodes=[];executeRecursively(rootNode,function(n){if(n===rootNode)return;Fit.Array.Add(nodes,n)});return nodes};this.GetNodeFocused=function(){return getNodeFocused()};this.GetNodeAbove=function(node){return getNodeAbove(node,true)};this.GetNodeBelow=function(node){return getNodeBelow(node,true,true)};this.KeyboardNavigation=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){keyNavigationEnabled=val}return keyNavigationEnabled};var baseDispose=me.Dispose;this.Dispose=function(){me._internal.ExecuteWithNoOnChange(function(){rootNode.Dispose()});if(ctx!==null){ctx.Dispose()}me=rootContainer=rootNode=selectable=multiSelect=showSelectAll=selected=selectedOrg=ctx=onContextMenuHandlers=onSelectHandlers=onSelectedHandlers=onToggleHandlers=onToggledHandlers=isPicker=activeNode=isIe8=null;baseDispose()};this.OnSelect=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onSelectHandlers,cb)};this.OnSelected=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onSelectedHandlers,cb)};this.OnToggle=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onToggleHandlers,cb)};this.OnToggled=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onToggledHandlers,cb)};this.OnSelectAll=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onSelectAllHandlers,cb)};this.OnContextMenu=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onContextMenuHandlers,cb)};var isPicker=false;var activeNode=null;this.OnShow(function(sender){me.GetDomElement().scrollTop=0;me.GetDomElement().scrollLeft=0});this.OnSelect(function(sender,node){return me._internal.FireOnItemSelectionChanging(node.Title(),node.Value(),node.Selected())});this.OnSelected(function(sender,node){me._internal.FireOnItemSelectionChanged(node.Title(),node.Value(),node.Selected())});this.OnChange(function(sender){me._internal.FireOnItemSelectionComplete()});this.SetSelections=function(items){Fit.Validation.ExpectArray(items);var vals=[];var fireOnChange=false;Fit.Array.ForEach(items,function(item){Fit.Array.Add(vals,item.Value)});executeWithNoOnChange(function(){Fit.Array.ForEach(Fit.Array.Copy(selected),function(selectedNode){if(Fit.Array.Contains(vals,selectedNode.Value())===false&&selectedNode.Selectable()===true){selectedNode.Selected(false);fireOnChange=true}});Fit.Array.ForEach(vals,function(nodeVal){var child=me.GetChild(nodeVal,true);if(child!==null&&child.Selected()===false){child.Selected(true);fireOnChange=true}})});if(fireOnChange===true)me._internal.FireOnChange()};this.UpdateItemSelection=function(itemValue,selected){Fit.Validation.ExpectString(itemValue);Fit.Validation.ExpectBoolean(selected);var node=me.GetChild(itemValue,true);if(node!==null&&node.Selected()!==selected){if(node.Selectable()===false)return false;node.Selected(selected);if(node.Selected()!==selected)return false}};this._internal.InitializePicker=function(){isPicker=true};this.HandleEvent=function(e){Fit.Validation.ExpectEvent(e,true);var ev=Fit.Events.GetEvent(e);if(ev.type==="keydown"){rootNode.GetDomElement().onkeydown(e);if(ev.keyCode===37||ev.keyCode===39)return false;if(ev.keyCode===32)return false}};this.Destroy=Fit.Core.CreateOverride(this.Destroy,function(){me.Dispose();base()});function executeWithNoOnChange(cb){Fit.Validation.ExpectFunction(cb);me._internal.ExecuteWithNoOnChange(cb)}function executeRecursively(node,cb){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);Fit.Validation.ExpectFunction(cb);if(cb(node)===false)return false;Fit.Array.ForEach(node.GetChildren(),function(child){if(executeRecursively(child,cb)===false)return false})}function createInternalCollection(){var selected=[];return selected}function repaint(){if(isIe8===true){me.AddCssClass("FitUi_Non_Existing_TreeView_Class");me.RemoveCssClass("FitUi_Non_Existing_TreeView_Class")}}function toggleNodeSelection(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);if(node.Selected()===true&&allowDeselect===false)return;node.Selected(!node.Selected())}function focusNode(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);if(isPicker===true){if(isNodeSet(activeNode)===true)Fit.Dom.Data(activeNode.GetDomElement(),"active",null);activeNode=node;Fit.Dom.Data(activeNode.GetDomElement(),"active","true");var nodePositionWithinControl={X:activeNode.GetDomElement().offsetLeft,Y:activeNode.GetDomElement().offsetTop};var offsetParent=activeNode.GetDomElement().offsetParent;while(offsetParent!==me.GetDomElement()){nodePositionWithinControl.X+=offsetParent.offsetLeft;nodePositionWithinControl.Y+=offsetParent.offsetTop;offsetParent=offsetParent.offsetParent}var nodeHeightWithoutChildren=-1;var childrenContainer=activeNode.GetChildren().length>0?activeNode.GetChildren()[0].GetDomElement().parentElement:null;if(childrenContainer!==null)childrenContainer.style.display="none";nodeHeightWithoutChildren=activeNode.GetDomElement().offsetHeight;if(childrenContainer!==null)childrenContainer.style.display="";if(nodePositionWithinControl.Y>me.GetDomElement().scrollTop+me.GetDomElement().clientHeight-nodeHeightWithoutChildren||nodePositionWithinControl.Y<me.GetDomElement().scrollTop)me.GetDomElement().scrollTop=Math.ceil(nodePositionWithinControl.Y-me.GetDomElement().clientHeight/2);if(activeNode.GetLevel()>2)me.GetDomElement().scrollLeft=Math.ceil(nodePositionWithinControl.X);else me.GetDomElement().scrollLeft=0;repaint()}else{node.Focused(true)}}function isNodeSet(node){return node!==null&&node.GetDomElement()!==null}function getNodeFocused(){return Fit.Dom.GetFocused()&&Fit.Dom.GetFocused().tagName==="LI"&&Fit.Dom.GetFocused()._internal&&Fit.Dom.Contained(rootContainer,Fit.Dom.GetFocused())===true?Fit.Dom.GetFocused()._internal.Node:null}function getNodeAbove(node,noLastOnExpand){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);Fit.Validation.ExpectBoolean(noLastOnExpand,true);var parent=node.GetParent();parent=parent!==null?parent:rootNode;var children=parent.GetChildren();var idx=Fit.Array.GetIndex(children,node);var next=idx>0?children[idx-1]:null;if(noLastOnExpand===true)return next;if(next!==null){while(next.Expanded()===true){children=next.GetChildren();next=children[children.length-1]}}else{next=node.GetParent()}return next}function getNodeBelow(node,noFirstOnExpand,noSkipToParent){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);Fit.Validation.ExpectBoolean(noFirstOnExpand,true);Fit.Validation.ExpectBoolean(noSkipToParent,true);if(node.Expanded()===true&&noFirstOnExpand!==true){var children=node.GetChildren();return children[0]}else{var parent=node.GetParent();parent=parent!==null?parent:rootNode;var children=parent.GetChildren();var idx=Fit.Array.GetIndex(children,node);var next=children.length-1>=idx+1?children[idx+1]:null;if(noSkipToParent===true||next!==null||node.GetParent()===null)return next;return getNodeBelow(parent,true)}}function openContextMenu(node,pos){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);if(ctx===null)return;if(fireEventHandlers(onContextMenuHandlers,node)===false)return;if(Fit.Validation.IsSet(pos)===true)ctx.Show(pos.X,pos.Y);else ctx.Show()}function fireEventHandlers(handlers,evObj){var cancel=false;Fit.Array.ForEach(handlers,function(cb){if(cb(me,evObj)===false)cancel=true});return!cancel}function decodeReserved(str){Fit.Validation.ExpectString(str);return str.replace(/%3B/g,";").replace(/%3D/g,"=")}function encodeReserved(str){Fit.Validation.ExpectString(str);return str.replace(/;/g,"%3B").replace(/=/g,"%3D")}init()};Fit.Controls.TreeViewNode=function(displayTitle,nodeValue){Fit.Validation.ExpectString(displayTitle);Fit.Validation.ExpectString(nodeValue);var me=this;var elmLi=null;var elmUl=null;var cmdToggle=null;var chkSelect=null;var lblTitle=null;var childrenIndexed={};var childrenArray=[];var lastChild=null;function init(){elmLi=document.createElement("li");cmdToggle=document.createElement("div");lblTitle=document.createElement("span");me.Title(displayTitle);Fit.Dom.Data(elmLi,"value",encode(nodeValue));Fit.Dom.Data(elmLi,"state","static");Fit.Dom.Data(elmLi,"selectable","false");Fit.Dom.Data(elmLi,"selected","false");Fit.Dom.Data(elmLi,"last","false");elmLi.tabIndex=0;elmLi.appendChild(cmdToggle);elmLi.appendChild(lblTitle);elmLi._internal={Node:me,TreeView:null,TreeViewConfigOverrides:{Selectable:undefined,ShowCheckbox:undefined,ShowSelectAll:undefined}}}this.Title=function(val){Fit.Validation.ExpectStringValue(val,true);if(Fit.Validation.IsSet(val)===true){lblTitle.innerHTML=val;Fit.Array.ForEach(lblTitle.getElementsByTagName("a"),function(link){link.tabIndex=-1})}return Fit.Dom.Text(lblTitle)};this.Value=function(){return decode(Fit.Dom.Data(elmLi,"value"))};this.Expanded=function(expand){Fit.Validation.ExpectBoolean(expand,true);if(Fit.Validation.IsSet(expand)===true&&Fit.Dom.Data(elmLi,"state")!=="static"&&me.Expanded()!==expand){var tv=elmLi._internal.TreeView;if(tv!==null&&tv.FireToggle(me)===false)return Fit.Dom.Data(elmLi,"state")==="expanded";Fit.Dom.Data(elmLi,"state",expand===true?"expanded":"collapsed");if(tv!==null){tv.Repaint();tv.FireToggled(me)}}return Fit.Dom.Data(elmLi,"state")==="expanded"};this.Selectable=function(val,showCheckbox,showSelectAll){Fit.Validation.ExpectBoolean(val,true);Fit.Validation.ExpectBoolean(showCheckbox,true);Fit.Validation.ExpectBoolean(showSelectAll,true);if(Fit.Validation.IsSet(val)===true){elmLi._internal.TreeViewConfigOverrides.Selectable=val;elmLi._internal.TreeViewConfigOverrides.ShowCheckbox=showCheckbox;elmLi._internal.TreeViewConfigOverrides.ShowSelectAll=showSelectAll;Fit.Dom.Data(elmLi,"selectable",val.toString());if(showCheckbox===true&&chkSelect===null){chkSelect=document.createElement("input");chkSelect.type="checkbox";chkSelect.tabIndex="-1";chkSelect.checked=me.Selected();Fit.Dom.InsertBefore(lblTitle,chkSelect)}else if(showCheckbox===false&&chkSelect!==null){Fit.Dom.Remove(chkSelect);chkSelect=null}if(chkSelect!==null){chkSelect.disabled=val===false?true:false}}return Fit.Dom.Data(elmLi,"selectable")==="true"};this.HasCheckbox=function(){return chkSelect!==null};this.Selected=function(select){Fit.Validation.ExpectBoolean(select,true);if(Fit.Validation.IsSet(select)===true&&me.Selected()!==select){var tv=elmLi._internal.TreeView;if(tv!==null&&tv.FireSelect(me)===false)return Fit.Dom.Data(elmLi,"selected")==="true";var wasSelected=me.Selected();Fit.Dom.Data(elmLi,"selected",select.toString());if(chkSelect!==null)chkSelect.checked=select;if(tv!==null)tv.Repaint();if(tv!==null){if(select===true&&wasSelected===false){tv.Select(me);tv.FireSelected(me);tv.FireOnChange()}else if(select===false&&wasSelected===true){tv.Deselect(me);tv.FireSelected(me);tv.FireOnChange()}}}return Fit.Dom.Data(elmLi,"selected")==="true"};this.Focused=function(val){Fit.Validation.ExpectBoolean(val,true);if(Fit.Validation.IsSet(val)===true){if(val===true)elmLi.focus();else if(Fit.Dom.GetFocused()===elmLi)elmLi.blur()}return Fit.Dom.GetFocused()===elmLi};this.GetParent=function(){if(!elmLi.parentElement)return null;if(!elmLi.parentElement.parentElement._internal||!elmLi.parentElement.parentElement._internal.TreeView)return null;if(elmLi.parentElement.parentElement._internal.Node.Value()==="TREEVIEW_ROOT_NODE")return null;return elmLi.parentElement.parentElement._internal.Node};this.GetTreeView=function(){if(elmLi._internal.TreeView!==null)return elmLi._internal.TreeView.GetTreeView();return null};this.GetLevel=function(){var level=0;var node=me;while((node=node.GetParent())!==null){level++}return level};this.AddChild=function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);if(node.GetParent()!==null)node.GetParent().RemoveChild(node);if(node.GetTreeView()!==null)node.GetTreeView().RemoveChild(node);if(elmUl===null){elmUl=document.createElement("ul");elmLi.appendChild(elmUl);Fit.Dom.Data(elmLi,"state","collapsed")}if(lastChild!==null)Fit.Dom.Data(lastChild.GetDomElement(),"last","false");Fit.Dom.Data(node.GetDomElement(),"last","true");lastChild=node;elmUl.appendChild(node.GetDomElement());childrenIndexed[node.Value()]=node;Fit.Array.Add(childrenArray,node);if(elmLi._internal.TreeView!==null)elmLi._internal.TreeView.Repaint();var tv=elmLi._internal.TreeView;if(tv!==null){var selected=[];var fireOnChange=false;executeRecursively(node,function(n){if(n.Selected()===true){Fit.Array.Add(selected,n);n.Selected(false)}n.GetDomElement()._internal.TreeView=tv;var ovr=n.GetDomElement()._internal.TreeViewConfigOverrides;n.Selectable(Fit.Validation.IsSet(ovr.Selectable)===true?ovr.Selectable:tv.IsSelectable(),Fit.Validation.IsSet(ovr.ShowCheckbox)===true?ovr.ShowCheckbox:tv.IsMultiSelect(),Fit.Validation.IsSet(ovr.ShowSelectAll)===true?ovr.ShowSelectAll:tv.ShowSelectAll())});Fit.Array.ForEach(selected,function(node){node.GetDomElement()._internal.TreeView=null;if(tv.FireSelect(node)===true){node.Selected(true);tv.Select(node);tv.FireSelected(node);fireOnChange=true}node.GetDomElement()._internal.TreeView=tv});if(fireOnChange===true)tv.FireOnChange()}};this.RemoveChild=function(node){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);if(node.GetParent()===me||me.Value()==="TREEVIEW_ROOT_NODE"&&me.GetTreeView().GetChild(node.Value())!==null){var tv=node.GetDomElement()._internal.TreeView;if(tv!==null){var fireOnChange=false;executeRecursively(node,function(n){if(n.Selected()===true){tv.Deselect(n);fireOnChange=true}n.GetDomElement()._internal.TreeView=null});if(fireOnChange===true)tv.FireOnChange()}elmUl.removeChild(node.GetDomElement());delete childrenIndexed[node.Value()];Fit.Array.Remove(childrenArray,node);if(childrenArray.length===0){elmLi.removeChild(elmUl);elmUl=null;Fit.Dom.Data(elmLi,"state","static")}if(node===lastChild){lastChild=null;Fit.Dom.Data(node.GetDomElement(),"last","false");if(childrenArray.length>0){lastChild=childrenArray[childrenArray.length-1];Fit.Dom.Data(lastChild.GetDomElement(),"last","true")}}if(elmLi._internal.TreeView!==null)elmLi._internal.TreeView.Repaint()}};this.GetChild=function(val,recursive){Fit.Validation.ExpectString(val);Fit.Validation.ExpectBoolean(recursive,true);var node=childrenIndexed[val];if(node===undefined&&recursive===true){var found=null;Fit.Array.ForEach(childrenArray,function(child){found=child.GetChild(val,recursive);if(found!==null)return false});return found}return node!==undefined?node:null};this.GetChildren=function(){return Fit.Array.Copy(childrenArray)};this.Dispose=function(){Fit.Array.ForEach(Fit.Array.Copy(childrenArray),function(child){child.Dispose()});var parentNode=me.GetParent();if(parentNode!==null){parentNode.RemoveChild(me)}else{if(me.GetTreeView()!==null){me.GetTreeView().RemoveChild(me)}else{Fit.Dom.Remove(elmLi)}}me=elmLi=elmUl=cmdToggle=chkSelect=lblTitle=childrenIndexed=childrenArray=lastChild=null};this.GetDomElement=function(){return elmLi};function executeRecursively(node,cb){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode);Fit.Validation.ExpectFunction(cb);if(cb(node)===false)return false;Fit.Array.ForEach(node.GetChildren(),function(child){if(executeRecursively(child,cb)===false)return false})}function decode(str){Fit.Validation.ExpectString(str);return decodeURIComponent(str)}function encode(str){Fit.Validation.ExpectString(str);return encodeURIComponent(str)}init()};Fit.Controls.TreeView.Node=Fit.Controls.TreeViewNode;Fit.Controls.WSTreeView=function(ctlId){Fit.Validation.ExpectStringValue(ctlId);Fit.Core.Extend(this,Fit.Controls.TreeView).Apply(ctlId);var me=this;var url=null;var jsonpCallback=null;var rootNode=null;var preSelected={};var orgSelected=[];var loadDataOnInit=true;var selectAllMode=Fit.Controls.WSTreeViewSelectAllMode.Progressively;var onRequestHandlers=[];var onResponseHandlers=[];var onAbortHandlers=[];var onPopulatedHandlers=[];function init(){rootNode=me.GetDomElement().firstChild.firstChild._internal.Node;rootNode.GetDomElement()._internal.WSHasChildren=true;var rootedEventId=-1;rootedEventId=Fit.Events.AddHandler(me.GetDomElement(),"#rooted",function(elm){if(loadDataOnInit===true){var selected=me.Selected();me.Reload();me.Selected(selected)}Fit.Events.RemoveHandler(me.GetDomElement(),rootedEventId)});me.OnToggle(function(sender,node){if(node.Expanded()===true)return;if(node.GetDomElement()._internal.WSDone===true)return;if(node.GetDomElement()._internal.WSLoading===true)return false;if(node.GetDomElement()._internal.WSHasChildren===false)return;node.GetDomElement()._internal.WSLoading=true;var canceled=!getData(node,function(n,eventArgs){var expanderNode=node.GetChild("__");if(expanderNode!==null)node.RemoveChild(expanderNode);Fit.Array.ForEach(eventArgs.Children,function(c){node.AddChild(createNodeFromJson(c))});node.GetDomElement()._internal.WSDone=true;node.Expanded(true)});return false});me.OnSelectAll(function(sender,eventArgs){if(selectAllMode!==Fit.Controls.WSTreeViewSelectAllMode.Progressively)return;var node=eventArgs.Node!==null?eventArgs.Node:rootNode;node.GetDomElement()._internal.WSSelectAll=true;node.GetDomElement()._internal.WSCheckedState=eventArgs.Selected;if(loadDataOnInit===true){setTimeout(function(){var selected=me.Selected();me.Reload();me.Selected(selected)},0);return false}Fit.Array.Recurse(node.GetChildren(),"GetChildren",function(n){var internal=n.GetDomElement()._internal;if(internal.WSHasChildren===true&&internal.WSDone!==true){internal.WSSelectAll=true;internal.WSCheckedState=eventArgs.Selected}})});me.OnPopulated(function(sender,eventArgs){if(selectAllMode!==Fit.Controls.WSTreeViewSelectAllMode.Progressively)return;var node=eventArgs.Node!==null?eventArgs.Node:rootNode;var selected=node.GetDomElement()._internal.WSCheckedState;if(node.GetDomElement()._internal.WSSelectAll===true){var fireOnChange=false;me._internal.ExecuteWithNoOnChange(function(){Fit.Array.Recurse(node.GetChildren(),"GetChildren",function(child){var internal=child.GetDomElement()._internal;if(internal.WSHasChildren===true&&internal.WSDone!==true){internal.WSSelectAll=true;internal.WSCheckedState=selected}if(child.Selectable()===true&&child.Selected()!==selected){child.Selected(selected);fireOnChange=true}child.Expanded(true)})});if(fireOnChange===true)me._internal.FireOnChange()}});me.OnSelectAll(function(sender,eventArgs){if(selectAllMode!==Fit.Controls.WSTreeViewSelectAllMode.Instantly)return;var node=eventArgs.Node!==null?eventArgs.Node:rootNode;var internal=node.GetDomElement()._internal;if(nodeFullyLoaded(node)===true)return;internal.WSSelectAll=true;internal.WSCheckedState=eventArgs.Selected;if(node===rootNode){setTimeout(function(){var selected=me.Selected();me.Reload();me.Selected(selected)},0)}else{delete internal.WSDone;delete internal.WSLoading;node.Expanded(false);setTimeout(function(){node.Expanded(true)},0)}return false});me.OnResponse(function(sender,eventArgs){if(selectAllMode!==Fit.Controls.WSTreeViewSelectAllMode.Instantly)return;var node=eventArgs.Node!==null?eventArgs.Node:rootNode;var selected=node.GetDomElement()._internal.WSCheckedState;if(node.GetDomElement()._internal.WSSelectAll===true){me._internal.ExecuteWithNoOnChange(function(){Fit.Array.Recurse(node.GetChildren(),"GetChildren",function(n){n.Selected(false)});Fit.Array.ForEach(node.GetChildren(),function(child){node.RemoveChild(child)})})}});me.OnPopulated(function(sender,eventArgs){if(selectAllMode!==Fit.Controls.WSTreeViewSelectAllMode.Instantly)return;var node=eventArgs.Node!==null?eventArgs.Node:rootNode;var selected=node.GetDomElement()._internal.WSCheckedState;if(node.GetDomElement()._internal.WSSelectAll===true){var changed=false;me._internal.ExecuteWithNoOnChange(function(){if(node!==rootNode&&node.Selectable()===true&&node.Selected()!==selected){node.Selected(selected);changed=true}Fit.Array.Recurse(node.GetChildren(),"GetChildren",function(child){var childInternal=child.GetDomElement()._internal;if(childInternal.WSHasChildren===true&&childInternal.WSDone!==true){Fit.Browser.Log("NOTICE: WebService did not provide all data in one single HTTP request - an additional request is required to load data for node with value '"+child.Value()+"'");childInternal.WSSelectAll=true;childInternal.WSCheckedState=selected}if(child.Selectable()===true&&child.Selected()!==selected){child.Selected(selected);changed=true}child.Expanded(true)})});if(changed===true)me._internal.FireOnChange()}})}this.Url=function(wsUrl){Fit.Validation.ExpectString(wsUrl,true);if(Fit.Validation.IsSet(wsUrl)===true){url=wsUrl}return url};this.JsonpCallback=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true||val===null){jsonpCallback=val}return jsonpCallback};this.SelectAllMode=function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){if(val===Fit.Controls.WSTreeViewSelectAllMode.Progressively||val===Fit.Controls.WSTreeViewSelectAllMode.Instantly)selectAllMode=val}return selectAllMode};this.RemoveAllChildren=Fit.Core.CreateOverride(this.RemoveAllChildren,function(){preSelected={};base()});this.Selectable=Fit.Core.CreateOverride(this.Selectable,function(val,multi,showSelAll){Fit.Validation.ExpectBoolean(val,true);Fit.Validation.ExpectBoolean(multi,true);Fit.Validation.ExpectBoolean(showSelAll,true);preSelected={};return base(val,multi,showSelAll)});this.Clear=Fit.Core.CreateOverride(this.Clear,function(){var fireChange=me.Selected().length>0;preSelected={};me._internal.ExecuteWithNoOnChange(function(){base()});if(fireChange===true)me._internal.FireOnChange()});this.Reload=function(cb){Fit.Validation.ExpectFunction(cb,true);me.RemoveAllChildren(true);preSelected={};getData(null,function(node,eventArgs){Fit.Array.ForEach(eventArgs.Children,function(jsonChild){me.AddChild(createNodeFromJson(jsonChild))});if(Fit.Validation.IsSet(cb)===true){cb(me)}});loadDataOnInit=false};this.Value=Fit.Core.CreateOverride(this.Value,function(val){Fit.Validation.ExpectString(val,true);if(Fit.Validation.IsSet(val)===true){orgSelected=[];preSelected={};var fireOnChange=me.Selected().length>0;me._internal.ExecuteWithNoOnChange(function(){base(val);var selected=baseSelected();if(selected.length>0)fireOnChange=true;Fit.Array.ForEach(selected,function(node){Fit.Array.Add(orgSelected,node.Value())});var values=val.split(";");Fit.Array.ForEach(values,function(nodeVal){var info=nodeVal.split("=");var preSel={Title:null,Value:null};if(info.length===1){preSel.Title="[pre-selection]";preSel.Value=decodeReserved(info[0])}else{preSel.Title=decodeReserved(info[0]);preSel.Value=decodeReserved(info[1])}if(me.GetChild(preSel.Value,true)===null){preSelected[preSel.Value]=preSel;Fit.Array.Add(orgSelected,preSel.Value);fireOnChange=true}})});if(fireOnChange===true)me._internal.FireOnChange()}var nodes=me.Selected();var value="";Fit.Array.ForEach(nodes,function(node){value+=(value!==""?";":"")+encodeReserved(node.Title())+"="+encodeReserved(node.Value())});return value});var baseSelected=me.Selected;this.Selected=function(val){Fit.Validation.ExpectArray(val,true);if(Fit.Validation.IsSet(val)===true){var toSelect=[];Fit.Array.ForEach(val,function(n){Fit.Validation.ExpectInstance(n,Fit.Controls.TreeViewNode);var node=n.GetTreeView()===me?n:me.GetChild(n.Value(),true);if(node!==null)Fit.Array.Add(toSelect,node)});orgSelected=[];preSelected={};var fireOnChange=me.Selected().length>0;var selected=null;me._internal.ExecuteWithNoOnChange(function(){selected=baseSelected(toSelect)});if(selected.length>0)fireOnChange=true;Fit.Array.ForEach(selected,function(node){Fit.Array.Add(orgSelected,node.Value())});Fit.Array.ForEach(val,function(node){if(me.GetChild(node.Value(),true)===null){preSelected[node.Value()]={Title:node.Title(),Value:node.Value()};Fit.Array.Add(orgSelected,node.Value());fireOnChange=true}})}var nodes=baseSelected();Fit.Array.ForEach(preSelected,function(preSelVal){var preSel=preSelected[preSelVal];Fit.Array.Add(nodes,new Fit.Controls.TreeViewNode(preSel.Title,preSel.Value))});return nodes};this.IsDirty=Fit.Core.CreateOverride(this.IsDirty,function(){var valuesSelected=[];Fit.Array.ForEach(me.Selected(),function(selected){Fit.Array.Add(valuesSelected,selected.Value())});if(valuesSelected.length!==orgSelected.length)return true;var dirty=false;Fit.Array.ForEach(orgSelected,function(val){if(Fit.Array.Contains(valuesSelected,val)===false){dirty=true;return false}});return dirty});this.Dispose=Fit.Core.CreateOverride(this.Dispose,function(){me=url=jsonpCallback=preSelected=orgSelected=loadDataOnInit=onRequestHandlers=onResponseHandlers=onPopulatedHandlers=baseRender=baseSelected=null;base()});this.SetSelections=Fit.Core.CreateOverride(this.SetSelections,function(items){Fit.Validation.ExpectArray(items);var fireOnChange=me.Selected().length>0;preSelected={};me._internal.ExecuteWithNoOnChange(function(){base(items)});if(me.Selected().length>0)fireOnChange=true;Fit.Array.ForEach(items,function(item){Fit.Validation.ExpectString(item.Title);Fit.Validation.ExpectString(item.Value);preSelected[item.Value]={Title:item.Title,Value:item.Value}});Fit.Array.ForEach(baseSelected(),function(selected){delete preSelected[selected.Value()]});if(Fit.Core.IsEqual(preSelected,{})===false)fireOnChange=true;if(fireOnChange===true)me._internal.FireOnChange()});this.UpdateItemSelection=Fit.Core.CreateOverride(this.UpdateItemSelection,function(itemValue,selected){Fit.Validation.ExpectString(itemValue);Fit.Validation.ExpectBoolean(selected);if(me.GetChild(itemValue,true)===null){if(selected===true&&preSelected[itemValue]===undefined){preSelected[itemValue]={Title:"[pre-selection]",Value:itemValue};me._internal.FireOnChange()}else if(selected===false&&preSelected[itemValue]!==undefined){delete preSelected[itemValue];me._internal.FireOnChange()}}else{if(base(itemValue,selected)===false)return false}});this.OnRequest=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onRequestHandlers,cb)};this.OnResponse=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onResponseHandlers,cb)};this.OnAbort=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onAbortHandlers,cb)};this.OnPopulated=function(cb){Fit.Validation.ExpectFunction(cb);Fit.Array.Add(onPopulatedHandlers,cb)};function getData(node,cb){Fit.Validation.ExpectInstance(node,Fit.Controls.TreeViewNode,true);Fit.Validation.ExpectFunction(cb);if(url===null)Fit.Validation.ThrowError("Unable to get data, no WebService URL has been specified");var request=null;if(jsonpCallback!==null){request=new Fit.Http.JsonpRequest(url,jsonpCallback)}else{request=new Fit.Http.JsonRequest(url)}var eventArgs={Sender:null,Node:null,Request:null,Children:null};eventArgs.Sender=me;eventArgs.Node=node;eventArgs.Request=request;eventArgs.SelectAll=node!==null&&node.GetDomElement()._internal.WSSelectAll===true;if(fireEventHandlers(onRequestHandlers,eventArgs)===false)return false;var onSuccess=function(children){eventArgs.Children=children instanceof Array?children:[];fireEventHandlers(onResponseHandlers,eventArgs);cb(node,eventArgs);if(request._loadingIndicator!==undefined){Fit.Dom.Remove(request._loadingIndicator);delete request._loadingIndicator}if(Fit.Core.IsEqual(preSelected,{})===false){me._internal.ExecuteWithNoOnChange(function(){Fit.Array.Recurse(node!==null?node.GetChildren():me.GetChildren(),"GetChildren",function(n){if(preSelected[n.Value()]!==undefined){delete preSelected[n.Value()];n.Selected(true)}})})}fireEventHandlers(onPopulatedHandlers,eventArgs)};var onFailure=function(httpStatusCode){Fit.Validation.ThrowError("Unable to get children for "+(node!==null?"node '"+node.Title()+"'":"root level")+" - request failed with HTTP Status code "+httpStatusCode)};var onAbort=function(){if(request._loadingIndicator!==undefined){Fit.Dom.Remove(request._loadingIndicator);delete request._loadingIndicator}if(node!==null){delete node.GetDomElement()._internal.WSLoading}fireEventHandlers(onAbortHandlers,eventArgs)};if(Fit.Core.InstanceOf(request,Fit.Http.JsonpRequest)===false){request.OnSuccess(function(req){var children=request.GetResponseJson();onSuccess(children)});request.OnFailure(function(req){onFailure(request.GetHttpStatus())});request.OnAbort(function(req){onAbort()})}else{request.OnSuccess(function(req){var children=req.GetResponse();onSuccess(children)});request.OnTimeout(function(){onFailure("UNKNOWN (JSONP)")})}if(node!==null){var li=node.GetDomElement();request._loadingIndicator=document.createElement("i");Fit.Dom.AddClass(request._loadingIndicator,"FitUiControlLoadingIndicator");Fit.Dom.Add(li,request._loadingIndicator)}request.Start();return true}function createNodeFromJson(jsonNode){Fit.Validation.ExpectIsSet(jsonNode);var child=new Fit.Controls.TreeViewNode(jsonNode.Title?jsonNode.Title:jsonNode.Value,jsonNode.Value);if(jsonNode.Selectable!==undefined)child.Selectable(jsonNode.Selectable===true);if(jsonNode.Selected!==undefined)child.Selected(jsonNode.Selected===true);if(jsonNode.Children instanceof Array){Fit.Array.ForEach(jsonNode.Children,function(c){child.AddChild(createNodeFromJson(c))})}if(jsonNode.Expanded!==undefined)child.Expanded(jsonNode.Expanded===true);child.GetDomElement()._internal.WSHasChildren=jsonNode.HasChildren===true;if(jsonNode.HasChildren===true&&child.GetChildren().length===0){var expanderNode=new Fit.Controls.TreeViewNode("__","__");expanderNode.Selectable(false);child.AddChild(expanderNode)}child.Supplementary={};var reserved=new Array("Title","Value","Children","HasChildren","Selected","Selectable","Expanded");Fit.Array.ForEach(jsonNode,function(key){if(Fit.Array.Contains(reserved,key)===false)child.Supplementary[key]=jsonNode[key]});return child}function nodeFullyLoaded(node){var internal=node.GetDomElement()._internal;if(internal.WSSelectAll===true)return true;var parent=node.GetParent();while(parent!==null){if(parent.GetDomElement()._internal.WSSelectAll===true)return true;parent=parent.GetParent()}var fullyLoaded=true;Fit.Array.Recurse([node],"GetChildren",function(child){var childInternal=child.GetDomElement()._internal;if(childInternal.WSHasChildren===true&&childInternal.WSDone!==true){fullyLoaded=false;return false}});return fullyLoaded}function fireEventHandlers(handlers,eventArgs){var cancel=false;Fit.Array.ForEach(handlers,function(cb){if(cb(me,eventArgs)===false)cancel=true});return!cancel}function decodeReserved(str){Fit.Validation.ExpectString(str);return str.replace(/%3B/g,";").replace(/%3D/g,"=")}function encodeReserved(str){Fit.Validation.ExpectString(str);return str.replace(/;/g,"%3B").replace(/=/g,"%3D")}init()};Fit.Controls.WSTreeViewSelectAllMode={Progressively:"Progressively",Instantly:"Instantly"};Fit.Controls.WSTreeView.SelectAllMode=Fit.Controls.WSTreeViewSelectAllMode;return Fit}();return fitInstance});