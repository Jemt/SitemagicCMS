window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Models.Base=function(e){Fit.Validation.ExpectStringValue(e);var t=this,o=null,r=[],n=[],i=[];function a(e,t,o){return Fit.Validation.ExpectFunction(e),Fit.Validation.ExpectFunction(t),Fit.Validation.ExpectFunction(o,!0),function(r){return!0===Fit.Validation.IsSet(o)&&o(r,!0),!0===Fit.Validation.IsSet(r)&&t(r),e()}}function l(e,o,a){Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(o,!0),Fit.Validation.ExpectFunction(a,!0);var l=new Fit.Http.JsonRequest(t.GetWebServiceUrls()[e]);return l.OnRequest(function(o){if(!0!==l.SuppressEvents)return Fit.Array.ForEach(r,function(o){o(l,t,e)}),(!0!==Fit.Validation.IsSet(JSShop.Events.OnRequest)||!1!==JSShop.Events.OnRequest(l,[t],e))&&void 0}),l.OnSuccess(function(r){if(!0!==l.SuppressEvents){var i=l.GetResponseJson();if(null!==i&&Fit.Array.ForEach(t.GetProperties(),function(e){null!==i[e]&&void 0!==i[e]&&t[e](i[e])}),Fit.Array.ForEach(n,function(o){o(l,t,e)}),!0===Fit.Validation.IsSet(JSShop.Events.OnSuccess)&&JSShop.Events.OnSuccess(l,[t],e),!0===Fit.Validation.IsSet(o)&&o(l,t),null!==l.GetResponseHeader("Post-Process-Url")){var a=l.GetResponseHeader("Post-Process-Url"),s=l.GetResponseHeader("Post-Process-Payload"),c=l.GetResponseHeader("Post-Process-Arguments");"[same]"===a&&(a=t.GetWebServiceUrls()[e]);var d=new Fit.Http.JsonRequest(a+(null!==c?(a.indexOf("?")>-1?"&":"?")+c:""));d.SetData(null!==s?JSON.parse(s):{}),d.OnSuccess(function(){}),d.Start(),setTimeout(function(){d.Abort()},1e3)}}}),l.OnFailure(function(o){!0!==l.SuppressEvents&&(Fit.Array.ForEach(i,function(o){o(l,t,e)}),!0===Fit.Validation.IsSet(JSShop.Events.OnError)&&JSShop.Events.OnError(l,[t],e),!0===Fit.Validation.IsSet(a)&&a(l,t))}),l}this.InitializeModel=function(){o=t.GetWebServiceUrls();var e=t.GetProperties();Fit.Array.ForEach(e,function(o){"number"==typeof e[o]?t[o]=a(function(){return t.GetProperties()[o]},function(e){t.GetProperties()[o]=e},Fit.Validation.ExpectNumber):"string"==typeof e[o]?t[o]=a(function(){return t.GetProperties()[o]},function(e){t.GetProperties()[o]=e},Fit.Validation.ExpectString):"object"==typeof e[o]&&(t[o]=a(function(){return t.GetProperties()[o]},function(e){t.GetProperties()[o]=e},null))})},this.GetModelName=function(){Fit.Validation.ThrowError("Missing implementation")},this.GetProperties=function(){Fit.Validation.ThrowError("Missing implementation")},this.GetWebServiceUrls=function(){Fit.Validation.ThrowError("Missing implementation")},this.Create=function(e,r){Fit.Validation.ExpectFunction(e,!0),Fit.Validation.ExpectFunction(r,!0),!1===Fit.Validation.IsSet(o.Create)&&Fit.Validation.ThrowError("WebService URL not configured");var n=l("Create",e,r);n.SetData({Model:t.GetModelName(),Properties:Fit.Core.Clone(t.GetProperties()),Operation:"Create"}),n.Start()},this.Retrieve=function(e,r){Fit.Validation.ExpectFunction(e,!0),Fit.Validation.ExpectFunction(r,!0),!1===Fit.Validation.IsSet(o.Retrieve)&&Fit.Validation.ThrowError("WebService URL not configured");var n=l("Retrieve",e,r);n.SetData({Model:t.GetModelName(),Properties:Fit.Core.Clone(t.GetProperties()),Operation:"Retrieve"}),n.Start()},this.Update=function(e,r){Fit.Validation.ExpectFunction(e,!0),Fit.Validation.ExpectFunction(r,!0),!1===Fit.Validation.IsSet(o.Update)&&Fit.Validation.ThrowError("WebService URL not configured");var n=l("Update",e,r);n.SetData({Model:t.GetModelName(),Properties:Fit.Core.Clone(t.GetProperties()),Operation:"Update"}),n.Start()},this.Delete=function(e,r){Fit.Validation.ExpectFunction(e,!0),Fit.Validation.ExpectFunction(r,!0),!1===Fit.Validation.IsSet(o.Delete)&&Fit.Validation.ThrowError("WebService URL not configured");var n=l("Delete",e,r);n.SetData({Model:t.GetModelName(),Properties:Fit.Core.Clone(t.GetProperties()),Operation:"Delete"}),n.Start()},this.OnRequest=function(e){Fit.Validation.ExpectFunction(e),Fit.Array.Add(r,e)},this.OnResponse=function(e){Fit.Validation.ExpectFunction(e),Fit.Array.Add(n,e)},this.OnFailure=function(e){Fit.Validation.ExpectFunction(e),Fit.Array.Add(i,e)},this.toString=function(){return"JSShop.Models."+t.GetModelName()+" = "+JSON.stringify(t.GetProperties())},this._internal={CreateRequest:function(e,t,o){return Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(t,!0),Fit.Validation.ExpectFunction(o,!0),l(e,t,o)}}},JSShop.Models.Base.RetrieveAll=function(e,t,o,r,n){Fit.Validation.ExpectFunction(e),Fit.Validation.ExpectString(t),Fit.Validation.ExpectIsSet(o),Fit.Validation.ExpectFunction(r),Fit.Validation.ExpectFunction(n,!0);var i=new e("TemplateModel"+Fit.Data.CreateGuid());!1===Fit.Validation.IsSet(i.GetWebServiceUrls().RetrieveAll)&&Fit.Validation.ThrowError("WebService URL not configured");var a=i._internal.CreateRequest("RetrieveAll");a.SuppressEvents=!0,a.SetData({Model:i.GetModelName(),Properties:Fit.Core.Clone(i.GetProperties()),Operation:"RetrieveAll",Match:o}),a.OnRequest(function(e){if(!0===Fit.Validation.IsSet(JSShop.Events.OnRequest)&&!1===JSShop.Events.OnRequest(a,[],"RetrieveAll"))return!1}),a.OnSuccess(function(o){var n=a.GetResponseJson(),i=[];Fit.Array.ForEach(n,function(o){var r=new e(o[t]);Fit.Array.ForEach(r.GetProperties(),function(e){null!==o[e]&&void 0!==o[e]&&r[e](o[e])}),Fit.Array.Add(i,r)}),!0===Fit.Validation.IsSet(JSShop.Events.OnSuccess)&&JSShop.Events.OnSuccess(a,i,"RetrieveAll"),r(a,i)}),a.OnFailure(function(e){!0===Fit.Validation.IsSet(JSShop.Events.OnError)&&JSShop.Events.OnError(a,[],"RetrieveAll"),!0===Fit.Validation.IsSet(n)&&n(a,[])}),a.Start()},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Models.Basket={},JSShop.Models.Basket.Add=function(e,t){if(Fit.Validation.ExpectStringValue(e),Fit.Validation.ExpectInteger(t),!(t<1)){var o=JSShop.Cookies.Get("Basket"),r=null!==o?JSON.parse(o):{Items:[]},n=!1;if(Fit.Array.ForEach(r.Items,function(o){if(o.ProductId===e)return n=!0,o.Units=o.Units+t,!1}),!1===n){var i={ProductId:e,Units:t};Fit.Array.Add(r.Items,i)}JSShop.Cookies.Set("Basket",JSON.stringify(r))}},JSShop.Models.Basket.Update=function(e,t){if(Fit.Validation.ExpectStringValue(e),Fit.Validation.ExpectInteger(t),t<1)JSShop.Models.Basket.Remove(e);else{var o=JSShop.Cookies.Get("Basket"),r=null!==o?JSON.parse(o):{Items:[]},n=!1;Fit.Array.ForEach(r.Items,function(o){if(o.ProductId===e)return n=!0,o.Units=t,!1}),!0===n?JSShop.Cookies.Set("Basket",JSON.stringify(r)):JSShop.Models.Basket.Add(e,t)}},JSShop.Models.Basket.Remove=function(e){Fit.Validation.ExpectStringValue(e);var t=JSShop.Cookies.Get("Basket"),o=null!==t?JSON.parse(t):{Items:[]},r={Items:[]};Fit.Array.ForEach(o.Items,function(t){t.ProductId!==e&&Fit.Array.Add(r.Items,t)}),JSShop.Cookies.Set("Basket",JSON.stringify(r))},JSShop.Models.Basket.GetItems=function(){var e=JSShop.Cookies.Get("Basket");return(null!==e?JSON.parse(e):{Items:[]}).Items},JSShop.Models.Basket.Clear=function(){JSShop.Cookies.Remove("Basket")},JSShop.Models.Basket.CreateOrder=function(e,t,o){Fit.Validation.ExpectInstance(e,JSShop.Models.Order),Fit.Validation.ExpectFunction(t),Fit.Validation.ExpectFunction(o,!0);var r=JSShop.Cookies.Get("Basket"),n=null!==r?JSON.parse(r):{Items:[]},i=[],a=!1;Fit.Array.ForEach(n.Items,function(r){var l=new JSShop.Models.OrderEntry(Fit.Data.CreateGuid());l.OrderId(e.Id()),l.ProductId(r.ProductId),l.Units(r.Units),l.Create(function(r,s){Fit.Array.Add(i,l),i.length===n.Items.length&&(!1===a?e.Create(function(o,r){t(e)},function(t,r){!0===Fit.Validation.IsSet(o)&&o(e)}):!0===Fit.Validation.IsSet(o)&&o(e))},function(t,r){Fit.Array.Add(i,l),a=!0,i.length===n.Items.length&&!0===Fit.Validation.IsSet(o)&&o(e)})})},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Models.Config=function(e){Fit.Validation.ExpectStringValue(e,!0),Fit.Core.Extend(this,JSShop.Models.Base).Apply("-1");var t=this,o={Basic:{TermsPage:"",ReceiptPage:"",ShopBccEmail:""},MailTemplates:{Confirmation:"",Invoice:"",Templates:[]},PaymentMethods:[],CostCorrections:[],AdditionalData:""};this.GetModelName=function(){return"Config"},this.GetProperties=function(){return o},this.GetWebServiceUrls=function(){return{Retrieve:JSShop.WebService.Configuration.Retrieve,Update:JSShop.WebService.Configuration.Update}},this.Create=function(){Fit.Validation.ThrowError("Not supported")},this.Delete=function(){Fit.Validation.ThrowError("Not supported")},t.InitializeModel(),t.OnResponse(function(e,o,r){if("Retrieve"===r){var n=t.GetProperties();Fit.Validation.ExpectObject(n.Basic),Fit.Validation.ExpectObject(n.MailTemplates),Fit.Validation.ExpectArray(n.PaymentMethods),Fit.Validation.ExpectArray(n.CostCorrections),Fit.Validation.ExpectString(n.AdditionalData),Fit.Validation.ExpectString(n.Basic.TermsPage),Fit.Validation.ExpectString(n.Basic.ReceiptPage),Fit.Validation.ExpectString(n.Basic.ShopBccEmail),Fit.Validation.ExpectString(n.MailTemplates.Confirmation),Fit.Validation.ExpectString(n.MailTemplates.Invoice),Fit.Validation.ExpectArray(n.MailTemplates.Templates),Fit.Array.ForEach(n.PaymentMethods,function(e){Fit.Validation.ExpectString(e.Module),Fit.Validation.ExpectString(e.Title),Fit.Validation.ExpectBoolean(e.Enabled),Fit.Validation.ExpectArray(e.Settings),Fit.Array.ForEach(e.Settings,function(e){Fit.Validation.ExpectString(e.Title),Fit.Validation.ExpectString(e.Value)})}),Fit.Array.ForEach(n.CostCorrections,function(e){Fit.Validation.ExpectString(e.CostCorrection),Fit.Validation.ExpectString(e.Vat),Fit.Validation.ExpectString(e.Message)}),Fit.Array.ForEach(n.MailTemplates.Templates,function(e){Fit.Validation.ExpectString(e.Title),Fit.Validation.ExpectString(e.Subject),Fit.Validation.ExpectString(e.Content)})}})},JSShop.Models.Config.RetrieveAll=function(e,t,o){Fit.Validation.ThrowError("Not supported")},JSShop.Models.Config.Current=new JSShop.Models.Config("-1"),window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Models.Order=function(e){Fit.Validation.ExpectStringValue(e),Fit.Core.Extend(this,JSShop.Models.Base).Apply(e);var t=this,o={Id:e,Time:-1,ClientIp:"",Company:"",FirstName:"",LastName:"",Address:"",ZipCode:"",City:"",Email:"",Phone:"",Message:"",AltCompany:"",AltFirstName:"",AltLastName:"",AltAddress:"",AltZipCode:"",AltCity:"",Price:0,Vat:0,Currency:"",Weight:0,WeightUnit:"",CostCorrection1:0,CostCorrectionVat1:0,CostCorrectionMessage1:"",CostCorrection2:0,CostCorrectionVat2:0,CostCorrectionMessage2:"",CostCorrection3:0,CostCorrectionVat3:0,CostCorrectionMessage3:"",PaymentMethod:"",TransactionId:"",State:"",PromoCode:"",CustData1:"",CustData2:"",CustData3:"",InvoiceId:"",InvoiceTime:-1};function r(e){return Fit.Validation.ExpectString(e),JSShop.Models.Order.CalculateExpression(t.Price(),t.Vat(),t.Currency(),t.Weight(),t.WeightUnit(),""!==t.AltZipCode()?t.AltZipCode():t.ZipCode(),t.PaymentMethod(),t.PromoCode(),t.CustData1(),t.CustData2(),t.CustData3(),e,"number")}function n(e){return Fit.Validation.ExpectString(e),JSShop.Models.Order.CalculateExpression(t.Price(),t.Vat(),t.Currency(),t.Weight(),t.WeightUnit(),""!==t.AltZipCode()?t.AltZipCode():t.ZipCode(),t.PaymentMethod(),t.PromoCode(),t.CustData1(),t.CustData2(),t.CustData3(),e,"string")}this.GetModelName=function(){return"Order"},this.GetProperties=function(){return o},this.GetWebServiceUrls=function(){return{Create:JSShop.WebService.Orders.Create,Retrieve:JSShop.WebService.Orders.Retrieve,RetrieveAll:JSShop.WebService.Orders.RetrieveAll,Update:JSShop.WebService.Orders.Update,Delete:JSShop.WebService.Orders.Delete}},this.CalculateCostCorrection1=function(){return r(JSShop.Settings.CostCorrection1?JSShop.Settings.CostCorrection1:"")},this.CalculateCostCorrectionVat1=function(){return r(JSShop.Settings.CostCorrectionVat1?JSShop.Settings.CostCorrectionVat1:"")},this.CalculateCostCorrectionMessage1=function(){return n(JSShop.Settings.CostCorrectionMessage1?JSShop.Settings.CostCorrectionMessage1:"")},this.CalculateCostCorrection2=function(){return r(JSShop.Settings.CostCorrection2?JSShop.Settings.CostCorrection2:"")},this.CalculateCostCorrectionVat2=function(){return r(JSShop.Settings.CostCorrectionVat2?JSShop.Settings.CostCorrectionVat2:"")},this.CalculateCostCorrectionMessage2=function(){return n(JSShop.Settings.CostCorrectionMessage2?JSShop.Settings.CostCorrectionMessage2:"")},this.CalculateCostCorrection3=function(){return r(JSShop.Settings.CostCorrection3?JSShop.Settings.CostCorrection3:"")},this.CalculateCostCorrectionVat3=function(){return r(JSShop.Settings.CostCorrectionVat3?JSShop.Settings.CostCorrectionVat3:"")},this.CalculateCostCorrectionMessage3=function(){return n(JSShop.Settings.CostCorrectionMessage3?JSShop.Settings.CostCorrectionMessage3:"")},this.CapturePayment=function(e,o){if(Fit.Validation.ExpectFunction(e),Fit.Validation.ExpectFunction(o,!0),JSShop.Settings.PaymentCaptureUrl){var r=new Fit.Http.Request(JSShop.Settings.PaymentCaptureUrl);r.AddData("OrderId",t.Id()),r.OnSuccess(function(o){t.State("Captured"),e(r,t)}),r.OnFailure(function(e){!0===Fit.Validation.IsSet(o)&&o(r,t)}),r.Start()}else!0===Fit.Validation.IsSet(o)&&o(t)},this.CancelPayment=function(e,o){if(Fit.Validation.ExpectFunction(e),Fit.Validation.ExpectFunction(o,!0),JSShop.Settings.PaymentCancelUrl){var r=new Fit.Http.Request(JSShop.Settings.PaymentCancelUrl);r.AddData("OrderId",t.Id()),r.OnSuccess(function(o){t.State("Canceled"),e(r,t)}),r.OnFailure(function(e){!0===Fit.Validation.IsSet(o)&&o(r,t)}),r.Start()}else!0===Fit.Validation.IsSet(o)&&o(null,t)},this.SendInvoice=function(e,o){if(Fit.Validation.ExpectFunction(e),Fit.Validation.ExpectFunction(o,!0),JSShop.Settings.SendInvoiceUrl){var r=new Fit.Http.Request(JSShop.Settings.SendInvoiceUrl);r.AddData("OrderId",t.Id()),r.OnSuccess(function(o){e(r,t)}),r.OnFailure(function(e){!0===Fit.Validation.IsSet(o)&&o(r,t)}),r.Start()}else!0===Fit.Validation.IsSet(o)&&o(null,t)},t.InitializeModel()},JSShop.Models.Order.RetrieveAll=function(e,t,o,r,n){Fit.Validation.ExpectString(e),Fit.Validation.ExpectInteger(t),Fit.Validation.ExpectInteger(o),Fit.Validation.ExpectFunction(r),Fit.Validation.ExpectFunction(n,!0);var i=[];if(""!==e)Fit.Array.ForEach(["FirstName","LastName","Address","City","ZipCode","Email","Phone","Message","AltFirstName","AltLastName","AltAddress","AltCity","AltZipCode"],function(r){var n=[];Fit.Array.Add(n,{Field:"Time",Operator:">=",Value:t}),Fit.Array.Add(n,{Field:"Time",Operator:"<=",Value:o}),Fit.Array.Add(n,{Field:r,Operator:"CONTAINS",Value:e}),Fit.Array.Add(i,n)});else{var a=[];Fit.Array.Add(a,{Field:"Time",Operator:">=",Value:t}),Fit.Array.Add(a,{Field:"Time",Operator:"<=",Value:o}),Fit.Array.Add(i,a)}JSShop.Models.Base.RetrieveAll(JSShop.Models.Order,"Id",i,r,n)},JSShop.Models.Order.CalculateExpression=function(price,vat,currency,weight,weightUnit,zipCode,paymentMethod,promoCode,custData1,custData2,custData3,expression,returnType){if(Fit.Validation.ExpectNumber(price),Fit.Validation.ExpectNumber(vat),Fit.Validation.ExpectString(currency),Fit.Validation.ExpectNumber(weight),Fit.Validation.ExpectString(weightUnit),Fit.Validation.ExpectString(zipCode),Fit.Validation.ExpectString(paymentMethod),Fit.Validation.ExpectString(promoCode),Fit.Validation.ExpectString(custData1),Fit.Validation.ExpectString(custData2),Fit.Validation.ExpectString(custData3),Fit.Validation.ExpectString(expression),Fit.Validation.ExpectStringValue(returnType),""===expression){if("number"===returnType)return 0;if("string"===returnType)return"";throw"InvalidReturnType: Return type must be either 'string' or 'number'"}var ex=expression;ex=ex.replace(/\r|\n|\t/g,""),ex=ex.replace(/\/\*.*?\*\//g,""),ex=ex.replace(/price|vat|currency|weightunit|weight|zipcodeval|zipcode|paymentmethod|promocode|custdata1|custdata2|custdata3|data/g,""),ex=ex.replace(/JSShop.Floor|JSShop.Ceil|JSShop.Round/g,""),ex=ex.replace(/ |[0-9]|\*|\+|\-|\/|%|=|&|\||!|\.|:|\(|\)|\[|\]|>|<|\?|true|false/g,""),ex=ex.replace(/(["']).*?\1/g,"");var secure=""===ex;if(!1===secure)throw"InvalidExpression: Invalid and potentially insecure expression detected - evaluation aborted";var zipCodeVal=!1===isNaN(parseInt(zipCode))&&parseInt(zipCode)+""===zipCode?parseInt(zipCode):-1,expr="";expr+="var price = "+price+";",expr+="var vat = "+vat+";",expr+='var currency = "'+currency+'";',expr+="var weight = "+weight+";",expr+='var weightunit = "'+weightUnit+'";',expr+='var zipcode = "'+zipCode+'";',expr+="var zipcodeval = "+zipCodeVal+";",expr+='var paymentmethod = "'+paymentMethod+'";',expr+='var promocode = "'+promoCode+'";',expr+='var custdata1 = "'+custData1+'";',expr+='var custdata2 = "'+custData2+'";',expr+='var custdata3 = "'+custData3+'";',expr+="var data = "+(JSShop.Settings.AdditionalData?JSON.stringify(JSShop.Settings.AdditionalData):"{}")+";",expr+="("+expression.replace(/JSShop\.Floor/g,"Math.floor").replace(/JSShop\.Ceil/g,"Math.ceil").replace(/JSShop\.Round/g,"Math.round")+");";var result=eval(expr);"string"==typeof result&&(result=Fit.String.EncodeHtml(result));var isValid=!1;if("number"===returnType)isValid=/^\-?([0-9]+(\.[0-9]+)?)$/.test(result.toString()),isValid=!0===isValid&&"number"==typeof result;else{if("string"!==returnType)throw"InvalidReturnType: Return type must be either 'string' or 'number'";isValid="string"==typeof result}if(!1===isValid)throw"InvalidExpressionResult: Expression did not produce a valid value of type '"+returnType+"'";return result},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Models.OrderEntry=function(e){Fit.Validation.ExpectStringValue(e),Fit.Core.Extend(this,JSShop.Models.Base).Apply(e);var t=this,o={Id:e,OrderId:"",ProductId:"",UnitPrice:0,Vat:0,Currency:"",Units:0,Discount:0,DiscountMessage:""};this.GetModelName=function(){return"OrderEntry"},this.GetProperties=function(){return o},this.GetWebServiceUrls=function(){return{Create:JSShop.WebService.OrderEntries.Create,Retrieve:JSShop.WebService.OrderEntries.Retrieve,RetrieveAll:JSShop.WebService.OrderEntries.RetrieveAll,Update:JSShop.WebService.OrderEntries.Update,Delete:JSShop.WebService.OrderEntries.Delete}},t.InitializeModel()},JSShop.Models.OrderEntry.RetrieveAll=function(e,t,o){Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(t),Fit.Validation.ExpectFunction(o,!0);var r=[[{Field:"OrderId",Operator:"=",Value:e}]];JSShop.Models.Base.RetrieveAll(JSShop.Models.OrderEntry,"Id",r,t,o)},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Models.Product=function(itemId){Fit.Validation.ExpectStringValue(itemId),Fit.Core.Extend(this,JSShop.Models.Base).Apply(itemId);var me=this,properties={Id:itemId,Category:"",Title:"",Description:"",Images:"",Price:0,Vat:0,Currency:"",Weight:0,WeightUnit:"",DeliveryTime:"",DiscountExpression:"",DiscountMessage:""};function init(){me.InitializeModel()}function calculateExpression(units,expression,returnType){if(Fit.Validation.ExpectInteger(units),Fit.Validation.ExpectString(expression),Fit.Validation.ExpectStringValue(returnType),""===expression){if("number"===returnType)return 0;if("string"===returnType)return"";throw"InvalidReturnType: Return type must be either 'string' or 'number'"}var ex=expression;ex=ex.replace(/\r|\n|\t/g,""),ex=ex.replace(/\/\*.*?\*\//g,""),ex=ex.replace(/data|units|price|vat|currency|weight|weightunit/g,""),ex=ex.replace(/JSShop.Floor|JSShop.Ceil|JSShop.Round/g,""),ex=ex.replace(/ |[0-9]|\*|\+|\-|\/|%|=|&|\||!|\.|:|\(|\)|\[|\]|>|<|\?|true|false/g,""),ex=ex.replace(/(["']).*?\1/g,"");var secure=""===ex;if(!1===secure)throw"InvalidExpression: Invalid and potentially insecure expression detected - evaluation aborted";var expr="";expr+="var units = "+units+";",expr+="var price = "+me.Price()+";",expr+="var vat = "+me.Vat()+";",expr+='var currency = "'+me.Currency()+'";',expr+='var weight = "'+me.Weight()+'";',expr+='var weightunit = "'+me.WeightUnit()+'";',expr+="var data = "+(JSShop.Settings.AdditionalData?JSON.stringify(JSShop.Settings.AdditionalData):"{}")+";",expr+="("+expression.replace(/JSShop\.Floor/g,"Math.floor").replace(/JSShop\.Ceil/g,"Math.ceil").replace(/JSShop\.Round/g,"Math.round")+");";var result=eval(expr);"string"==typeof result&&(result=Fit.String.EncodeHtml(result));var isValid=!1;if("number"===returnType)isValid=/^\-?([0-9]+(\.[0-9]+)?)$/.test(result.toString()),isValid=!0===isValid&&"number"==typeof result;else{if("string"!==returnType)throw"InvalidReturnType: Return type must be either 'string' or 'number'";isValid="string"==typeof result}if(!1===isValid)throw"InvalidExpressionResult: Expression did not produce a valid value of type '"+returnType+"'";return result}this.GetModelName=function(){return"Product"},this.GetProperties=function(){return properties},this.GetWebServiceUrls=function(){return{Create:JSShop.WebService.Products.Create,Retrieve:JSShop.WebService.Products.Retrieve,RetrieveAll:JSShop.WebService.Products.RetrieveAll,Update:JSShop.WebService.Products.Update,Delete:JSShop.WebService.Products.Delete}},this.CalculateDiscount=function(e){return Fit.Validation.ExpectInteger(e),""===me.DiscountExpression()?0:calculateExpression(e,me.DiscountExpression(),"number")},this.CalculateDiscountMessage=function(e){return Fit.Validation.ExpectInteger(e),""===me.DiscountMessage()?"":calculateExpression(e,me.DiscountMessage(),"string")},init()},JSShop.Models.Product.RetrieveAll=function(e,t,o){Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(t),Fit.Validation.ExpectFunction(o,!0);var r=""!==e?[[{Field:"Category",Operator:"=",Value:e}]]:[];JSShop.Models.Base.RetrieveAll(JSShop.Models.Product,"Id",r,t,o)},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Presenters.Base=function(){var e=this,t=[],o=[];this.GetDomElement=function(){throw new Error("Not implemented")},this.Render=function(r){Fit.Validation.ExpectDomElement(r),Fit.Array.ForEach(t,function(t){t(e)}),Fit.Dom.Add(r,e.GetDomElement()),Fit.Array.ForEach(o,function(t){t(e)})},this.OnRender=function(e){Fit.Validation.ExpectFunction(e),Fit.Array.Add(t,e)},this.OnRendered=function(e){Fit.Validation.ExpectFunction(e),Fit.Array.Add(o,e)}},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Presenters.Basket=function(){Fit.Core.Extend(this,JSShop.Presenters.Base).Apply();var e=this,t=null,o=JSShop.Models.Basket,r=JSShop.Language.Translations,n="",i="",a="",l="",s="",c="",d=[],u=[],S={Price:-1,Vat:-1};function p(){var h=o.GetItems();if(Fit.Array.ForEach(d,function(t){t(e)}),null===document.querySelector("link[href*='/Views/Basket.css']")&&Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/Views/Basket.css?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0")),0!==h.length){var C=new Fit.Http.Request(JSShop.GetPath()+"/Views/Basket.html?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));C.OnSuccess(function(d){var m=C.GetResponseText();m=(m=(m=(m=(m=(m=(m=m.replace(/{\[HeaderProduct\]}/g,r.Basket.Product)).replace(/{\[HeaderUnitPrice\]}/g,r.Basket.UnitPrice)).replace(/{\[HeaderUnits\]}/g,r.Basket.Units)).replace(/{\[HeaderDiscount\]}/g,r.Basket.Discount)).replace(/{\[HeaderPrice\]}/g,r.Basket.Price)).replace(/{\[HeaderTotalVat\]}/g,r.Basket.TotalVat)).replace(/{\[HeaderTotalPrice\]}/g,r.Basket.TotalPrice);var F="\x3c!-- REPEAT Items --\x3e",g="\x3c!-- /REPEAT Items --\x3e",y=new RegExp(F+"[\\s\\S]*"+g).exec(m);if(null!==y){var f="",V=0,J=0,E=0,v=0,A=y[0],x=A.indexOf(F)+F.length,P=A.indexOf(g);A=A.substring(x,P);var D=h.length,O=null,I=!1,T=null,M=!1,L=-99999.99,w=!0;Fit.Array.ForEach(h,function(d){var C=new JSShop.Models.Product(d.ProductId);C.Retrieve(function(F,g){if(D--,d.Product=C,0===D){Fit.Array.ForEach(h,function(e){O=null!==O?O:e.Product.Currency(),e.Product.Currency()!==O&&(I=!0),T=null!==T?T:e.Product.WeightUnit(),e.Product.WeightUnit()!==T&&(M=!0);var t=A,o=Fit.Math.Round(e.Product.CalculateDiscount(e.Units),2),n=JSShop.CalculatePricing(e.Product.Price(),e.Units,e.Product.Vat(),o);t=(t=(t=(t=(t=(t=(t=t.replace(/{\[Title\]}/g,e.Product.Title())).replace(/{\[UnitPrice\]}/g,Fit.Math.Format(n.UnitPriceInclVat,2,r.Locale.DecimalSeparator))).replace(/{\[DiscountMessage\]}/g,n.DiscountInclVat>0?e.Product.CalculateDiscountMessage(e.Units):"")).replace(/{\[Discount\]}/g,n.DiscountInclVat>0?Fit.Math.Format(-1*n.DiscountInclVat,2,r.Locale.DecimalSeparator):"")).replace(/{\[Units\]}/g,"<div id='JSShopBasketItem"+e.ProductId+"'></div>")).replace(/{\[Currency\]}/g,e.Product.Currency())).replace(/{\[Price\]}/g,Fit.Math.Format(n.TotalInclVat,2,r.Locale.DecimalSeparator)),f+=t,V=Fit.Math.Round(V+n.TotalVat,2),J=Fit.Math.Round(J+n.TotalInclVat,2),E=Fit.Math.Round(E+n.DiscountInclVat,2),v=Fit.Math.Round(v+e.Units*e.Product.Weight(),2),-99999.99===L&&(L=n.VatFactor),L!==n.VatFactor&&(w=!1)});var x=[{Expression:JSShop.Settings.CostCorrection1?JSShop.Settings.CostCorrection1:"",Vat:JSShop.Settings.CostCorrectionVat1?JSShop.Settings.CostCorrectionVat1:"",Msg:JSShop.Settings.CostCorrectionMessage1?JSShop.Settings.CostCorrectionMessage1:"",CostCorrectionExVat:0,CostCorrectionVat:0},{Expression:JSShop.Settings.CostCorrection2?JSShop.Settings.CostCorrection2:"",Vat:JSShop.Settings.CostCorrectionVat2?JSShop.Settings.CostCorrectionVat2:"",Msg:JSShop.Settings.CostCorrectionMessage2?JSShop.Settings.CostCorrectionMessage2:"",CostCorrectionExVat:0,CostCorrectionVat:0},{Expression:JSShop.Settings.CostCorrection3?JSShop.Settings.CostCorrection3:"",Vat:JSShop.Settings.CostCorrectionVat3?JSShop.Settings.CostCorrectionVat3:"",Msg:JSShop.Settings.CostCorrectionMessage3?JSShop.Settings.CostCorrectionMessage3:"",CostCorrectionExVat:0,CostCorrectionVat:0}];Fit.Array.ForEach(x,function(e){if(e.Expression){var t=JSShop.Models.Order.CalculateExpression(J-V,V,O,v,T,n,i,a,l,s,c,e.Expression,"number"),o=0;if(t>0||t<0){var d=0;e.Vat&&(d=JSShop.Models.Order.CalculateExpression(J-V,V,O,v,T,n,i,a,l,s,c,e.Vat,"number"));var u=JSShop.CalculatePricing(t,1,d,0);t=u.TotalExclVat,o=u.TotalInclVat;var S="";e.Msg&&(S=JSShop.Models.Order.CalculateExpression(J-V,V,O,v,T,n,i,a,l,s,c,e.Msg,"string"));var p=A;p=(p=(p=(p=(p=(p=(p=p.replace(/{\[Title\]}/g,S)).replace(/{\[UnitPrice\]}/g,"&nbsp;")).replace(/{\[Discount\]}/g,"")).replace(/{\[DiscountMessage\]}/g,"")).replace(/{\[Units\]}/g,"&nbsp;")).replace(/{\[Currency\]}/g,O)).replace(/{\[Price\]}/g,Fit.Math.Format(o,2,r.Locale.DecimalSeparator)),f+=p,e.CostCorrectionExVat=t,e.CostCorrectionVat=o-t,L!==u.VatFactor&&(w=!1)}}}),Fit.Array.ForEach(x,function(e){V+=e.CostCorrectionVat,J+=e.CostCorrectionExVat+e.CostCorrectionVat}),!0===w&&(V=Fit.Math.Round(J-J/L,2)),S={Price:J-V,Vat:V},m=(m=(m=(m=(m=m.replace(y[0],f)).replace(/{\[Currency\]}/g,h[0].Product.Currency())).replace(/{\[TotalVat\]}/g,Fit.Math.Format(V,2,r.Locale.DecimalSeparator))).replace(/{\[TotalPrice\]}/g,Fit.Math.Format(J,2,r.Locale.DecimalSeparator))).replace(/{\[TotalDiscount\]}/g,Fit.Math.Format(E,2,r.Locale.DecimalSeparator)),t.innerHTML=m,Fit.Array.ForEach(h,function(e){var n=new Fit.Controls.Button(Fit.Data.CreateGuid());n.Title(e.Units.toString()),n.Type(Fit.Controls.Button.Type.Default),n.GetDomElement().style.cssText="font-size: 0.9em; padding: 2px 10px 2px 10px;",n.Width(4,"em"),n.Render(t.querySelector("#JSShopBasketItem"+e.ProductId)),n.OnClick(function(t){var n="";n+="<div style='text-align: center' id='JSShopUnitsDialogInput'>",n+="<b>"+e.Product.Title()+"</b><br><br>",n+=r.Basket.NumberOfUnits+":<br><br>",n+="</div>";var i=new Fit.Controls.Dialog;i.Modal(!0),i.Content(n);var a=e.Units.toString(),l=new Fit.Controls.Input(Fit.Data.CreateGuid());l.Width(4,"em"),l.OnChange(function(e){""!==l.Value()&&(!0===isNaN(parseInt(l.Value()))||parseInt(l.Value()).toString()!==l.Value()||parseInt(l.Value())<0||parseInt(l.Value())>999999?l.Value(a):a=l.Value())}),l.OnBlur(function(e){""===l.Value()&&l.Value("0")}),l.Render(i.GetDomElement().querySelector("#JSShopUnitsDialogInput"));var s=new Fit.Controls.Button(Fit.Data.CreateGuid());s.Title(r.Common.Ok),s.Type(Fit.Controls.Button.Type.Success),s.OnClick(function(t){o.Update(e.ProductId,parseInt(l.Value())),i.Close(),p()}),i.AddButton(s);var c=new Fit.Controls.Button(Fit.Data.CreateGuid());c.Title(r.Common.Cancel),c.Type(Fit.Controls.Button.Type.Danger),c.OnClick(function(e){i.Close()}),i.AddButton(c),Fit.Events.AddHandler(l.GetDomElement(),"keydown",function(e){13===Fit.Events.GetEvent(e).keyCode&&(""===l.Value()&&l.Value("0"),s.Click())}),Fit.Events.AddHandler(i.GetDomElement(),"keydown",function(e){27===Fit.Events.GetEvent(e).keyCode&&i.Close()}),i.Open(),l.Focused(!0)})}),!0===I&&Fit.Controls.Dialog.Alert(r.Basket.ErrorCurrencies),!0===M&&Fit.Controls.Dialog.Alert(r.Basket.ErrorWeightUnits),Fit.Array.ForEach(u,function(t){t(e)})}})})}}),C.Start()}else t.innerHTML=r.Basket.BasketEmpty}function h(e){Fit.Validation.ExpectString(e);for(var t=1;t<=3;t++)if(JSShop.Settings["CostCorrection"+t]&&JSShop.Settings["CostCorrection"+t].indexOf(e)>-1||JSShop.Settings["CostCorrectionVat"+t]&&JSShop.Settings["CostCorrectionVat"+t].indexOf(e)>-1||JSShop.Settings["CostCorrectionMessage"+t]&&JSShop.Settings["CostCorrectionMessage"+t].indexOf(e)>-1)return!0;return!1}t=document.createElement("div"),this.ZipCode=function(e){return Fit.Validation.ExpectString(e,!0),!0===Fit.Validation.IsSet(e)&&e!==n&&!0===h("zipcode")&&(n=e,p()),n},this.PaymentMethod=function(e){return Fit.Validation.ExpectString(e,!0),!0===Fit.Validation.IsSet(e)&&e!==i&&!0===h("paymentmethod")&&(i=e,p()),i},this.PromoCode=function(e){return Fit.Validation.ExpectString(e,!0),!0===Fit.Validation.IsSet(e)&&e!==a&&!0===h("promocode")&&(a=e,p()),a},this.CustData1=function(e){return Fit.Validation.ExpectString(e,!0),!0===Fit.Validation.IsSet(e)&&e!==l&&!0===h("custdata1")&&(l=e,p()),l},this.CustData2=function(e){return Fit.Validation.ExpectString(e,!0),!0===Fit.Validation.IsSet(e)&&e!==s&&!0===h("custdata2")&&(s=e,p()),s},this.CustData3=function(e){return Fit.Validation.ExpectString(e,!0),!0===Fit.Validation.IsSet(e)&&e!==c&&!0===h("custdata3")&&(c=e,p()),c},this.GetPricing=function(){return S},this.GetDomElement=function(){return t},this.Update=function(){!0===Fit.Dom.IsRooted(t)&&p()},this.OnUpdate=function(e){Fit.Validation.ExpectFunction(e),Fit.Array.Add(d,e)},this.OnUpdated=function(e){Fit.Validation.ExpectFunction(e),Fit.Array.Add(u,e)},p()},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Presenters.Config=function(){Fit.Core.Extend(this,JSShop.Presenters.Base).Apply();var e=null,t=null,o=null,r=JSShop.Language.Translations,n=[],i=null,a=-1;function l(e,t){Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(t);var o=new Fit.Controls.Button(Fit.Data.CreateGuid());return o.Title(e),o.Type(Fit.Controls.Button.Type.Default),o.OnClick(function(e){t(e)}),Fit.Array.Add(n,o),o}function s(){var e=t.Content.Properties.GetItems();Fit.Array.ForEach(e,function(e){e.PropertyValue.FitControl.Dispose()})}function c(e){Fit.Validation.ExpectInstance(e,Fit.Controls.Button),C(e),s(),t.Content.Properties.Clear(),t.Content.Headline=r.Config.Basic;var n=t.Content.Properties.AddItem();n.PropertyName=r.Config.Receipt,JSShop.Settings.Pages&&JSShop.Settings.Pages.length>0?n.PropertyValue=h(o.Basic.ReceiptPage?o.Basic.ReceiptPage:"",JSShop.Settings.Pages,function(e,t){o.Basic.ReceiptPage=t}):n.PropertyValue=u(o.Basic.ReceiptPage?o.Basic.ReceiptPage:"",function(e,t){o.Basic.ReceiptPage=t}),(n=t.Content.Properties.AddItem()).PropertyName=r.Config.Terms,JSShop.Settings.Pages&&JSShop.Settings.Pages.length>0?n.PropertyValue=h(o.Basic.TermsPage?o.Basic.TermsPage:"",JSShop.Settings.Pages,function(e,t){o.Basic.TermsPage=t}):n.PropertyValue=u(o.Basic.TermsPage?o.Basic.TermsPage:"",function(e,t){o.Basic.TermsPage=t}),(n=t.Content.Properties.AddItem()).PropertyName=r.Config.BccEmail,n.PropertyValue=u(o.Basic.ShopBccEmail?o.Basic.ShopBccEmail:"",function(e,t){o.Basic.ShopBccEmail=t}),t.Update()}function d(e,t,o){Fit.Validation.ExpectInstance(e,Fit.Controls.Button),Fit.Validation.ExpectTypeArray(t,Fit.Validation.ExpectString),Fit.Validation.ExpectFunction(o);var r=new Fit.Controls.ContextMenu;Fit.Array.ForEach(t,function(e){var t=0!==e.indexOf("!"),o=!0===t?e:e.substring(1),n=new Fit.Controls.ContextMenu.Item(o,o);n.Selectable(t),r.AddChild(n)}),r.OnSelect(function(e,t){o(t.Value()),r.Hide()});var n=e.GetDomElement(),i=Fit.Dom.GetPosition(n),a=i.X,l=i.Y+n.offsetHeight;r.Show(a,l)}function u(e,t){Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(t);var o=new Fit.Controls.Input(Fit.Data.CreateGuid());return o.Value(e),o.OnChange(function(e){t(e,o.Value())}),o.Width(700),o.GetDomElement().FitControl=o,o.GetDomElement()}function S(e,t){Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(t);var o=u(e,t);return o.FitControl.CheckSpelling(!1),o.FitControl.MultiLine(!0),o.FitControl.Height(-1),o.FitControl.Value(e),setTimeout(function(){var e;e=o.FitControl,Fit.Validation.ExpectInstance(e,Fit.Controls.Input),m(function(){var t=CodeMirror.fromTextArea(e.GetDomElement().querySelector("textarea"),{lineNumbers:!0,mode:"javascript",matchBrackets:!0,viewportMargin:1/0,styleActiveLine:!0});t.getWrapperElement().style.cssText+="; border: 1px solid silver; height: auto;",t.on("change",function(t,o){e.Value(t.getValue())})})},0),o}function p(e,t,o){Fit.Validation.ExpectString(e),Fit.Validation.ExpectString(t),Fit.Validation.ExpectFunction(o);var n=S(e,o);return n.FitControl.SetValidationCallback(function(e){if(""===e)return!0;try{JSShop.Models.Order.CalculateExpression(100,.1,"USD",.5,"kg","5000","DIBS","TvCampaign","A","B","C",e,t),JSShop.Models.Order.CalculateExpression(1,.25,"DKK",25,"lbs","9850","QuickPay","Spring","X","Y","Z",e,t)}catch(e){return!1}return!0},r.Config.InvalidExpression),n}function h(e,t,o){Fit.Validation.ExpectString(e),Fit.Validation.ExpectArray(t),Fit.Validation.ExpectFunction(o);var r=new Fit.Controls.DropDown(Fit.Data.CreateGuid());r.SetPicker(new Fit.Controls.ListView);var n=e;return Fit.Array.ForEach(t,function(t){Fit.Validation.ExpectString(t.Title),Fit.Validation.ExpectString(t.Value),t.Value===e&&(n=t.Title),r.GetPicker().AddItem(t.Title,t.Value)}),r.AddSelection(n,e),r.OnChange(function(e){o(e,0!==r.GetSelections().length?r.GetSelections()[0].Value:"")}),r.Width(700),r.GetDomElement().FitControl=r,r.GetDomElement()}function C(e){Fit.Validation.ExpectInstance(e,Fit.Controls.Button),Fit.Array.ForEach(n,function(e){e.Type(Fit.Controls.Button.Type.Default)}),e.Type(Fit.Controls.Button.Type.Primary),e.Focused(!1)}function m(e){Fit.Validation.ExpectFunction(e,!0);var t=e||function(){};if(1===a)t();else if(0===a){var o=-1;o=setInterval(function(){1===a&&(clearInterval(o),t())},250)}else a=0,Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/CodeMirror/codemirror.min.css"),Fit.Loader.LoadScript(JSShop.GetPath()+"/CodeMirror/codemirror.bundled.min.js",function(e){a=1,t()})}this.GetDomElement=function(){return e},null===document.querySelector("link[href*='/Views/Config.css']")&&Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/Views/Config.css?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0")),e=document.createElement("div"),(t=new Fit.Template(!0)).Render(e),JSShop.Models.Config.Current.Retrieve(function(e){o=JSShop.Models.Config.Current.GetProperties(),t.LoadUrl(JSShop.GetPath()+"/Views/Config.html?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"),function(e,n){var a=l(r.Config.Basic,function(e){c(e)}),h=l(r.Config.EmailTemplates,function(e){!function(e){Fit.Validation.ExpectInstance(e,Fit.Controls.Button);var n=[],i=o.MailTemplates.Templates?o.MailTemplates.Templates:[];Fit.Array.ForEach(i,function(e){Fit.Array.Add(n,e.Title)}),d(e,n,function(n){!function(e,n){Fit.Validation.ExpectInstance(e,Fit.Controls.Button),Fit.Validation.ExpectString(n),C(e),s(),t.Content.Properties.Clear();var i=o.MailTemplates.Templates?o.MailTemplates.Templates:[],a=null;Fit.Array.ForEach(i,function(e){if(e.Title===n)return a=e,!1}),t.Content.Headline=a.Title;var l=t.Content.Properties.AddItem();l.PropertyName=r.Config.Subject,l.PropertyValue=u(a.Subject,function(e,t){a.Subject=t});var c="\x3c!-- JSShopAutoLineBreaks --\x3e\n",d=0===a.Content.indexOf(c),S=a.Content.replace(c,"");S=!0===d?S.replace(/<br\s?\/?>/g,"\n"):S;var p=t.Content.Properties.AddItem();p.PropertyName=r.Config.Content,p.PropertyValue=u("",function(e,t){a.Content=!0===d?c+t.replace(/\n/g,"<br>"):t}),p.PropertyValue.FitControl.Width(700),p.PropertyValue.FitControl.Height(250),p.PropertyValue.FitControl.MultiLine(!0),p.PropertyValue.FitControl.Maximizable(!0),p.PropertyValue.FitControl.Value(S);var h=new Fit.Controls.CheckBox(Fit.Data.CreateGuid());h.Label(Fit.String.EncodeHtml(r.Config.AutoLineBreaks)),h.Checked(d),h.OnChange(function(e){!0===h.Checked()?(a.Content=c+p.PropertyValue.FitControl.Value().replace(/\n/g,"<br>"),p.PropertyValue.FitControl.Value(p.PropertyValue.FitControl.Value().replace(/<br\s?\/?>/g,"\n")),d=!0):(a.Content=p.PropertyValue.FitControl.Value().replace(c,""),p.PropertyValue.FitControl.Value(p.PropertyValue.FitControl.Value().replace(/\n/g,"<br>")),d=!1)}),h.GetDomElement().FitControl=h,t.Content.Properties.AddItem().PropertyValue=h.GetDomElement(),t.Update()}(e,n)})}(e)}),F=l(r.Config.PaymentMethods,function(e){!function(e){Fit.Validation.ExpectInstance(e,Fit.Controls.Button);var n=[];Fit.Array.ForEach(o.PaymentMethods,function(e){Fit.Array.Add(n,e.Module)}),d(e,n,function(n){!function(e,n){Fit.Validation.ExpectInstance(e,Fit.Controls.Button),Fit.Validation.ExpectString(n),C(e),s(),t.Content.Properties.Clear();var i=null;Fit.Array.ForEach(o.PaymentMethods,function(e){if(e.Module===n)return i=e,!1}),t.Content.Headline=i.Module;var a=new Fit.Controls.CheckBox(Fit.Data.CreateGuid());a.Label(r.Config.EnableModule),a.Checked(i.Enabled),a.OnChange(function(e){i.Enabled=a.Checked()}),a.GetDomElement().FitControl=a;var l=t.Content.Properties.AddItem();l.PropertyName=r.Config.Title,l.PropertyValue=u(i.Title,function(e,t){i.Title=t}),Fit.Array.ForEach(i.Settings?i.Settings:[],function(e){var o=t.Content.Properties.AddItem();o.PropertyName=e.Title,o.PropertyValue=u(e.Value,function(t,o){e.Value=o})});var c=t.Content.Properties.AddItem();c.PropertyName=r.Config.Enabled,c.PropertyValue=a.GetDomElement(),t.Update()}(e,n)})}(e)}),g=l(r.Config.Advanced,function(e){!function(e){Fit.Validation.ExpectInstance(e,Fit.Controls.Button);var n=[];Fit.Array.Add(n,(o.MailTemplates.Templates&&0!==o.MailTemplates.Templates.length?"":"!")+r.Config.EmailTemplates);for(var i=0;i<3;i++)Fit.Array.Add(n,(o.CostCorrections&&o.CostCorrections[i]?"":"!")+r.Config.CostCorrection+" "+(i+1));Fit.Array.Add(n,(0===o.CostCorrections.length?"!":"")+r.Config.AdditionalData),d(e,n,function(n){!function(e,n){Fit.Validation.ExpectInstance(e,Fit.Controls.Button),Fit.Validation.ExpectString(n),C(e),s(),t.Content.Properties.Clear(),t.Content.Headline=n;var i=null;if(n===r.Config.EmailTemplates)(i=t.Content.Properties.AddItem()).PropertyName=r.Config.ConfirmTemplate,i.PropertyValue=u(o.MailTemplates.Confirmation?o.MailTemplates.Confirmation:"",function(e,t){o.MailTemplates.Confirmation=t}),(i=t.Content.Properties.AddItem()).PropertyName=r.Config.InvoiceTemplate,i.PropertyValue=u(o.MailTemplates.Invoice?o.MailTemplates.Invoice:"",function(e,t){o.MailTemplates.Invoice=t});else if(0===n.indexOf(r.Config.CostCorrection)){var a=parseInt(n.substring(n.length-1),10)-1,l=o.CostCorrections[a];if(!l)return;(i=t.Content.Properties.AddItem()).PropertyName=r.Config.CostExpression,i.PropertyValue=p(l.CostCorrection,"number",function(e,t){l.CostCorrection=t}),(i=t.Content.Properties.AddItem()).PropertyName=r.Config.VatExpression,i.PropertyValue=p(l.Vat,"number",function(e,t){l.Vat=t}),(i=t.Content.Properties.AddItem()).PropertyName=r.Config.MessageExpression,i.PropertyValue=p(l.Message,"string",function(e,t){l.Message=t})}else n===r.Config.AdditionalData&&((i=t.Content.Properties.AddItem()).PropertyName=r.Config.AdditionalDataJson,i.PropertyValue=function(e,t){Fit.Validation.ExpectString(e),Fit.Validation.ExpectFunction(t);var o=S(e,t);return o.FitControl.SetValidationCallback(function(e){if(""===e)return!0;try{var t=JSON.parse(e);return void 0!==t&&null!==t&&t.constructor===Object}catch(e){return!1}},r.Config.InvalidJson),o}(o.AdditionalData,function(e,t){o.AdditionalData=t,!0===e.IsValid()&&(JSShop.Settings.AdditionalData=""!==t?JSON.parse(t):{})}));t.Update()}(e,n)})}(e)});h.Enabled(!!(o.MailTemplates.Templates&&o.MailTemplates.Templates.length>0)),F.Enabled(o.PaymentMethods.length>0),(i=new Fit.Controls.Button(Fit.Data.CreateGuid())).Title(r.Config.Save),i.Type(Fit.Controls.Button.Type.Success),i.OnClick(function(e){JSShop.Models.Config.Current.Update(function(e,t){Fit.Controls.Dialog.Alert(r.Config.Done)})}),t.Content.SectionList.AddItem().Section=a.GetDomElement(),t.Content.SectionList.AddItem().Section=h.GetDomElement(),t.Content.SectionList.AddItem().Section=F.GetDomElement(),t.Content.SectionList.AddItem().Section=g.GetDomElement(),t.Content.SectionList.AddItem().Section=i.GetDomElement(),a.Type(Fit.Controls.Button.Type.Primary),c(a),t.Update(),setTimeout(function(){m()},1e3)})})},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Presenters.OrderForm=function(){Fit.Core.Extend(this,JSShop.Presenters.Base).Apply();var e=null,t=JSShop.Language.Translations,o=null,r=null,n=null,i=null,a=null,l=null,s=null,c=null,d=null,u=null,S=null,p=null,h=null,C=null,m=null,F=null,g=null,y=null,f=null,V=null,J=null;function E(e){return Fit.Validation.ExpectString(e),JSShop.Settings.CostCorrection1&&JSShop.Settings.CostCorrection1.indexOf(e)>-1||JSShop.Settings.CostCorrection2&&JSShop.Settings.CostCorrection2.indexOf(e)>-1||JSShop.Settings.CostCorrection3&&JSShop.Settings.CostCorrection3.indexOf(e)>-1||JSShop.Settings.CostCorrectionVat1&&JSShop.Settings.CostCorrectionVat1.indexOf(e)>-1||JSShop.Settings.CostCorrectionVat2&&JSShop.Settings.CostCorrectionVat2.indexOf(e)>-1||JSShop.Settings.CostCorrectionVat3&&JSShop.Settings.CostCorrectionVat3.indexOf(e)>-1||JSShop.Settings.CostCorrectionMessage1&&JSShop.Settings.CostCorrectionMessage1.indexOf(e)>-1||JSShop.Settings.CostCorrectionMessage2&&JSShop.Settings.CostCorrectionMessage2.indexOf(e)>-1||JSShop.Settings.CostCorrectionMessage3&&JSShop.Settings.CostCorrectionMessage3.indexOf(e)>-1}function v(e){Fit.Validation.ExpectInstance(e,Fit.Controls.Input);var t=e.Value(),o=Fit.String.Trim(t.replace(" "," "));o!==e.Value()&&e.Value(o)}function A(e){if(Fit.Validation.ExpectFunction(e,!0),!1===Fit.Controls.ValidateAll("JSShopOrderForm"))return Fit.Controls.Dialog.Alert(t.Common.InvalidEntries),void(!0===Fit.Validation.IsSet(e)&&e());if(!0===S.Checked()&&!0===(!0===(""!==p.Value()||""!==h.Value()||""!==C.Value()||""!==m.Value()||""!==F.Value()||""!==g.Value())&&(""===h.Value()||""===C.Value()||""===m.Value()||""===F.Value()||""===g.Value())))return void Fit.Controls.Dialog.Alert(t.OrderForm.PartialAltAddress);J.Enabled(!1),J.Icon("fa-spinner fa-spin");var u=new JSShop.Models.Order(Fit.Data.CreateGuid());u.Company(o.Value()),u.FirstName(r.Value()),u.LastName(n.Value()),u.Address(i.Value()),u.ZipCode(a.Value()),u.City(l.Value()),u.Email(s.Value()),u.Phone(c.Value()),u.Message(d.Value()),!0===S.Checked()&&(u.AltCompany(p.Value()),u.AltFirstName(h.Value()),u.AltLastName(C.Value()),u.AltAddress(m.Value()),u.AltZipCode(F.Value()),u.AltCity(g.Value())),null!==y&&u.PromoCode(y.Value()),null!==f&&u.PaymentMethod(f.GetSelections()[0].Value);var V;V=setTimeout(function(){var e=new Fit.Controls.Dialog;e.Content(t.OrderForm.PleaseWait),e.Modal(!0),e.Open(),setTimeout(function(){e.Dispose()},15e3)},8e3),JSShop.Models.Basket.CreateOrder(u,function(e){clearTimeout(V),JSShop.Models.Basket.Clear(),JSShop.Settings.PaymentUrl?setTimeout(function(){location.href=JSShop.Settings.PaymentUrl+(-1===JSShop.Settings.PaymentUrl.indexOf("?")?"?":"&")+"OrderId="+e.Id()},750):JSShop.Settings.ReceiptUrl?setTimeout(function(){location.href=JSShop.Settings.ReceiptUrl},750):Fit.Controls.Dialog.Alert(t.OrderForm.OrderReceived,function(){location.href=location.href})},function(t){!0===Fit.Validation.IsSet(e)&&e(),J.Enabled(!0)})}function x(e){Fit.Validation.ExpectInstance(e,Fit.Controls.ControlBase),!0===u.Checked()&&JSShop.Cookies.Set(e.GetId(),e.Value(),15768e4)}function P(e){Fit.Validation.ExpectInstance(e,Fit.Controls.ControlBase),!0===u.Checked()&&null!==JSShop.Cookies.Get(e.GetId())&&e.Value(JSShop.Cookies.Get(e.GetId()))}function D(e){Fit.Validation.ExpectInstance(e,Fit.Controls.ControlBase),JSShop.Cookies.Remove(e.GetId())}this.GetDomElement=function(){return e},function(){if(e=document.createElement("div"),0!==JSShop.Models.Basket.GetItems().length){null===document.querySelector("link[href*='/Views/OrderForm.css']")&&Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/Views/OrderForm.css?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));var O=new Fit.Http.Request(JSShop.GetPath()+"/Views/OrderForm.html?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));if(O.OnSuccess(function(E){e.innerHTML=O.GetResponseText();var v=e.querySelector("div.JSShopAddress"),A=e.querySelector("div.JSShopAlternativeAddress"),x=e.querySelector("div.JSShopPaymentForm");if(A.style.display=!0===S.Checked()?"block":"none",Fit.Dom.Add(v.querySelector("#JSShop-Headline-Label"),document.createTextNode(t.OrderForm.CustomerDetails)),Fit.Dom.Add(v.querySelector("#JSShop-Company-Label"),document.createTextNode(t.OrderForm.Company)),o.Render(v.querySelector("#JSShop-Company-Control")),Fit.Dom.Add(v.querySelector("#JSShop-FirstName-Label"),document.createTextNode(t.OrderForm.FirstName)),r.Render(v.querySelector("#JSShop-FirstName-Control")),Fit.Dom.Add(v.querySelector("#JSShop-LastName-Label"),document.createTextNode(t.OrderForm.LastName)),n.Render(v.querySelector("#JSShop-LastName-Control")),Fit.Dom.Add(v.querySelector("#JSShop-Address-Label"),document.createTextNode(t.OrderForm.Address)),i.Render(v.querySelector("#JSShop-Address-Control")),Fit.Dom.Add(v.querySelector("#JSShop-ZipCode-Label"),document.createTextNode(t.OrderForm.ZipCode)),a.Render(v.querySelector("#JSShop-ZipCode-Control")),Fit.Dom.Add(v.querySelector("#JSShop-City-Label"),document.createTextNode(t.OrderForm.City)),l.Render(v.querySelector("#JSShop-City-Control")),Fit.Dom.Add(v.querySelector("#JSShop-Email-Label"),document.createTextNode(t.OrderForm.Email)),s.Render(v.querySelector("#JSShop-Email-Control")),Fit.Dom.Add(v.querySelector("#JSShop-Phone-Label"),document.createTextNode(t.OrderForm.Phone)),c.Render(v.querySelector("#JSShop-Phone-Control")),Fit.Dom.Add(v.querySelector("#JSShop-Message-Label"),document.createTextNode(t.OrderForm.Message)),d.Render(v.querySelector("#JSShop-Message-Control")),u.Render(v.querySelector("#JSShop-RememberMe-Control")),S.Render(v.querySelector("#JSShop-AlternativeAddress-Control")),Fit.Dom.Add(A.querySelector("#JSShop-AlternativeHeadline-Label"),document.createTextNode(t.OrderForm.AlternativeAddress)),Fit.Dom.Add(A.querySelector("#JSShop-AlternativeCompany-Label"),document.createTextNode(t.OrderForm.Company)),p.Render(A.querySelector("#JSShop-AlternativeCompany-Control")),Fit.Dom.Add(A.querySelector("#JSShop-AlternativeFirstName-Label"),document.createTextNode(t.OrderForm.FirstName)),h.Render(A.querySelector("#JSShop-AlternativeFirstName-Control")),Fit.Dom.Add(A.querySelector("#JSShop-AlternativeLastName-Label"),document.createTextNode(t.OrderForm.LastName)),C.Render(A.querySelector("#JSShop-AlternativeLastName-Control")),Fit.Dom.Add(A.querySelector("#JSShop-AlternativeAddress-Label"),document.createTextNode(t.OrderForm.Address)),m.Render(A.querySelector("#JSShop-AlternativeAddress-Control")),Fit.Dom.Add(A.querySelector("#JSShop-AlternativeZipCode-Label"),document.createTextNode(t.OrderForm.ZipCode)),F.Render(A.querySelector("#JSShop-AlternativeZipCode-Control")),Fit.Dom.Add(A.querySelector("#JSShop-AlternativeCity-Label"),document.createTextNode(t.OrderForm.City)),g.Render(A.querySelector("#JSShop-AlternativeCity-Control")),null===f&&null===y||null===V?null!==f||null!==y?Fit.Dom.Add(x.querySelector("#JSShop-Header-Label"),document.createTextNode(t.OrderForm.Payment)):null!==V&&Fit.Dom.Add(x.querySelector("#JSShop-Header-Label"),document.createTextNode(t.OrderForm.Terms)):Fit.Dom.Add(x.querySelector("#JSShop-Header-Label"),document.createTextNode(t.OrderForm.PaymentAndTerms)),null!==y&&(Fit.Dom.Add(x.querySelector("#JSShop-PromoCode-Label"),document.createTextNode("Kampagnekode")),y.Render(x.querySelector("#JSShop-PromoCode-Control"))),null!==f&&(Fit.Dom.Add(x.querySelector("#JSShop-PaymentMethod-Label"),document.createTextNode(t.OrderForm.PaymentMethod)),f.Render(x.querySelector("#JSShop-PaymentMethod-Control"))),null!==V){V.Render(x.querySelector("#JSShop-AcceptTerms-Control"));var P=new Fit.Controls.Dialog;P.Modal(!0),P.Content("<iframe src='"+JSShop.Settings.TermsUrl+"' frameBorder='0' style='width: 100%; min-width: 260px; height: 100%; min-height: 260px;' allowtransparency='true'></iframe>"),P.GetDomElement().firstChild.style.padding="0em";var D=new Fit.Controls.Button("JSShopOkButton");D.Type(Fit.Controls.Button.Type.Success),D.Title(t.Common.Ok),D.OnClick(function(e){V.Checked(!0),P.Close()}),P.AddButton(D);var I=new Fit.Controls.Button("JSShopCancelButton");I.Type(Fit.Controls.Button.Type.Danger),I.Title(t.Common.Cancel),I.OnClick(function(e){V.Checked(!1),P.Close()}),P.AddButton(I);var T=Fit.Dom.CreateElement(" (<a href='javascript:'>"+t.OrderForm.Read+"</a>)","span");T.onclick=function(e){P.Open()},Fit.Dom.InsertAfter(V.GetDomElement(),T)}J.Render(x.querySelector("#JSShop-Continue-Control"))}),O.Start(),(o=new Fit.Controls.Input("JSShopCompany")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),o.Scope("JSShopOrderForm"),o.LazyValidation(!0),o.OnChange(x),o.OnBlur(v),o.Width(100,"%"),(r=new Fit.Controls.Input("JSShopFirstName")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),r.Required(!0),r.Scope("JSShopOrderForm"),r.LazyValidation(!0),r.OnChange(x),r.OnBlur(v),r.Width(100,"%"),(n=new Fit.Controls.Input("JSShopLastName")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),n.Required(!0),n.Scope("JSShopOrderForm"),n.LazyValidation(!0),n.OnChange(x),n.OnBlur(v),n.Width(100,"%"),(i=new Fit.Controls.Input("JSShopAddress")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),i.Required(!0),i.Scope("JSShopOrderForm"),i.LazyValidation(!0),i.OnChange(x),i.OnBlur(v),i.Width(100,"%"),(a=new Fit.Controls.Input("JSShopZipCode")).SetValidationCallback(function(e){return e.length<=20},t.Common.MaxLengthExceeded),a.Required(!0),a.Scope("JSShopOrderForm"),a.LazyValidation(!0),a.OnChange(x),a.OnBlur(v),a.Width(100,"%"),!0===E("zipcodeval")&&a.SetValidationExpression(/^\d*$/,t.OrderForm.EnterValidZipCode),(l=new Fit.Controls.Input("JSShopCity")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),l.Required(!0),l.Scope("JSShopOrderForm"),l.LazyValidation(!0),l.OnChange(x),l.OnBlur(v),l.Width(100,"%"),(s=new Fit.Controls.Input("JSShopEmail")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),s.SetValidationExpression(/^[a-z0-9!#$%&'*+-\/=?^_`{|}~]+@[a-z0-9_.-]+$/i,t.OrderForm.EnterValidEmail),s.Required(!0),s.Scope("JSShopOrderForm"),s.LazyValidation(!0),s.OnChange(x),s.OnBlur(v),s.Width(100,"%"),(c=new Fit.Controls.Input("JSShopPhone")).SetValidationCallback(function(e){return e.length<=20},t.Common.MaxLengthExceeded),c.Scope("JSShopOrderForm"),c.LazyValidation(!0),c.OnChange(x),c.OnBlur(v),c.Width(100,"%"),(d=new Fit.Controls.Input("JSShopMessage")).SetValidationCallback(function(e){return e.length<=250},t.Common.MaxLengthExceeded),d.Scope("JSShopOrderForm"),d.LazyValidation(!0),d.MultiLine(!0),d.Width(100,"%"),d.Height(6,"em"),d.OnBlur(v),(u=new Fit.Controls.CheckBox("JSShopRememberMe")).Label(t.OrderForm.RememberMe),u.Value(null!==JSShop.Cookies.Get(u.GetId())?JSShop.Cookies.Get(u.GetId()):"false"),u.OnChange(function(e){!0===u.Checked()?x(u):D(u)}),u.OnChange(function(e){var t;t=[],Fit.Array.Add(t,o),Fit.Array.Add(t,r),Fit.Array.Add(t,n),Fit.Array.Add(t,i),Fit.Array.Add(t,a),Fit.Array.Add(t,l),Fit.Array.Add(t,s),Fit.Array.Add(t,c),Fit.Array.Add(t,S),Fit.Array.Add(t,p),Fit.Array.Add(t,h),Fit.Array.Add(t,C),Fit.Array.Add(t,m),Fit.Array.Add(t,F),Fit.Array.Add(t,g),null!==f&&Fit.Array.Add(t,f),Fit.Array.ForEach(t,function(e){!0===u.Checked()?x(e):D(e)})}),(S=new Fit.Controls.CheckBox("JSShopAlternativeAddress")).Label(t.OrderForm.AlternativeAddress),S.OnChange(x),S.OnChange(function(e){null!==document.querySelector("div.JSShopAlternativeAddress")&&(document.querySelector("div.JSShopAlternativeAddress").style.display=!0===S.Checked()?"block":"none")}),(p=new Fit.Controls.Input("JSShopAltCompany")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),p.Scope("JSShopOrderForm"),p.LazyValidation(!0),p.OnChange(x),p.OnBlur(v),p.Width(100,"%"),(h=new Fit.Controls.Input("JSShopAltFirstName")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),h.Scope("JSShopOrderForm"),h.LazyValidation(!0),h.OnChange(x),h.OnBlur(v),h.Width(100,"%"),(C=new Fit.Controls.Input("JSShopAltLastName")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),C.Scope("JSShopOrderForm"),C.LazyValidation(!0),C.OnChange(x),C.OnBlur(v),C.Width(100,"%"),(m=new Fit.Controls.Input("JSShopAltAddress")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),m.Scope("JSShopOrderForm"),m.LazyValidation(!0),m.OnChange(x),m.OnBlur(v),m.Width(100,"%"),(F=new Fit.Controls.Input("JSShopAltZipCode")).SetValidationCallback(function(e){return e.length<=20},t.Common.MaxLengthExceeded),F.Scope("JSShopOrderForm"),F.LazyValidation(!0),F.OnChange(x),F.OnBlur(v),F.Width(100,"%"),!0===E("zipcodeval")&&F.SetValidationExpression(/^\d*$/,t.OrderForm.EnterValidZipCode),(g=new Fit.Controls.Input("JSShopAltCity")).SetValidationCallback(function(e){return e.length<=50},t.Common.MaxLengthExceeded),g.Scope("JSShopOrderForm"),g.LazyValidation(!0),g.OnChange(x),g.OnBlur(v),g.Width(100,"%"),!0===E("promocode")&&((y=new Fit.Controls.Input("JSShopPromoCode")).SetValidationCallback(function(e){return e.length<=30},t.Common.MaxLengthExceeded),y.Scope("JSShopOrderForm"),y.LazyValidation(!0),y.OnBlur(v),y.Width(100,"%")),JSShop.Settings.PaymentMethods&&JSShop.Settings.PaymentMethods.length>0){var I=[];Fit.Array.ForEach(JSShop.Settings.PaymentMethods,function(e){e.Title&&e.Module&&!0===e.Enabled&&Fit.Array.Add(I,e)}),I.length>0&&((f=new Fit.Controls.DropDown("JSShopPaymentMethod")).Required(!0),f.Scope("JSShopOrderForm"),f.LazyValidation(!0),f.OnChange(x),f.SetPicker(new Fit.Controls.ListView),f.Width(100,"%"),Fit.Array.ForEach(I,function(e){f.GetPicker().AddItem(e.Title,e.Module)})),1===I.length&&f.AddSelection(I[0].Title,I[0].Module)}JSShop.Settings.TermsUrl&&(V=new Fit.Controls.CheckBox("JSShopAcceptTerms")).Label(t.OrderForm.AcceptTerms),(J=new Fit.Controls.Button("JSShopContinue")).Type(Fit.Controls.Button.Type.Primary),J.Title(t.OrderForm.Continue),J.OnClick(function(e){if(null===V||!1!==V.Checked()){if(""===c.Value()){var o=new Fit.Controls.Dialog;o.Modal(!0),o.Content(t.OrderForm.MissingPhoneNumber);var r=new Fit.Controls.Button("JSShopContinueWithoutButton"),n=new Fit.Controls.Button("JSShopGoBackButton");return r.Type(Fit.Controls.Button.Type.Default),r.Title(t.OrderForm.ContinueWithout),r.OnClick(function(e){o.Close(),o.Dispose(),A()}),o.AddButton(r),n.Type(Fit.Controls.Button.Type.Default),n.Title(t.OrderForm.AddPhoneNumber),n.OnClick(function(e){o.Close(),o.Dispose(),c.Focused(!0)}),o.AddButton(n),o.Open(),void n.Focused(!0)}A()}else Fit.Controls.Dialog.Alert(t.OrderForm.TermsRequired)}),P(o),P(r),P(n),P(i),P(a),P(l),P(s),P(c),P(S),P(p),P(h),P(C),P(m),P(F),P(g),null!==f&&(P(f),f.GetSelections().length>0&&!1===f.GetPicker().HasItem(f.GetSelections()[0].Value)&&f.Clear())}}()},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Presenters.OrderList=function(){Fit.Core.Extend(this,JSShop.Presenters.Base).Apply();var e=null,t=[],o=JSShop.Language.Translations,r=null,n=null,i=-1,a=[],l=null,s=null,c=null,d=null,u=null,S=null,p=null,h=null,C=null,m=null;function F(e){return Fit.Validation.ExpectStringValue(e),"Initial"===e?o.OrderList.StateInitial:"Authorized"===e?o.OrderList.StateAuthorized:"Captured"===e?o.OrderList.StateCaptured:"Canceled"===e?o.OrderList.StateCanceled:"UNKNOWN"}function g(e){Fit.Validation.ExpectStringValue(e);var t=[],r=[],n=[],i=0;if(Fit.Array.ForEach(a,function(o){"Captured"===o.State()&&"Capture"===e||"Canceled"===o.State()&&"Reject"===e?Fit.Array.Add(n,o.Id()):Fit.Array.Add(t,o)}),n.length>0&&Fit.Controls.Dialog.Alert(o.OrderList.OrdersSkipped+":<br><br>"+n.join(n.length<=10?"<br>":", ")),0!==t.length){var l=t.length,s=null;s=function(n){Fit.Validation.ExpectInstance(n,JSShop.Models.Order),("Capture"===e?n.CapturePayment:n.CancelPayment)(function(e,a){if(i++,n._presenter.StateElement.innerHTML=F(n.State()),0===t.length)i===l&&(0===r.length?Fit.Controls.Dialog.Alert(o.OrderList.DoneSuccess):Fit.Controls.Dialog.Alert(o.OrderList.DoneFailure+":<br><br>"+r.join(r.length<=10?"<br>":", ")));else{var c=t[0];Fit.Array.Remove(t,c),s(c)}},function(e,a){if(Fit.Array.Add(r,n.Id()),i++,0===t.length)i===l&&Fit.Controls.Dialog.Alert(o.OrderList.DoneFailure+":<br><br>"+r.join(r.length<=10?"<br>":", "));else{var c=t[0];Fit.Array.Remove(t,c),s(c)}})};for(var c=[],d=0;d<3;d++)d<=t.length-1&&Fit.Array.Add(c,t[d]);Fit.Array.ForEach(c,function(e){Fit.Array.Remove(t,e)}),Fit.Array.ForEach(c,function(e){s(e)})}}e=document.createElement("div"),this.GetDomElement=function(){return e},function(){var y=function(g){Fit.Validation.ExpectFunction(g,!0),Fit.Array.ForEach(t,function(e){e._presenter.CheckBox.Dispose()}),m.Checked(!1);var y=t;t=[],a=[],null===document.querySelector("link[href*='/Views/OrderList.css']")&&Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/Views/OrderList.css?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));var f=new Fit.Http.Request(JSShop.GetPath()+"/Views/OrderList.html?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));f.OnSuccess(function(V){!0==(""===e.innerHTML)&&(e.innerHTML=f.GetResponseText(),s.Render(e.querySelector("#JSShopOrderListButtons")),c.Render(e.querySelector("#JSShopOrderListButtons")),l.Render(e.querySelector("#JSShopOrderListButtons")),d.Render(e.querySelector("#JSShopOrderListButtons")),u.Render(e.querySelector("#JSShopOrderListButtons")),S.Render(e.querySelector("#JSShopOrderListButtons")),null!==p&&p.Render(e.querySelector("#JSShopOrderListButtons")),null!==h&&h.Render(e.querySelector("#JSShopOrderListButtons")),null!==C&&C.Render(e.querySelector("#JSShopOrderListButtons")),Fit.Dom.Add(e.querySelector("#JSShop-Select"),m.GetDomElement()),Fit.Dom.Add(e.querySelector("#JSShop-OrderId"),document.createTextNode(o.OrderList.OrderId)),Fit.Dom.Add(e.querySelector("#JSShop-Time"),document.createTextNode(o.OrderList.Time)),Fit.Dom.Add(e.querySelector("#JSShop-Customer"),document.createTextNode(o.OrderList.Customer)),Fit.Dom.Add(e.querySelector("#JSShop-Amount"),document.createTextNode(o.OrderList.Amount)),Fit.Dom.Add(e.querySelector("#JSShop-PaymentMethod"),document.createTextNode(o.OrderList.PaymentMethod)),Fit.Dom.Add(e.querySelector("#JSShop-State"),document.createTextNode(o.OrderList.State)),Fit.Dom.Add(e.querySelector("#JSShop-InvoiceId"),document.createTextNode(o.OrderList.InvoiceId)),r=e.querySelector("#JSShopOrderEntry"),Fit.Dom.Attribute(r,"id",null),n=r.parentElement,i=Fit.Dom.GetIndex(r),Fit.Dom.Remove(r)),Fit.Array.ForEach(y,function(e){Fit.Dom.Remove(e._presenter.DomElement)});var J=Fit.Date.Parse(s.Value()+" 00:00:00",o.Locale.DateFormat+" hh:mm:ss").getTime(),E=Fit.Date.Parse(c.Value()+" 23:59:59",o.Locale.DateFormat+" hh:mm:ss").getTime();JSShop.Models.Order.RetrieveAll(l.Value(),J,E,function(e,l){t=l;var s=null;Fit.Array.ForEach(t,function(e){var l=r.outerHTML;l=(l=(l=(l=(l=(l=(l=(l=(l=l.replace(/{\[CheckBox\]}/g,"<div id='JSShopOrderCheckBox"+e.Id()+"'></div>")).replace(/{\[OrderId\]}/g,e.Id())).replace(/{\[Time\]}/g,Fit.Date.Format(new Date(e.Time()),o.Locale.DateFormat+" "+o.Locale.TimeFormat))).replace(/{\[Customer\]}/g,"<div id='JSShopCustomerDetails"+e.Id()+"'></div>")).replace(/{\[Currency\]}/g,e.Currency())).replace(/{\[Amount\]}/g,"<div id='JSShopOrderEntries"+e.Id()+"'></div>")).replace(/{\[State\]}/g,"<span id='JSShopOrderState"+e.Id()+"'></span>")).replace(/{\[InvoiceId\]}/g,"<span id='JSShopOrderInvoice"+e.Id()+"'></span>")).replace(/{\[PaymentMethod\]}/g,e.PaymentMethod());var c=Fit.Dom.CreateElement(l);null===s?Fit.Dom.InsertAt(n,i,c):Fit.Dom.InsertAfter(s,c),s=c;var d=new Fit.Controls.CheckBox("JSShopOrder"+e.Id());d.OnChange(function(o){var r;!0===d.Checked()?Fit.Array.Add(a,e):Fit.Array.Remove(a,e),!0===d.Focused()&&(r=!0,Fit.Array.ForEach(t,function(e){if("none"!==e._presenter.DomElement.style.display&&!1===e._presenter.CheckBox.Checked())return r=!1,!1}),m.Checked(r))}),Fit.Dom.Replace(c.querySelector("#JSShopOrderCheckBox"+e.Id()),d.GetDomElement());var u=document.createElement("a");u.href="javascript:",u.onclick=function(t){!function(e){Fit.Validation.ExpectInstance(e,JSShop.Models.Order);var t=new Fit.Controls.Dialog;t.Modal(!0),t.Content(o.OrderList.Loading),t.Open();var r=new Fit.Controls.Button("JSShopOrderDetailsOkButton");r.Title(o.Common.Ok),r.Type(Fit.Controls.Button.Type.Success),r.Enabled(!1),r.OnClick(function(e){t.Dispose()}),t.AddButton(r),r.Focused(!0),null===document.querySelector("link[href*='/Views/DialogCustomerDetails.css']")&&Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/Views/DialogCustomerDetails.css?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));var n=new Fit.Http.Request(JSShop.GetPath()+"/Views/DialogCustomerDetails.html?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));n.OnSuccess(function(i){var a=n.GetResponseText();a=(a=(a=a.replace(/{\[CustomerDetailsHeadline\]}/,o.OrderList.CustomerDetails)).replace(/{\[AlternativeAddressHeadline\]}/,o.OrderList.AlternativeAddress)).replace(/{\[CustomerMessageHeadline\]}/,o.OrderList.Message);var l=["Company","FirstName","LastName","Address","ZipCode","City","Phone","Email","Message"];l=Fit.Array.Merge(l,["AltCompany","AltFirstName","AltLastName","AltAddress","AltZipCode","AltCity"]),Fit.Array.ForEach(l,function(t){a=a.replace(new RegExp("{\\["+t+"\\]}","g"),e[t]().replace("\n","<br>"))}),r.Enabled(!0),t.Content(a);var s=t.GetDomElement().querySelector("#JSShopAlternativeAddress");s.style.display=""!==e.AltAddress()?"block":"none";for(var c="",d=1;d<=3;d++)""!==e["CustData"+d]()&&(c+=(""!==c?"<br>":"")+e["CustData"+d]());var u=t.GetDomElement().querySelector("#JSShopCustomerMessage");""!==c&&(u.innerHTML=u.innerHTML+"<br><br>"+c),u.style.display=""!==e.Message()||""!==c?"block":"none"}),n.Start()}(e)},u.innerHTML=e.FirstName()+" "+e.LastName(),Fit.Dom.Replace(c.querySelector("#JSShopCustomerDetails"+e.Id()),u);var S=document.createElement("a");S.href="javascript:",S.onclick=function(t){!function(e){Fit.Validation.ExpectInstance(e,JSShop.Models.Order);var t=new Fit.Controls.Dialog;t.Modal(!0),t.Content(o.OrderList.Loading),t.Open(),t.GetDomElement().style.maxWidth="95%";var r=new Fit.Controls.Button("JSShopOrderEntriesOkButton");r.Title(o.Common.Ok),r.Type(Fit.Controls.Button.Type.Success),r.Enabled(!1),r.OnClick(function(e){t.Dispose()}),t.AddButton(r),r.Focused(!0),null===document.querySelector("link[href*='/Views/DialogOrderEntries.css']")&&Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/Views/DialogOrderEntries.css?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));var n=new Fit.Http.Request(JSShop.GetPath()+"/Views/DialogOrderEntries.html?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));n.OnSuccess(function(i){var a=n.GetResponseText();a=(a=(a=(a=(a=(a=a.replace(/{\[HeaderProduct\]}/g,o.OrderList.Product)).replace(/{\[HeaderUnitPrice\]}/g,o.OrderList.UnitPrice)).replace(/{\[HeaderUnits\]}/g,o.OrderList.Units)).replace(/{\[HeaderPrice\]}/g,o.OrderList.Price)).replace(/{\[HeaderTotalVat\]}/g,o.OrderList.TotalVat)).replace(/{\[HeaderTotalPrice\]}/g,o.OrderList.TotalPrice);var l="\x3c!-- REPEAT Items --\x3e",s="\x3c!-- /REPEAT Items --\x3e",c=new RegExp(l+"[\\s\\S]*"+s),d=c.exec(a);if(null!==d){var u=d[0],S=u.indexOf(l)+l.length,p=u.indexOf(s);u=u.substring(S,p);var h=function(n){var i="",l=null;Fit.Array.ForEach(n,function(e){l=u;var t=JSShop.CalculatePricing(e.UnitPrice(),e.Units(),e.Vat(),e.Discount());l=(l=(l=(l=(l=(l=(l=l.replace(/{\[Title\]}/g,null!==e.Product?e.Product.Title():e.ProductId())).replace(/{\[UnitPrice\]}/g,Fit.Math.Format(t.UnitPriceInclVat,2,o.Locale.DecimalSeparator))).replace(/{\[DiscountMessage\]}/g,e.DiscountMessage())).replace(/{\[Discount\]}/g,t.DiscountInclVat>0?Fit.Math.Format(-1*t.DiscountInclVat,2,o.Locale.DecimalSeparator):"")).replace(/{\[Units\]}/g,e.Units())).replace(/{\[Currency\]}/g,e.Currency())).replace(/{\[Price\]}/g,Fit.Math.Format(t.TotalInclVat,2,o.Locale.DecimalSeparator)),i+=l});for(var s=1;s<=3;s++)(e["CostCorrection"+s]()>0||e["CostCorrection"+s]()<0)&&(l=(l=(l=(l=(l=(l=(l=(l=u).replace(/{\[Title\]}/g,e["CostCorrectionMessage"+s]())).replace(/{\[UnitPrice\]}/g,"")).replace(/{\[DiscountMessage\]}/g,"")).replace(/{\[Discount\]}/g,"")).replace(/{\[Units\]}/g,"")).replace(/{\[Currency\]}/g,e.Currency())).replace(/{\[Price\]}/g,Fit.Math.Format(e["CostCorrection"+s]()+e["CostCorrectionVat"+s](),2,o.Locale.DecimalSeparator)),i+=l);a=(a=(a=(a=a.replace(d[0],i)).replace(/{\[Currency\]}/g,e.Currency())).replace(/{\[TotalVat\]}/g,Fit.Math.Format(e.Vat(),2,o.Locale.DecimalSeparator))).replace(/{\[TotalPrice\]}/g,Fit.Math.Format(e.Price()+e.Vat(),2,o.Locale.DecimalSeparator)),r.Enabled(!0),t.Content(a)};JSShop.Models.OrderEntry.RetrieveAll(e.Id(),function(e,t){var o=0;Fit.Array.ForEach(t,function(e){var r=new JSShop.Models.Product(e.ProductId());r.Retrieve(function(n,i){o++,e.Product=r,o===t.length&&h(t)},function(r,n){o++,e.Product=null,o===t.length&&h(t)})})})}}),n.Start()}(e)},S.innerHTML=Fit.Math.Format(e.Price()+e.Vat(),2,o.Locale.DecimalSeparator),Fit.Dom.Replace(c.querySelector("#JSShopOrderEntries"+e.Id()),S);var p=document.createElement("span");p.innerHTML=F(e.State()),Fit.Dom.Replace(c.querySelector("#JSShopOrderState"+e.Id()),p);var h=document.createElement("span");h.innerHTML=e.InvoiceId(),Fit.Dom.Replace(c.querySelector("#JSShopOrderInvoice"+e.Id()),h),e._presenter={},e._presenter.StateElement=p,e._presenter.InvoiceElement=h,e._presenter.CheckBox=d,e._presenter.DomElement=c}),g&&g()})}),f.Start()};(l=new Fit.Controls.Input("JSShopSearch")).Width(120),l.GetDomElement().title=o.OrderList.Search,l.Placeholder(o.OrderList.Search+"..");var f=new Date;new Date((new Date).setDate(f.getDate()-1)),(s=new Fit.Controls.Input("JSShopFromDate")).Required(!0),s.SetValidationCallback(function(e){try{Fit.Date.Parse(s.Value(),o.Locale.DateFormat)}catch(e){return!1}return!0}),s.OnBlur(function(e){if(!1===s.IsValid())s.Value(Fit.Date.Format(new Date,o.Locale.DateFormat));else{var t=Fit.Date.Parse(s.Value(),o.Locale.DateFormat),r=Fit.Date.Format(t,o.Locale.DateFormat);s.Value(r)}}),s.Width(120),s.Value(Fit.Date.Format(new Date,o.Locale.DateFormat)),s.GetDomElement().title=o.OrderList.DisplayFromDate,(c=new Fit.Controls.Input("JSShopToDate")).Required(!0),c.SetValidationCallback(function(e){try{Fit.Date.Parse(c.Value(),o.Locale.DateFormat)}catch(e){return!1}return!0}),c.OnBlur(function(e){if(!1===c.IsValid())c.Value(Fit.Date.Format(new Date,o.Locale.DateFormat));else{var t=Fit.Date.Parse(c.Value(),o.Locale.DateFormat),r=Fit.Date.Format(t,o.Locale.DateFormat);c.Value(r)}}),c.Width(120),c.Value(Fit.Date.Format(new Date,o.Locale.DateFormat)),c.GetDomElement().title=o.OrderList.DisplayToDate,(d=new Fit.Controls.Button("JSShopUpdateButton")).Icon("fa-refresh"),d.Type(Fit.Controls.Button.Type.Primary),d.OnClick(function(e){d.Enabled(!1),y(function(){d.Enabled(!0)})}),d.GetDomElement().title=o.OrderList.Update,(u=new Fit.Controls.Button("JSShopExportButton")).Icon("fa-table"),u.Type(Fit.Controls.Button.Type.Primary),u.OnClick(function(e){if(0!==a.length){var t=new Fit.Controls.Button("JSShopExportCsvButton");t.Title("CSV"),t.Icon("fa-table"),t.Type(Fit.Controls.Button.Type.Primary),t.OnClick(function(e){i.Dispose(),function(){var e=["Id","Time","ClientIp","Company","FirstName","LastName","Address","ZipCode","City","Email","Phone","Message","AltCompany","AltFirstName","AltLastName","AltAddress","AltZipCode","AltCity","Price","Vat","Currency","Weight","WeightUnit","CostCorrection1","CostCorrectionVat1","CostCorrectionMessage1","CostCorrection2","CostCorrectionVat2","CostCorrectionMessage2","CostCorrection3","CostCorrectionVat3","CostCorrectionMessage3","PaymentMethod","TransactionId","State","PromoCode","CustData1","CustData2","CustData3"],t=[];Fit.Array.ForEach(a,function(o){var r=[];Fit.Array.ForEach(e,function(e){if("Time"===e){var t=new Date(o.Time());Fit.Array.Add(r,'"'+Fit.Date.Format(t,"YYYY-MM-DD hh:mm:ss")+'"')}else"State"===e?Fit.Array.Add(r,'"'+F(o.State())+'"'):"number"==typeof o[e]()?Fit.Array.Add(r,Fit.Math.Format(o[e](),4,".")):Fit.Array.Add(r,'"'+o[e]()+'"')}),Fit.Array.Add(t,r)});var o='"'+e.join('","')+'"';if(Fit.Array.ForEach(t,function(e){o+="\n"+e.join(",")}),"MSIE"===Fit.Browser.GetInfo().Name){var r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r);var n=r.contentDocument;n.write(o),n.close(),n.execCommand("SaveAs",!0,"Export.csv"),Fit.Dom.Remove(r)}else if(navigator.msSaveOrOpenBlob){var i=new Blob([o],{type:"text/csv"});navigator.msSaveOrOpenBlob(i,"Export.csv")}else window.open(encodeURI("data:text/csv;charset=utf-8,"+o))}()});var r=new Fit.Controls.Button("JSShopExportPdfButton");r.Title("PDF"),r.Icon("fa-file-pdf-o"),r.Type(Fit.Controls.Button.Type.Primary),r.OnClick(function(e){var t,r;i.Dispose(),t=function(){var e=new jsPDF("portrait","pt","a4");e.setFont("helvetica","normal"),e.setFontSize(12);var t=!0,r=0;Fit.Array.ForEach(a,function(n){!1===t&&e.addPage(),t=!1,r=50,e.setFontSize(14),e.setFontStyle("bold"),e.text(50,r,o.OrderList.Order+" "+n.Id()),e.setFontSize(12),e.setFontStyle("normal"),e.setFontSize(12),e.text(450,r,Fit.Date.Format(new Date(n.Time()),o.Locale.DateFormat+" "+o.Locale.TimeFormat)),e.setFontSize(12);var i=r+=30;e.setFontStyle("bold"),e.text(50,i+=20,o.OrderList.CustomerDetails),e.setFontStyle("normal"),""!==n.Company()&&e.text(50,i+=20,n.Company()),e.text(50,i+=20,n.FirstName()+" "+n.LastName()),e.text(50,i+=20,n.Address()),e.text(50,i+=20,n.ZipCode()+" "+n.City()),""!==n.Phone()&&e.text(50,i+=20,n.Phone()),e.text(50,i+=20,n.Email());var a=r;e.setFontStyle("bold"),e.text(300,a+=20,o.OrderList.AlternativeAddress),e.setFontStyle("normal"),""!==n.AltCompany()&&e.text(300,a+=20,n.AltCompany()),e.text(300,a+=20,n.AltFirstName()+" "+n.AltLastName()),e.text(300,a+=20,n.AltAddress()),e.text(300,a+=20,n.AltZipCode()+" "+n.AltCity()),r=i>a?i:a,r+=50,e.setFontStyle("bold"),e.text(50,r,o.OrderList.Order),e.setFontStyle("normal"),r+=20,e.text(50,r,o.OrderList.Product),e.text(300,r,o.OrderList.UnitPrice),e.text(400,r,o.OrderList.Units),e.text(450,r,o.OrderList.Price),Fit.Array.ForEach(n._presenter.Entries,function(t){r+=20;var n=JSShop.CalculatePricing(t.UnitPrice(),t.Units(),t.Vat(),t.Discount());e.text(50,r,null!==t.Product?t.Product.Title():t.ProductId()),e.text(300,r,Fit.Math.Format(n.UnitPriceInclVat,2,o.Locale.DecimalSeparator)),e.text(400,r,t.Units().toString()),e.text(450,r,Fit.Math.Format(n.TotalInclVat,2,o.Locale.DecimalSeparator)),0!==t.Discount()&&(r+=14,e.setFontSize(10),e.text(50,r,t.DiscountMessage()),e.text(450,r,Fit.Math.Format(-1*n.DiscountInclVat,2,o.Locale.DecimalSeparator)),e.setFontSize(12))});for(var l=1;l<=3;l++)(n["CostCorrection"+l]()>0||n["CostCorrection"+l]()<0)&&(r+=20,e.text(50,r,n["CostCorrectionMessage"+l]()),e.text(450,r,Fit.Math.Format(n["CostCorrection"+l]()+n["CostCorrectionVat"+l](),2,o.Locale.DecimalSeparator)));if(r+=50,e.text(300,r,o.OrderList.TotalVat),e.text(450,r,Fit.Math.Format(n.Vat(),2,o.Locale.DecimalSeparator)),r+=20,e.text(300,r,o.OrderList.TotalPrice),e.text(450,r,Fit.Math.Format(n.Price()+n.Vat(),2,o.Locale.DecimalSeparator)),""===n.PromoCode()&&""===n.CustData1()&&""===n.CustData2()&&""===n.CustData3()||(r+=30,""!==n.PromoCode()&&e.text(50,r+=20,n.PromoCode()),""!==n.CustData1()&&e.text(50,r+=20,n.CustData1()),""!==n.CustData2()&&e.text(50,r+=20,n.CustData2()),""!==n.CustData3()&&e.text(50,r+=20,n.CustData3())),""!==n.Message()){r+=50,e.setFontStyle("bold"),e.text(50,r,o.OrderList.Message),e.setFontStyle("normal");for(var s=n.Message();s.indexOf("\n\n")>-1;)s=s.replace("\n\n","\n");e.text(50,r+=20,s),r+=50}}),e.save(o.OrderList.Export+".pdf")},r=-1,Fit.Loader.LoadScript(JSShop.GetPath()+"/jspdf.min.js",function(e){++r===a.length&&t()}),Fit.Array.ForEach(a,function(e){!0!==Fit.Validation.IsSet(e._presenter.Entries)?JSShop.Models.OrderEntry.RetrieveAll(e.Id(),function(o,n){var i=0,l=e;Fit.Array.ForEach(n,function(e){var o=new JSShop.Models.Product(e.ProductId());o.Retrieve(function(o,s){i++,e.Product=s,i===n.length&&(r++,l._presenter.Entries=n,r===a.length&&t())},function(o,l){i++,e.Product=null,i===n.length&&(r++,model._presenter.Entries=n,r===a.length&&t())})})},function(e,o){r++,model._presenter.Entries=null,r===a.length&&t()}):++r===a.length&&t()})}),r.Enabled("MSIE"!==Fit.Browser.GetInfo().Name||Fit.Browser.GetInfo().Name>=10);var n=new Fit.Controls.Button("JSShopExportCancelButton");n.Title(o.Common.Cancel),n.Icon("fa-cancel"),n.Type(Fit.Controls.Button.Type.Danger),n.OnClick(function(e){i.Dispose()});var i=new Fit.Controls.Dialog;i.Content(o.OrderList.ChooseFormat),i.Modal(!0),i.AddButton(t),i.AddButton(r),i.AddButton(n),i.Open(),t.Focused(!0)}else Fit.Controls.Dialog.Alert(o.OrderList.SelectOrders)}),u.GetDomElement().title=o.OrderList.Export,(S=new Fit.Controls.Button("JSShopInvoiceButton")).Icon("fa-paperclip"),S.Type(Fit.Controls.Button.Type.Primary),S.OnClick(function(e){0!==a.length?Fit.Controls.Dialog.Confirm(o.OrderList.ConfirmAction+": "+o.OrderList.SendInvoice,function(e){!0===e&&function(){var e=[],t=[],r=0,n=0;if(Fit.Array.ForEach(a,function(t){Fit.Array.Add(e,t)}),0!==e.length){var r=e.length,i=null;i=function(a){Fit.Validation.ExpectInstance(a,JSShop.Models.Order),a.SendInvoice(function(l,s){if(n++,0===e.length)n===r&&(0===t.length?Fit.Controls.Dialog.Alert(o.OrderList.DoneSuccess):Fit.Controls.Dialog.Alert(o.OrderList.DoneFailure+":<br><br>"+t.join(t.length<=10?"<br>":", ")));else{var c=e[0];Fit.Array.Remove(e,c),i(c)}a.Retrieve(function(e,t){a._presenter.InvoiceElement.innerHTML=a.InvoiceId()})},function(l,s){if(Fit.Array.Add(t,a.Id()),n++,0===e.length)n===r&&Fit.Controls.Dialog.Alert(o.OrderList.DoneFailure+":<br><br>"+t.join(t.length<=10?"<br>":", "));else{var c=e[0];Fit.Array.Remove(e,c),i(c)}})};for(var l=[],s=0;s<3;s++)s<=e.length-1&&Fit.Array.Add(l,e[s]);Fit.Array.ForEach(l,function(t){Fit.Array.Remove(e,t)}),Fit.Array.ForEach(l,function(e){i(e)})}}()}):Fit.Controls.Dialog.Alert(o.OrderList.SelectOrders)}),S.GetDomElement().title=o.OrderList.SendInvoice,JSShop.Settings.PaymentCaptureUrl&&((p=new Fit.Controls.Button("JSShopCaptureButton")).Icon("fa-exchange"),p.Type(Fit.Controls.Button.Type.Success),p.OnClick(function(e){0!==a.length?Fit.Controls.Dialog.Confirm(o.OrderList.ConfirmAction+": "+o.OrderList.Capture,function(e){!0===e&&g("Capture")}):Fit.Controls.Dialog.Alert(o.OrderList.SelectOrders)}),p.GetDomElement().title=o.OrderList.Capture),JSShop.Settings.PaymentCancelUrl&&((h=new Fit.Controls.Button("JSShopReturnButton")).Icon("fa-trash"),h.Type(Fit.Controls.Button.Type.Danger),h.OnClick(function(e){0!==a.length?Fit.Controls.Dialog.Confirm(o.OrderList.ConfirmAction+": "+o.OrderList.Reject,function(e){!0===e&&g("Reject")}):Fit.Controls.Dialog.Alert(o.OrderList.SelectOrders)}),h.GetDomElement().title=o.OrderList.Reject),JSShop.Settings.ConfigUrl&&((C=new Fit.Controls.Button("JSShopConfigButton")).Icon("fa-cog"),C.Type(Fit.Controls.Button.Type.Warning),C.OnClick(function(e){location.href=JSShop.Settings.ConfigUrl}),C.GetDomElement().title=o.OrderList.Settings),(m=new Fit.Controls.CheckBox("JSShopSelectAll")).OnChange(function(e){!0===m.Focused()&&Fit.Array.ForEach(t,function(e){"none"!==e._presenter.DomElement.style.display&&e._presenter.CheckBox.Checked(m.Checked())})}),y()}()},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Presenters.ProductForm=function(){Fit.Core.Extend(this,JSShop.Presenters.Base).Apply();var e=this,t=null,o={},r=null,n=null,i=null,a=null,l=null,s=null,c=null,d=null,u=null,S=null,p=null,h=null,C=null,m=null,F=null,g=null,y=null,f=null,V=JSShop.Language.Translations,J=[],E=[];function v(){n.SetInputValue(""),n.Value(""),n.TreeView.RemoveAllChildren(!0),i.GetPicker().RemoveItems(),o={},JSShop.Models.Product.RetrieveAll("",function(e,t){Fit.Array.ForEach(t,function(e){var t="CAT#"+e.Category();null===n.TreeView.GetChild(t)&&(n.TreeView.AddChild(new Fit.Controls.TreeView.Node(e.Category(),t)),i.GetPicker().AddItem(e.Category(),e.Category()));var r=new Fit.Controls.TreeView.Node(e.Title(),e.Id());r.Selectable(!0),n.TreeView.GetChild(t).AddChild(r),o[e.Id()]=e}),0===Fit.Array.Count(o)&&(n.SetInputValue(V.ProductForm.NoProducts),n.CloseDropDown())})}function A(e){if(Fit.Validation.ExpectInstance(e,JSShop.Models.Product,!0),!0===Fit.Validation.IsSet(e)){if(i.ClearInput(),i.AddSelection(e.Category(),e.Category()),a.Value(e.Id()),l.Value(e.Title()),s.Value(e.Description()),c.Clear(),d.Value(e.Price().toString().replace(".",V.Locale.DecimalSeparator)),u.Value(e.Currency()),S.Value(0!==e.Vat()?e.Vat().toString().replace(".",V.Locale.DecimalSeparator):""),p.Value(0!==e.Weight()?e.Weight().toString().replace(".",V.Locale.DecimalSeparator):""),h.Value(O(e.WeightUnit())),C.Value(e.DeliveryTime()),m.Value(e.DiscountExpression()),F.Value(e.DiscountMessage()),t.querySelector(".JSShopProductFormImages").innerHTML="",""!==e.Images()){var o=t.querySelector(".JSShopProductFormImages");Fit.Array.ForEach(e.Images().split(";"),function(e){var t=new Image;o.appendChild(D(t,function(){Fit.Array.Add(J,e),Fit.Dom.Remove(t.parentElement)})),t.src=e})}f.GetDomElement().style.display="",r=e}else i.ClearInput(),i.ClearSelections(),a.Value(""),l.Value(""),s.Value(""),c.Clear(),d.Value(""),u.Value(null!==JSShop.Cookies.Get("PreviousCurrency")?JSShop.Cookies.Get("PreviousCurrency"):""),S.Value(null!==JSShop.Cookies.Get("PreviousVat")?JSShop.Cookies.Get("PreviousVat"):""),p.Value(""),h.Value(null!==JSShop.Cookies.Get("PreviousWeightUnit")?JSShop.Cookies.Get("PreviousWeightUnit"):""),C.Value(null!==JSShop.Cookies.Get("PreviousDeliveryTime")?JSShop.Cookies.Get("PreviousDeliveryTime"):""),m.Value(""),F.Value(""),t.querySelector(".JSShopProductFormImages").innerHTML="",f.GetDomElement().style.display="none",r=null}function x(){var e=null!==r&&r.Id()===a.Value(),t=!0===e?r:new JSShop.Models.Product(a.Value());null!==r&&t!==r&&t.Images(r.Images());var o=t.Images(),n=""!==o?o.split(";"):[];Fit.Array.ForEach(c.GetFiles(),function(e){if(!1!==e.Processed){if(null===e.ServerResponse||""===e.ServerResponse)throw"File upload did not produce a valid file reference";Fit.Array.Add(n,e.ServerResponse)}}),Fit.Array.ForEach(J,function(e){Fit.Array.Remove(n,e)}),o="",Fit.Array.ForEach(n,function(e){o+=(""!==o?";":"")+e}),t.Category(i.GetSelections()[0].Value),t.Id(a.Value()),t.Title(l.Value()),t.Description(s.Value()),t.Images(o),t.Price(parseFloat(d.Value().replace(V.Locale.DecimalSeparator,"."))),t.Currency(u.GetSelections()[0].Value),t.Vat(""!==S.Value()?parseFloat(S.Value().replace(V.Locale.DecimalSeparator,".")):0),t.Weight(""!==p.Value()?parseFloat(p.Value().replace(V.Locale.DecimalSeparator,".")):0),t.WeightUnit(h.GetSelections()[0].Value),t.DeliveryTime(C.Value()),t.DiscountExpression(m.Value()),t.DiscountMessage(F.Value());var y=function(){var e=function(){g.Icon("fa-check"),setTimeout(function(){g.Icon("floppy-o")},1500),A(null),v()};null!==r&&t!==r?r.Delete(e):e()};!0===e?t.Update(y):t.Create(y)}function P(e){if(Fit.Validation.ExpectFunction(e),0!==J.length){var t=new Fit.Http.Request(JSShop.WebService.Files.Remove);t.SetData("Files="+J.join(";")),t.OnSuccess(function(t){e()}),t.OnFailure(function(t){Fit.Controls.Dialog.Alert(V.ProductForm.ImagesNotRemoved),e()}),t.Start()}else e()}function D(e,t){Fit.Validation.ExpectInstance(e,Image),Fit.Validation.ExpectFunction(t);var o=document.createElement("div");o.className="JSShopFilePreview";var r=document.createElement("span");return r.className="fa fa-remove",r.onclick=function(e){JSShop.WebService.Files.Remove&&t()},r.style.cssText=JSShop.WebService.Files.Remove?"":"opacity: 0.5; cursor: not-allowed;",o.appendChild(r),e.onload=function(t){var o=Fit.Dom.GetInnerDimensions(e.parentElement);e.width/2>e.height?(e.style.height="100%",e.style.width="auto",e.style.marginLeft="-"+(e.offsetWidth-o.X)/2+"px"):e.width/2<e.height?(e.style.width="100%",e.style.height="auto",e.style.marginTop="-"+(e.offsetHeight-o.Y)/2+"px"):(e.style.width="100%",e.style.height="100%")},o.appendChild(e),o}function O(e){return Fit.Validation.ExpectString(e),"lbs"===e?V.ProductForm.Pounds+"=lbs":V.ProductForm.Kilos+"=kg"}this.GetDomElement=function(){return t},function(){t=document.createElement("div"),null===document.querySelector("link[href*='/Views/ProductForm.css']")&&Fit.Loader.LoadStyleSheet(JSShop.GetPath()+"/Views/ProductForm.css?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));var I=new Fit.Http.Request(JSShop.GetPath()+"/Views/ProductForm.html?CacheKey="+(JSShop.Settings.CacheKey?JSShop.Settings.CacheKey:"0"));I.OnSuccess(function(e){var o=I.GetResponseText();t.innerHTML=o,Fit.Dom.Add(t.querySelector("#JSShop-Products-Label"),document.createTextNode(V.ProductForm.EditProduct)),n.Render(t.querySelector("#JSShop-Products-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Category-Label"),document.createTextNode(V.ProductForm.Category)),i.Render(t.querySelector("#JSShop-Category-Control")),Fit.Dom.Add(t.querySelector("#JSShop-ProductId-Label"),document.createTextNode(V.ProductForm.ProductId)),a.Render(t.querySelector("#JSShop-ProductId-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Title-Label"),document.createTextNode(V.ProductForm.Title)),l.Render(t.querySelector("#JSShop-Title-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Description-Label"),document.createTextNode(V.ProductForm.Description)),s.Render(t.querySelector("#JSShop-Description-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Images-Label"),document.createTextNode(V.ProductForm.Images)),c.Render(t.querySelector("#JSShop-Images-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Price-Label"),document.createTextNode(V.ProductForm.Price)),d.Render(t.querySelector("#JSShop-Price-Control")),u.Render(t.querySelector("#JSShop-Currency-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Vat-Label"),document.createTextNode(V.ProductForm.Vat)),S.Render(t.querySelector("#JSShop-Vat-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Weight-Label"),document.createTextNode(V.ProductForm.Weight)),p.Render(t.querySelector("#JSShop-Weight-Control")),h.Render(t.querySelector("#JSShop-WeightUnit-Control")),Fit.Dom.Add(t.querySelector("#JSShop-DeliveryTime-Label"),document.createTextNode(V.ProductForm.DeliveryTime)),C.Render(t.querySelector("#JSShop-DeliveryTime-Control")),Fit.Dom.Add(t.querySelector("#JSShop-DiscountExpression-Label"),document.createTextNode(V.ProductForm.DiscountExpression)),m.Render(t.querySelector("#JSShop-DiscountExpression-Control")),Fit.Dom.Add(t.querySelector("#JSShop-DiscountMessage-Label"),document.createTextNode(V.ProductForm.DiscountMessage)),F.Render(t.querySelector("#JSShop-DiscountMessage-Control")),Fit.Dom.Add(t.querySelector("#JSShop-Buttons"),g.GetDomElement()),Fit.Dom.Add(t.querySelector("#JSShop-Buttons"),y.GetDomElement()),Fit.Dom.Add(t.querySelector("#JSShop-Buttons"),f.GetDomElement())}),I.Start(),(n=new Fit.Controls.DropDown("JSShopProducts")).TreeView=new Fit.Controls.TreeView("JSShopProductsTreeView"),n.TreeView.Lines(!0),n.TreeView.Width(100,"%"),n.ListView=new Fit.Controls.ListView,n.Width(350,"px"),n.DropDownMaxWidth(180,"%"),n.InputEnabled(!0),n.OnInputChanged(function(e){if(""===n.GetInputValue())n.SetPicker(n.TreeView);else{n.OpenDropDown(),n.ListView.RemoveItems();var t=n.TreeView.GetAllNodes(),o=n.GetInputValue().toLowerCase();Fit.Array.ForEach(t,function(e){0!==e.GetLevel()&&(e.Title().toLowerCase().indexOf(o)>-1||e.Value().toLowerCase()===o)&&n.ListView.AddItem(e.Title()+" ("+e.GetParent().Title()+")",e.Value())}),n.SetPicker(n.ListView)}}),n.OnChange(function(e){n.SetPicker(n.TreeView),0===n.TreeView.Selected().length?A(null):A(o[n.TreeView.Selected()[0].Value()])}),n.SetPicker(n.TreeView),(i=new Fit.Controls.DropDown("JSShopProductCategory")).SetPicker(new Fit.Controls.ListView),i.Width(350,"px"),i.DropDownMaxWidth(150,"%"),i.InputEnabled(!0),i.SetValidationCallback(function(e){return e.split("=")[0].length<=50},V.Common.MaxLengthExceeded),i.Required(!0),i.Scope("JSShopProductForm"),i.OnBlur(function(e){i.GetSelections().length>0?i.SetInputValue(""):""!==i.GetInputValue()&&i.AddSelection(i.GetInputValue(),i.GetInputValue())}),e.OnRendered(function(e){v()}),(a=new Fit.Controls.Input("JSShopProductId")).Width(350,"px"),a.Required(!0),a.SetValidationCallback(function(e){return e.length<=30},V.Common.MaxLengthExceeded),a.Scope("JSShopProductForm"),(l=new Fit.Controls.Input("JSShopProductTitle")).Width(350,"px"),l.Required(!0),l.SetValidationCallback(function(e){return e.length<=250},V.Common.MaxLengthExceeded),l.Scope("JSShopProductForm"),(s=new Fit.Controls.Input("JSShopProductDescription")).Width(350,"px"),s.Height(80,"px"),s.MultiLine(!0,300),s.Maximizable(!0,250),s.SetValidationCallback(function(e){return e.length<=1e3},V.Common.MaxLengthExceeded),s.Scope("JSShopProductForm"),(c=new Fit.Controls.FilePicker("JSShopProductImages")).Url(JSShop.WebService.Files.Upload),c.Enabled(!!JSShop.WebService.Files.Upload),c.MultiSelectionMode(!0),c.Title(V.ProductForm.SelectFiles),c.OnChange(function(e){if(!0!==c.IsLegacyModeEnabled()){E=[];var o=t.querySelector(".JSShopProductFormImages");Fit.Array.ForEach(o.querySelectorAll("div.JSShopPreviewContainer"),function(e){Fit.Dom.Remove(e)}),Fit.Array.ForEach(c.GetFiles(),function(e){if(!1!==Fit.Array.Contains(["image/png","image/jpg","image/jpeg","image/gif"],e.Type)){var t=document.createElement("div");t.className="JSShopPreviewContainer";var r=new Fit.Controls.ProgressBar("JSShopFileProgress"+e.Id);r.Title(e.Filename),r.Render(t);var n=e.GetImagePreview();null!==n&&t.appendChild(D(n,function(){Fit.Array.Add(E,e.Filename),Fit.Dom.Remove(t)})),o.appendChild(t)}})}}),c.OnProgress(function(e,t){!1===c.IsLegacyModeEnabled()&&Fit.Controls.Find("JSShopFileProgress"+t.Id).Progress(t.Progress)}),c.OnCompleted(function(e){P(x)}),(d=new Fit.Controls.Input("JSShopProductPrice")).Width(185,"px"),d.Required(!0),d.SetValidationCallback(function(e){return e.length<=15&&parseFloat(e)<=9999999999.9999},V.ProductForm.NumericValueError),d.SetValidationExpression(new RegExp("^([0-9]+(\\"+V.Locale.DecimalSeparator+"[0-9]+)?)?$"),V.Common.InvalidValue),d.Scope("JSShopProductForm"),null===JSShop.Cookies.Get("PreviousCurrency")&&JSShop.Cookies.Set("PreviousCurrency",V.Locale.Currency,31536e3);var T=null,M=JSShop.Cookies.Get("PreviousCurrency");(u=new Fit.Controls.DropDown("JSShopProductCurrency")).Width(125,"px"),u.SetPicker(new Fit.Controls.ListView),u.Value(M),u.Required(!0),u.InputEnabled(!0),u.OnOpen(function(e){if(null===T){T=[];var t=new Fit.Http.JsonRequest(JSShop.GetUrl()+"/Currencies.json");t.OnSuccess(function(e){T=t.GetResponseJson();var o=u.GetInputValue().toLowerCase();Fit.Array.ForEach(T,function(e){(""===o||e.cc.toLowerCase().indexOf(o)>-1||e.symbol.toLowerCase().indexOf(o)>-1||e.name.toLowerCase().indexOf(o)>-1)&&u.GetPicker().AddItem(e.cc+" ("+e.symbol+")",e.cc)})}),t.Start()}}),u.OnInputChanged(function(e){if(null===T)u.OpenDropDown();else{var t=u.GetInputValue().toLowerCase();u.GetPicker().RemoveItems(),Fit.Array.ForEach(T,function(e){(""===t||e.cc.toLowerCase().indexOf(t)>-1||e.symbol.toLowerCase().indexOf(t)>-1||e.name.toLowerCase().indexOf(t)>-1)&&u.GetPicker().AddItem(e.cc+" ("+e.symbol+")",e.cc)}),""!==u.GetInputValue()&&u.OpenDropDown()}}),u.OnChange(function(e){JSShop.Cookies.Set("PreviousCurrency",u.Value(),31536e3)}),(S=new Fit.Controls.Input("JSShopProductVat")).Width(185,"px"),S.SetValidationCallback(function(e){return e.length<=15&&parseFloat(e)<=9999999999.9999},V.ProductForm.NumericValueError),S.SetValidationExpression(new RegExp("^([0-9]+(\\"+V.Locale.DecimalSeparator+"[0-9]+)?)?$"),V.Common.InvalidValue),S.Scope("JSShopProductForm"),S.Value(null!==JSShop.Cookies.Get("PreviousVat")?JSShop.Cookies.Get("PreviousVat"):""),S.OnChange(function(e){JSShop.Cookies.Set("PreviousVat",S.Value(),31536e3)}),(p=new Fit.Controls.Input("JSShopProductWeight")).Width(185,"px"),p.SetValidationCallback(function(e){return e.length<=15&&parseFloat(e)<=9999999999.9999},V.ProductForm.NumericValueError),p.SetValidationExpression(new RegExp("^([0-9]+(\\"+V.Locale.DecimalSeparator+"[0-9]+)?)?$"),V.Common.InvalidValue),p.Scope("JSShopProductForm"),null===JSShop.Cookies.Get("PreviousWeightUnit")&&JSShop.Cookies.Set("PreviousWeightUnit",O(V.Locale.WeightUnit),31536e3),JSShop.Cookies.Get("PreviousWeightUnit"),(h=new Fit.Controls.DropDown("JSShopProductWeightUnit")).Width(125,"px"),h.SetPicker(new Fit.Controls.ListView),h.GetPicker().AddItem(V.ProductForm.Kilos,"kg"),h.GetPicker().AddItem(V.ProductForm.Pounds,"lbs"),h.Value(JSShop.Cookies.Get("PreviousWeightUnit")),h.Required(!0),h.OnChange(function(e){JSShop.Cookies.Set("PreviousWeightUnit",h.Value(),31536e3)}),(C=new Fit.Controls.Input("JSShopProductDeliveryTime")).Width(350,"px"),C.Value(null!==JSShop.Cookies.Get("PreviousDeliveryTime")?JSShop.Cookies.Get("PreviousDeliveryTime"):""),C.SetValidationCallback(function(e){return e.length<=50},V.Common.MaxLengthExceeded),C.Scope("JSShopProductForm"),C.OnChange(function(e){JSShop.Cookies.Set("PreviousDeliveryTime",C.Value(),31536e3)}),(m=new Fit.Controls.Input("JSShopProductDiscountExpression")).Width(350,"px"),m.SetValidationCallback(function(e){var t=new JSShop.Models.Product("JSShopTemp"+Fit.Data.CreateGuid());t.Price(100),t.Currency("USD"),t.Vat(25),t.DiscountExpression(e);try{return t.CalculateDiscount(-100),t.CalculateDiscount(0),t.CalculateDiscount(100),!0}catch(e){return!1}},V.Common.InvalidValue),m.SetValidationExpression(/^(.|\n){0,250}$/,V.Common.MaxLengthExceeded),m.Scope("JSShopProductForm"),(F=new Fit.Controls.Input("JSShopProductDiscountMessage")).Width(350,"px"),F.SetValidationCallback(function(e){var t=new JSShop.Models.Product("JSShopTemp"+Fit.Data.CreateGuid());t.Price(100),t.Currency("USD"),t.Vat(25),t.DiscountMessage(e);try{return t.CalculateDiscountMessage(-100),t.CalculateDiscountMessage(0),t.CalculateDiscountMessage(100),!0}catch(e){return!1}},V.Common.InvalidValue),F.SetValidationExpression(/^(.|\n){0,250}$/,V.Common.MaxLengthExceeded),F.Scope("JSShopProductForm"),(g=new Fit.Controls.Button("JSShopSaveButton")).Title(V.ProductForm.Save),g.Icon("floppy-o"),g.Type(Fit.Controls.Button.Type.Success),g.OnClick(function(e){if(!1!==Fit.Controls.ValidateAll("JSShopProductForm"))if(c.GetFiles().length>0){var t=[];Fit.Array.ForEach(c.GetFiles(),function(e){!1===c.IsLegacyModeEnabled()?!1===Fit.Array.Contains(["image/png","image/jpg","image/jpeg","image/gif"],e.Type)&&Fit.Array.Add(t,e.Filename):!1===Fit.Array.Contains([".png",".jpg",".jpeg",".gif"],e.Filename.substring(e.Filename.lastIndexOf(".")))&&Fit.Array.Add(t,e.Filename)});var o=Fit.Array.Merge(t,E);c.GetFiles().length>o.length?c.Upload(o):P(x)}else P(x);else Fit.Controls.Dialog.Alert(V.Common.InvalidEntries)}),(y=new Fit.Controls.Button("JSShopClearButton")).Title(V.ProductForm.Clear),y.Icon("refresh"),y.Type(Fit.Controls.Button.Type.Warning),y.OnClick(function(e){y.Icon("fa-check"),setTimeout(function(){y.Icon("refresh")},1500),n.SetInputValue(""),n.Clear(),A(null)}),(f=new Fit.Controls.Button("JSShopDeleteButton")).Title(V.ProductForm.Delete),f.Icon("minus-circle"),f.Type(Fit.Controls.Button.Type.Danger),f.GetDomElement().style.display="none",f.OnClick(function(e){Fit.Controls.Dialog.Confirm(V.ProductForm.DeleteWarning,function(e){!1!==e&&(J=""!==r.Images()?r.Images().split(";"):[],P(function(){r.Delete(function(){f.Icon("fa-check"),setTimeout(function(){f.Icon("minus-circle")},1500),A(null),v()})}))})})}()},window.JSShop||Fit.Validation.ThrowError("JSShop.js must be loaded"),JSShop.Presenters.ProductList={},JSShop.Presenters.ProductList.Initialize=function(e){Fit.Validation.ExpectDomElement(e);var t=JSShop.Language.Translations,o=document.querySelectorAll(".JSShopBuyButton");Fit.Array.ForEach(o,function(e){var o=Fit.Dom.Data(e,"ProductId");if(null!==o){var r="1",n=new Fit.Controls.Input("JSShopUnits"+Fit.Data.CreateGuid());n.Width(2.5,"em"),n.Height(2,"em"),n.Value(r),n.OnChange(function(e){""!==n.Value()&&(!0===isNaN(parseInt(n.Value()))||parseInt(n.Value()).toString()!==n.Value()||parseInt(n.Value())<1||parseInt(n.Value())>999999)?n.Value(r):r=n.Value()}),n.OnBlur(function(e){""===n.Value()&&n.Value("1")});var i=new Fit.Controls.Button("JSShopBuyButton"+Fit.Data.CreateGuid());i.Height(2,"em"),i.Title(e.innerHTML),i.Type(Fit.Controls.Button.Type.Primary),i.Icon("shopping-cart"),i.OnClick(function(){i.Enabled(!1);var e=new JSShop.Models.Product(o);e.Retrieve(function(){JSShop.Models.Basket.Add(e.Id(),parseInt(n.Value()));var o=new Fit.Controls.Dialog;if(o.Modal(!0),o.Content("<b>"+t.ProductList.ProductAdded+"</b><br><br>"+n.Value()+" x "+e.Title()),JSShop.Settings.BasketUrl){var r=new Fit.Controls.Button("JSShopBasketButton"+Fit.Data.CreateGuid());r.Type(Fit.Controls.Button.Type.Default),r.Icon("shopping-basket"),r.Title(t.ProductList.OpenBasket),r.OnClick(function(e){o.Close(),i.Enabled(!0),location.href=JSShop.Settings.BasketUrl}),o.AddButton(r)}var a=new Fit.Controls.Button("JSShopContinueButton"+Fit.Data.CreateGuid());a.Type(Fit.Controls.Button.Type.Default),a.Icon("shopping-cart"),a.Title(t.ProductList.ContinueShopping),a.OnClick(function(e){o.Close(),i.Enabled(!0)}),o.AddButton(a),o.Open(),a.Focused(!0)},function(){alert(t.ProductList.ErrorNotFound+": "+o),i.Enabled(!0)})});var a=document.createElement("span");i.GetDomElement().style.verticalAlign="top",n.GetDomElement().style.verticalAlign="top",n.GetDomElement().style.marginLeft="0.3em",Fit.Dom.Add(a,i.GetDomElement()),Fit.Dom.Add(a,n.GetDomElement()),e.innerHTML="",Fit.Dom.Add(e,a)}else console.log("Unable to create Buy Button - data-ProductId attribute must be set")});var r=document.querySelectorAll(".JSShopInfoButton");Fit.Array.ForEach(r,function(e){var t=new Fit.Controls.Button("SMShopButton"+Fit.Data.CreateGuid());t.Height(2,"em"),t.Title(e.innerHTML),t.Type(Fit.Controls.Button.Type.Info),e.innerHTML="",Fit.Dom.Add(e,t.GetDomElement())});var n=document.querySelectorAll(".JSShopLocalizedNumber");Fit.Array.ForEach(n,function(e){var o=e.innerHTML;!1!==/^\-?([0-9]+(\.[0-9]+)?)$/.test(o)&&(e.innerHTML=o.replace(".",t.Locale.DecimalSeparator))})},Fit._internal.Validation.DebugMode=!1;